# Tealium iQ Extension Documentation: Fire Tag Once

## 1. Extension Overview

- **Name**: Fire Tag Once
- **ID**: 1066
- **Type**: Javascript Code
- **Scope**: 893, 1214, 995
- **Execution Frequency**: Single execution per tag

### Summary
The "Fire Tag Once" extension is designed to ensure that a specific tag is loaded only once per session or page view. This is crucial for preventing duplicate data submissions or tracking events triggered multiple times, which can skew analytics results. By checking a loaded flag, the extension effectively manages tag firing, providing cleaner data for analysis.

---

## 2. Code Explanation

### Key Variables
- **a**: Represents the event type. Accepts strings denoting the type of event being processed.
- **b**: Represents the event payload. An object containing additional data related to the event.
- **u**: Represents the `tagObject`, which can include properties relevant to the tag being fired. It includes a `loaded` flag used to track whether the tag has already been initiated.

### Logic Flow
1. The extension first checks if the `loaded` property of `u` is `true`. If it is, the extension exits immediately, preventing any further processing.
2. If the tag has not been loaded, it sets the `loaded` property of `u` to `true`, indicating that the tag has now been activated.

### Dependencies
- The extension is reliant on the `tagObject` structure which should include the `loaded` property. This property must be initialized as `false` prior to the first execution, ensuring the extension can function as intended.

---

## 3. Usage Examples

### Normal Conditions
- When an event is triggered for the first time, the extension will set the `loaded` flag, allowing the tag to fire:
  ```javascript
  // First trigger
  eventType = "pageview";
  eventPayload = { userId: 1234 };
  tagObject = { loaded: false };

  // Extension code runs and sets tagObject.loaded to true.
  ```

### Edge Conditions
- If the same event is triggered again in the same workflow, the extension will prevent the tag from firing again:
  ```javascript
  // Second trigger
  tagObject.loaded = true; // This is set at first execution.

  // The extension checks tagObject.loaded and exits without re-firing the tag.
  ```

### Summary of Behaviour
- On the first invocation, the tag fires; on subsequent invocations (within the same session), it will not re-fire.

---

## 4. Known Limitations & Gotchas

- **Single Session Limitation**: The extension keeps the tag state only for the duration of a session or page view. If the page is refreshed or a new session starts, the tag can be fired again.
- **State Management**: This extension assumes that `tagObject.loaded` is managed appropriately. If another script sets this property to `false`, it can cause the tag to fire again unexpectedly.
- **Potential Conflicts**: If other extensions depend on the same `tagObject.loaded` flag but modify it differently, unintended behaviours may occur.

---

## 5. Recommendations for Refactoring

- **Defensive Checks**: Although the code currently relies on the presence of `eventType` and `eventPayload`, consider documenting its expected structure clearly for better maintainability.
- **Code Structure**: Introduce comments that describe each section of the code to enhance clarity. This can aid other developers in quickly understanding the extension's purpose and functionality:
  ```javascript
  // Check if the tag is already loaded
  if (u.loaded === true) return false;
  // Mark the tag as loaded
  u.loaded = true;
  ```
- **Modularisation**: If this extension were to grow in complexity, consider refactoring it into smaller, more manageable functions, even if retaining ES5 compatibility.

---

## 6. Maintenance & Further Notes

- **Ongoing Maintenance**: Ensure regular code reviews and updates are scheduled to address any potential conflicts with new extensions or Tealium iQ updates.
- **Ownership**: Designate an owner for this extension who will be responsible for overseeing its performance and troubleshooting any issues that may arise.
- **Testing Guidelines**: Establish a testing protocol to validate the extension's functionality post-deployment. Regularly test under various scenarios to ensure expected behaviours are preserved, adapting the extension as necessary with additional logging for better error detection.

Feel free to reach out should you have any questions or need further elaborations on any points mentioned in this documentation.