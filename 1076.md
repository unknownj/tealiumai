# Tealium iQ Extension Documentation

## 1. Extension Overview

- **Name**: WTA : TAG : Set : Reporting Action & Narrative with Journey Variables
- **ID**: 1076
- **Type**: Javascript Code
- **Scope**: 894
- **Execution Frequency**: On each event execution

### Summary
This Tealium iQ extension is designed to manage and set the **Reporting Action** and **Reporting Action Narrative** properties based on variables defined in the Journey. The extension will first attempt to set these properties from generic event data and then override them with Journey-specific values if present. This ensures that reporting actions are correctly captured across different user journeys, aiding in data analysis and understanding user patterns.

## 2. Code Explanation

The provided code is encapsulated within an immediately invoked function expression (IIFE), which avoids polluting the global namespace while allowing access to predefined variables.

### Key Variables
- `a`: This parameter represents the event type (string) that triggers the extension.
- `b`: This parameter is the event payload (object), containing the data related to the specific event.
- `u`: This variable is not used in the provided code block.

### Logic Flow
1. The extension initially sets `b.ReportingAction` to `b.EventAction` and `b.ReportingActionNarrative` to `b.EventNarrative`.
2. It then checks for the existence of `b.JourneyAction`. If this variable is non-empty, it will override the earlier properties:
    - `b.ReportingAction` is set to `b.JourneyAction`.
    - `b.ReportingActionNarrative` is set to `b.JourneyActionNarrative`.

### Dependencies
- The extension relies on certain properties within the event payload, specifically: 
  - `b.EventAction`
  - `b.EventNarrative`
  - `b.JourneyAction`
  - `b.JourneyActionNarrative`
  
These properties should be defined and well-structured for the extension to operate correctly.

## 3. Usage Examples

### Example 1: Normal Flow
1. An event is triggered with:
   - `EventAction`: "Page View"
   - `EventNarrative`: "User viewed homepage"
   - `JourneyAction`: "Homepage Visit"
   - `JourneyActionNarrative`: "User landed on the homepage"

   **Result**:
   - `ReportingAction` will be set to "Homepage Visit".
   - `ReportingActionNarrative` will be set to "User landed on the homepage".

### Example 2: Absence of Journey Variables
2. An event is triggered with:
   - `EventAction`: "Button Click"
   - `EventNarrative`: "User clicked subscribe button"
   - `JourneyAction`: ""
   - `JourneyActionNarrative`: ""

   **Result**:
   - `ReportingAction` will remain "Button Click".
   - `ReportingActionNarrative` will remain "User clicked subscribe button".

### Edge Conditions
- If `JourneyAction` is defined but `JourneyActionNarrative` is not, the `ReportingActionNarrative` will revert to the default `EventNarrative`, ensuring that a narrative is always present.

## 4. Known Limitations & Gotchas

- **Empty Journey Variables**: If `JourneyAction` or `JourneyActionNarrative` are present but empty, the extension behaves as expected by defaulting to `EventAction` and `EventNarrative`.
- **Data Conflicts**: If multiple extensions modify `b.ReportingAction` or `b.ReportingActionNarrative`, the order of execution may lead to unexpected results. Developers should be mindful of the execution order of extensions and coordinate with other team members.
- **External Scripting Interference**: External scripts modifying global properties or the data layer may inadvertently impact the expected behaviour of this extension.

## 5. Recommendations for Refactoring

- **Defensive Checks**: Although input parameters are guaranteed, consider validating that the expected properties exist within the `b` object before trying to access them. This prevents runtime errors in unanticipated situations.
- **Modularisation**: Consider refactoring the code into reusable functions, encapsulating logic for setting action variables, which could enhance readability and maintainability.
- **Consistency**: Maintain a consistent code style, such as indentation and variable naming conventions, for better readability.

## 6. Maintenance & Further Notes

- **Ongoing Maintenance**: Designate an owner for the extension who will be responsible for monitoring and updating the code as needed. Regular reviews should be scheduled to ensure compatibility with other extensions.
- **Testing Guidelines**: Implement test cases that encompass various event scenarios, especially edge cases that may arise from user interaction. Automated tests can help mitigate bugs during deployment.
- **Documentation Updates**: This documentation should be revisited and updated regularly, especially following code changes or the introduction of new features.

By following this structured approach, developers will ensure clarity and consistency in maintaining the Tealium iQ extension, effectively supporting the goals of data collection and reporting.