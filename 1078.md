# Tealium iQ Extension Documentation

## 1. Extension Overview
- **Name:** WTA : TAG : Set : Consent Cookie Status
- **ID:** 100036
- **Type:** Javascript Code
- **Scope:** 894
- **Execution Frequency:** Active

### Summary
This extension is designed to convert the Cookie Consent values from boolean (`true`/`false`) to integer (`1`/`0`). This conversion is necessary for proper data collection in WebTrends analytics. Essentially, when the extension encounters Cookie Consent values in the event payload, it translates these values to a format that WebTrends can appropriately interpret.

---

## 2. Code Explanation

### Key Variables
- **`eventType`**: A string representing the type of event being processed (passed as the first argument).
- **`eventPayload`**: An object representing the event payload, containing various properties including the cookie consent values (passed as the second argument).
- **`tagObject`**: Represents the meta-information about the tag associated with the extension (not directly manipulated).

### Logic Flow
1. The code checks for the presence of three specific properties within the `eventPayload`:
    - `CookiesFunctional`
    - `CookiesPerformance`
    - `CookiesTargeting`

2. For each of these properties, if the property exists and its value is `true`, it is replaced with `1`. Conversely, if the property's value is `false`, it is replaced with `0`.

### Dependencies
- The extension operates only on the `eventPayload` object and does not have external dependencies beyond Tealium iQ. It relies on standard JavaScript functionality for property access and assignment.

---

## 3. Usage Examples

### Normal Scenario
- **Incoming Payload:**
  ```javascript
  {
    "CookiesFunctional": true,
    "CookiesPerformance": false,
    "CookiesTargeting": true
  }
  ```

- **Processed Output After Extension Execution:**
  ```javascript
  {
    "CookiesFunctional": '1',
    "CookiesPerformance": '0',
    "CookiesTargeting": '1'
  }
  ```

### Edge Case Scenario
- **Incoming Payload:** (missing properties)
  ```javascript
  {
    "SomeOtherProperty": true
  }
  ```
- **Processed Output After Extension Execution:**
  ```javascript
  {
    "SomeOtherProperty": true
  }
  ```
  The absence of the specified cookie properties means they will not be altered. The extension handles this scenario gracefully without throwing errors.

---

## 4. Known Limitations & Gotchas

- **Property Absence:** If any of the expected cookie properties (`CookiesFunctional`, `CookiesPerformance`, `CookiesTargeting`) are missing in the `eventPayload`, the extension will not create them, and the original event data will remain unaltered.
  
- **Type Consistency:** The extension converts boolean values to strings (`'1'` and `'0'`), which may cause issues if other parts of the analytics system expect numerical values. Ensure downstream processing can handle string types.

- **Performance Impact:** If multiple extensions are modifying the same `eventPayload`, there could be unintended side effects or performance degradation. Coordination with other extensions is advised.

---

## 5. Recommendations for Refactoring

- **Defensive Checks:** While it is stated that `eventType` and `eventPayload` are guaranteed to be present, wrapping the code logic in a function that checks for the expected properties can help avoid potential unsupported edge cases in the future.
  
- **Modularisation:** Consider encapsulating the conversion logic into a separate function for better readability and reusability. For example:
    ```javascript
    function convertConsentValue(value) {
        return value ? '1' : '0';
    }
    ```

- **Commenting Style:** Improve clarity by providing more detailed comments explaining the logic around cookie consent rights and their necessity for WebTrends.

---

## 6. Maintenance & Further Notes

- **Ongoing Maintenance:** Ensure periodic reviews of the extension against any updates in data collection requirements by WebTrends or changes in cookie consent regulations.

- **Ownership:** Assign a specific developer or team responsible for updates and debugging any future issues that arise from this extension.

- **Testing Guidelines:** 
  - Validate the extension with both standard and edge case event payloads.
  - Set up unit tests to ensure the conversion behaviour remains consistent after any future code changes.
  
This documentation should serve as a comprehensive guide for developers and stakeholders interacting with the "WTA : TAG : Set : Consent Cookie Status" extension within Tealium iQ.