# Tealium iQ Extension Documentation: OWC : TAG : Load : Vendor Tag Initiator

## 1. Extension Overview

- **Name**: OWC : TAG : Load : Vendor Tag Initiator
- **ID**: 1082
- **Type**: Javascript Code
- **Scope**: 895
- **Execution Frequency**: Active

### Summary
This extension listens for the window's "load" event and initiates the loading of the Webchat service, specifically the ATGSvcs object, if it has not yet loaded. The mechanism employs a fallback timer mechanism to ensure that the Webchat is started no later than three seconds after the page load event. This is particularly useful in scenarios where the Webchat service might be delayed in loading, ensuring a more robust user experience.

---

## 2. Code Explanation

### Key Variables
- `window.loadBot`: A boolean flag initially set to `false`. It can be used to track whether the bot has been loaded, although it is not explicitly modified in the provided code.
- `a`, `b`, `u`: Parameters for the immediately invoked function expression (IIFE). In this context, these represent `eventType`, `eventPayload`, and `tagObject`, which are expected to be present.

### Logic Flow
1. An event listener is attached to the `window` object that listens for the "load" event.
2. Upon the "load" event being triggered:
   - A timeout is initiated to delay the execution of the subsequent code by 3000 milliseconds (3 seconds).
   - After the delay, the code checks whether the `ATGSvcs` global object is defined.
   - If `ATGSvcs` is defined, `ATGSvcs.start()` is invoked to initiate the Webchat service.

### Dependencies
- This extension relies on the existence of the `ATGSvcs` global object. If this object is not present on the page, then the start function will not be invoked.
- The extension assumes that `eventType`, `eventPayload`, and `tagObject` are globally available and passed into the IIFE.

---

## 3. Usage Examples

### Normal Condition
1. **Scenario**: A user navigates to a webpage where the Webchat service is integrated with the variable `ATGSvcs` defined.
2. **Flow**:
   - The user triggers the 'load' event by fully loading the page.
   - The extension waits 3 seconds after the load event.
   - The `ATGSvcs.start()` function is executed, initiating the Webchat service.

### Edge Condition
1. **Scenario**: The Webpage loads but the `ATGSvcs` service is not defined on that page.
2. **Flow**:
   - The user triggers the 'load' event.
   - The extension waits for 3 seconds, but since `ATGSvcs` is undefined, the `start()` method is never invoked.
   - There are no errors, but the Webchat service does not initiate.

---

## 4. Known Limitations & Gotchas

- **Delay Handling**: The current 3-second delay may not be optimal in all scenarios. It is possible that users may encounter a wait time before the Webchat service becomes available.
- **Dependency on Global Object**: If `ATGSvcs` is not loaded by the time `start()` is called, the extension silently fails without notifying the user or developer.
- **Potential Conflicts**: If another extension or script on the page modifies `ATGSvcs` or its methods, it could lead to unexpected behaviour.
- **Scope as Hardcoded Value**: The scope value is hardcoded (895). If the context changes the need for a more dynamic approach may arise.

---

## 5. Recommendations for Refactoring

- **Defensive Checks**: Consider adding checks to confirm that `ATGSvcs.start()` is a callable function before invoking it.
- **Modularisation**: Separate the logic to handle the loading mechanism into a distinct function, allowing for cleaner code and easier debugging.
  
  Example:
  ```javascript
  function startWebchat() {
      if(typeof window.ATGSvcs !== 'undefined' && typeof window.ATGSvcs.start === 'function') {
          window.ATGSvcs.start();
      }
  }

  window.addEventListener("load", function(){
      setTimeout(startWebchat, 3000);
  }, false);
  ```
- **Configurable Delay**: Allow the delay duration to be configurable via a variable, rather than hardcoding it, improving the flexibility of the extension.

---

## 6. Maintenance & Further Notes

- **Ownership**: Assign a specific team member to be responsible for the ongoing maintenance of this extension. 
- **Testing Guidelines**: Regularly test the extension in various environments to ensure compatibility and functionality. Focus on different browsers and scenarios where `ATGSvcs` might not load.
- **Documentation Updates**: Keep this documentation current with any changes made to the code to facilitate easy understanding for future developers. Consider adding a change log section.

---

This documentation aims to provide a comprehensive understanding of the OWC : TAG : Load : Vendor Tag Initiator extension, ensuring clarity for current and future stakeholders.