# Tealium iQ Extension Documentation

## 1. Extension Overview

- **Name**: WTA : TAG : Set : Tealium Version
- **ID**: 100036
- **Type**: Javascript Code
- **Scope**: 894
- **Execution Frequency**: Every time the extension is triggered (executed at the appropriate stage in the data flow).

### Summary
This extension is designed to capture and set the Tealium version being used within the environment. It appends the current TIQ version to the `TealiumVersion` variable, and updates the title of the webpage with the environment context when the environment is not production. This functionality aids in debugging and ensuring the correct versioning of Tealium is displayed for Quality Assurance and testing readers.

## 2. Code Explanation

### Key Variables
- **`b`**: This object typically represents the data layer (also known as the `utag.data` object) that carries the various data points across a Tealium implementation.
- **`utv`**: Holds the current Tealium version parsed from the `b["ut.version"]` variable. It extracts the last element from the version string (assuming it is in a format like "1.2.3").

### Logic Flow
1. The function splits the `ut.version` string by `.` to get an array of version segments.
2. The last segment of the version is identified and appended to the existing `TealiumVersion` variable, forming the `FullTealiumVersion`.
3. It checks the environment variable (`ut.env`):
   - If the environment is not production, it appends the environment identifier to the `FullTealiumVersion`.
   - If the webpage's title does not already start with this environment identifier, it prepends the environment identifier to the title.

### Dependencies
- This extension relies primarily on the global Tealium data layer object (`b`), specifically the `ut.version` and `ut.env` properties, which need to be accessible within the execution context.

## 3. Usage Examples

### Normal Condition
- **Scenario**: A user is on a testing environment (`ut.env` = "staging").
  - After execution, `FullTealiumVersion` might be updated from `1.0.0` to `1.0.0/1` (if TIQ version = 1 and the environment is "staging").
  - The webpage title would change to "staging: [Original Title]" if it didn't already start with "staging: ".

### Edge Conditions
- **Scenario**: The `ut.version` is malformed or empty.
  - The extension may result in errors when trying to split or access parts of `ut.version`. Proper validation can be implemented to ensure robustness.

## 4. Known Limitations & Gotchas

- **Malformed Version Strings**: If `ut.version` does not follow the expected semantic versioning pattern ("x.y.z"), the extension may fail when accessing the array elements.
- **Title Overwrites**: Continuous loading or quick navigation may lead to unexpected title changes, as every invocation (if conditions allow) would attempt to prepend the environment tag.
- **Global Object Dependencies**: The extension heavily relies on mutable global objects, which may lead to conflicts if other scripts modify the same variables.

## 5. Recommendations for Refactoring

- **Defensive Checks**: Consider validating the format of `ut.version` before manipulating it. For example, checking that it is non-empty and correctly structured.
- **Modularisation**: Create helper functions to handle version parsing and title modification, enhancing readability and maintainability.
- **Code Style**: Maintain consistent variable naming and indentation practices, making the code easier to understand for future developers.

## 6. Maintenance & Further Notes

- **Ongoing Maintenance**: Regularly review the effectiveness of this extension with updates to the Tealium library to ensure compatibility with new features or changes.
- **Ownership**: Assign a dedicated team member for managing updates, bug fixes, and documenting changes in this extension.
- **Testing Guidelines**: Create a testing plan that includes scenarios for both production and non-production environments to ensure functionality works as intended. Regular regression testing is advised after significant updates or changes to dependencies.

--- 

This documentation aims to provide a comprehensive guide to the Tealium extension, ensuring ease of understanding and maintenance for current and future developers in the team.