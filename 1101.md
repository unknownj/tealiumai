# Tealium iQ Extension Documentation: Emergency Overdrafts Fix

## 1. Extension Overview

- **Name**: Emergency Overdrafts Fix
- **ID**: 1101
- **Type**: Advanced Javascript Code
- **Scope**: 894
- **Execution Frequency**: Active

### Summary
The **Emergency Overdrafts Fix** extension is designed to manipulate analytics data related to an overdraft application journey on the website. The extension adjusts various journey-related variables based on URL path and specific events within the journey. Its primary purpose is to standardise the analytics flow for better tracking and reporting of user actions during the overdraft application process.

---

## 2. Code Explanation

### Key Variables
- **`window.location.pathname`**: Checks the current URL path to determine if the logic should execute for the overdraft application.
- **`b`**: The `eventPayload` object that contains the analytics data to be adjusted.
- **`b.JourneyName`, `b.JourneyAction`, `b.JourneyStep`, `b.JourneyStepName`, `b.JourneyAmount`, `b.JourneyActionNarrative`, `b.JourneyProduct`**: Various variables within `eventPayload` that are related to the user's journey through the overdraft application.

### Logic Flow
1. **Path Check**: The script first checks if the pathname contains "/applyod/" and if `JourneyVersion` is "1". If both conditions are satisfied, the main logic executes.
2. **Initial Setup**: Sets the `JourneyName` to "ApplyOD" and adjusts several properties based on their existing values:
    - Strips out specific actions and sets default values for steps if they haven’t been defined.
3. **Conditional Adjustments**: Depending on the value of `JourneyStepName`, the code sets both `JourneyStep` and `JourneyAction` to reflect the specific context:
    - "Overdraft downsell" → `JourneyStep` becomes 3 and `JourneyAction` becomes "Downsell".
    - "Overdraft declined" → Sets to "Credit Decline".
    - "Overdraft referred" → Sets to "Referred to Branch".
    - "Success Page" → Concludes the journey with "Service Action Complete".
4. **Action Narrative Handling**: `JourneyActionNarrative` is used to capture narrative but is reset if an amount is present.

### Dependencies
- The code relies on standard global objects such as `window` for URL checking and assumes that `eventType`, `eventPayload`, and `tagObject` are readily available within the execution context.

---

## 3. Usage Examples

### Normal Conditions
- **Scenario**: A user navigates to `/applyod/` and opts for overdraft management with a successful action.
  - **Input**: 
    - `b.JourneyStepName = "Success Page"`
  - **Output**: 
    - After execution, `b.JourneyAction` becomes "Service Action Complete", and `b.JourneyStep` is maintained or updated as necessary.

### Edge Conditions
- **Scenario**: If `b.JourneyStepName` is empty or does not match predefined strings.
  - **Input**: 
    - `b.JourneyStepName = ""`
  - **Output**: 
    - The values of `JourneyStep` and `JourneyAction` remain unchanged unless handled elsewhere in the application.

---

## 4. Known Limitations & Gotchas

- **URL Path Dependency**: The extension only activates on specific paths. Mismatched URLs will prevent the extension from executing, leading to missed analytics data.
- **Fixed Action Names**: The logic is contingent upon a finite set of `JourneyStepName` values and doesn't handle unexpected values. This can cause inconsistencies in data if new journey steps are added.
- **Interference with Other Extensions**: If other extensions manipulate similar properties within the same execution context, there might be conflicts leading to inaccurate or lost data.

---

## 5. Recommendations for Refactoring

- **Input Validation**: While eventType and eventPayload are guaranteed, consider checking other variables within `b` for robustness, such as `JourneyStepName`.
- **Modularisation**: Extract individual conditions into separate helper functions for clarity. This would make the main logic cleaner and promote reusability.
- **Code Comments**: Add comments to clarify purpose and logic, enhancing future maintainability.
- **Consolidate Actions**: Consider using a mapping approach for setting actions based on `JourneyStepName` instead of multiple if-conditions to increase scalability.

---

## 6. Maintenance & Further Notes

- **Ownership**: Assign a dedicated team member to oversee this extension's performance and resolve any arising issues.
- **Testing Guidelines**: Implement A/B testing to evaluate the impact of changes made to the extension. Regular regression tests will help maintain performance across updates.
- **Documentation Updates**: Ensure this documentation is updated whenever changes are made to the extension or when new pathways or actions are introduced within the analytics journey.

--- 

This comprehensive documentation is intended to help developers and stakeholders understand, use, and maintain the Emergency Overdrafts Fix extension effectively.