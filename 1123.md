# Tealium iQ Extension Documentation: BAU : Conversion label lookup

## 1. Extension Overview

- **Name**: BAU : Conversion label lookup
- **ID**: 1160
- **Type**: Lookup Table
- **Scope**: 946
- **Execution Frequency**: Active

### Summary
The "BAU : Conversion label lookup" extension is designed to dynamically construct and assign a `gaPath` variable based on the user's journey through a specific path. If the URL contains a predefined static segment (`/cwa/`), the extension will concatenate the `JourneyName` and `JourneyStep` to create a detailed path for analytics. This behaviour ensures more meaningful tracking of user interactions, which can enhance understanding of user behaviour and assist in analytics reporting.

---

## 2. Code Explanation

### Key Variables
- **`eventType`**: This variable represents the type of event that triggers the execution of the extension.
- **`eventPayload`**: An object that contains data related to the event; specifically, it may contain `JourneyStep`, `JourneyName`, and `JourneyStepName`.
- **`b.gaPath`**: This is a variable defined within the payload where the constructed path will be stored for later utilisation.

### Logic Flow
1. The outer function defines the mechanism that captures the event type and payload.
2. It checks if the current URL's pathname includes `/cwa/`:
   - If true, it verifies if `JourneyStep` and `JourneyName` exist in the `eventPayload`.
     - If both are present, `gaPath` is assigned a string constructed by concatenating `JourneyName`, `JourneyStep`, and `JourneyStepName`.
   - If either `JourneyStep` or `JourneyName` is missing, `gaPath` is simply assigned the current pathname.
3. If the URL does not contain `/cwa/`, `gaPath` is assigned the pathname directly.

### Dependencies
- The code depends on the global `location` object for accessing the current URL's pathname.
- It relies on the predefined structure of `eventPayload` to extract journey-related values.

---

## 3. Usage Examples

### Normal Scenario
- **User Journey**: A user navigates through a marketing funnel, and the URL becomes `https://example.com/cwa/landing`.
- **Event Payload**:
  ```json
  {
     "JourneyStep": "Step1",
     "JourneyName": "MarketingCampaign",
     "JourneyStepName": "InitialStep"
  }
  ```
- **Output**:
  - The constructed `gaPath` would be: `MarketingCampaign/Step1/InitialStep`.

### Edge Conditions
- **Missing Parameters in Event payload**:
  - If `eventPayload` lacks either `JourneyStep` or `JourneyName`, even when navigating within `/cwa/`:
  - **Output**:
    - `gaPath` will fallback to the pathname (`/cwa/landing`).

- **Not in `/cwa/`**:
  - For the URL `https://example.com/anotherpath`, regardless of `eventPayload`:
  - **Output**:
    - `gaPath` will be assigned simply as `anotherpath`.

---

## 4. Known Limitations & Gotchas

- **Static URL Dependency**: The logic explicitly checks for the inclusion of `/cwa/` and will only function as intended with these paths. If new paths are introduced that should trigger similar behaviour, the code will need to be updated.
- **Parameter Dependency**: While the presence of `eventType` and `eventPayload` is guaranteed, this extension can break if the expected fields in `eventPayload` change.
- **Conflict with Other Extensions**: If another extension also modifies `b.gaPath`, it may lead to unexpected results, especially in concurrent environments.

---

## 5. Recommendations for Refactoring

- **Modularisation**: Consider breaking the code into smaller functional components for clarity and reusability. Each function should have a single responsibility.
  
- **Defensive Checks**: Although defensive coding for `eventType` and `eventPayload` is not required, consider validating other expected fields (`JourneyStep`, `JourneyName`, `JourneyStepName`) to ensure they meet expected formats or accountability.

- **Code Styling**: Introduce consistent indentation and spacing for improved readability. Consider adding comments for complicated logic.

---

## 6. Maintenance & Further Notes

### Ongoing Maintenance
- Review the extension monthly to confirm that it continues to function as expected, particularly after changes to the URL structure or event payloads.
  
### Ownership
- Assign ownership to a team member who is responsible for overseeing the extension's functionality and updating documentation as needed.

### Testing Guidelines
- Implement a robust testing framework. Consider using mock event payloads to ensure various scenarios are validated.
- Use both automated and manual testing to ensure that updates do not introduce breaking changes.

--- 

This documentation serves as a comprehensive guide for developers and stakeholders involved with the "BAU : Conversion label lookup" extension within Tealium iQ, ensuring proper understanding and management of the code and its impact on analytics.