# Tealium iQ Extension Documentation

## 1. Extension Overview

- **Name:** In Flight Adobe Event Triggers
- **ID:** 1226
- **Type:** Advanced Javascript Code
- **Scope:** After Load Rules
- **Execution Frequency:** Run Always

### Summary
The "In Flight Adobe Event Triggers" extension is designed to facilitate event tracking for an application by sending various types of analytics events based on user interactions and application state changes. It primarily utilizes the global `LBGAnalytics` object to trigger events that reflect user journey stages and actions taken within the application. This extension enhances tracking capabilities for better insights into user behavior.

---

## 2. Code Explanation

### Key Variables
- **`e`**: A reference to `window.LBGAnalytics.events`, responsible for triggering events.
- **`b`**: The event payload containing information about user interactions (e.g., action types and journey IDs).

### Logic Flow
1. The extension checks the event action and responds accordingly:
   - If `b.EventAction` is "Field Update", it triggers the `fieldUpdate` method using `b.EventNarrative` and `b.EventDuration`.
2. If `b.JourneyUniqueID` is present, it triggers specific generic events based on the application's state:
   - Different events are triggered for states like "Pre-Application", "Application", "Offered", "Referred", "Declined", and "Fulfilled".
   - Additional events are triggered if a transaction occurs, conditioned by `b.JourneyAction` and additional monetisation data.
3. If the event type `a` is "view" and the journey name matches "BranchFinder", a specific search event is logged.
4. For other scenarios like page submissions or service actions completed in branch-finder context, relevant events are triggered with associated variables.

### Dependencies
This extension relies on the global `window.LBGAnalytics` object to function correctly. Ensure that this object is available in the global scope for the extension to operate.

---

## 3. Usage Examples

### Example 1: Field Update Event
- **Input**: 
  ```json
  {
    "EventAction": "Field Update",
    "EventNarrative": "Address Field Changed",
    "EventDuration": 2
  }
  ```
- **Output Event**: Triggers a `fieldUpdate` event with specified narrative and duration.

### Example 2: Application State Tracking
- **Input**: 
  ```json
  {
    "JourneyUniqueID": "ABC123",
    "ApplicationState": "Fulfilled",
    "JourneyAmount": 500,
    "JourneyAction": "Transaction Complete"
  }
  ```
- **Output Events**: 
  - Triggers event `30` for "Fulfilled".
  - Triggers event `45` for the amount and an event `47` for "Transaction Complete".

### Example 3: Search Event in Branch Finder
- **Input**: 
  ```json
  {
    "eventType": "view",
    "JourneyName": "BranchFinder"
  }
  ```
- **Output Event**: Triggers event `79` with the variable `SearchType` as "Branch Locator".

---

## 4. Known Limitations & Gotchas

- Ensure the `window.LBGAnalytics.events` object is properly instantiated. If it's not available, the extension will fail silently without logging any errors.
- The event checks may not cover all possible values for `ApplicationState`. Additional states not mentioned could lead to skipped event tracking.
- If multiple extensions are also processing `JourneyUniqueID`, conflicts may occur in the event tracking logic.

---

## 5. Recommendations for Refactoring

- **Defensive Checks**: Introduce checks for the structure of `b` before accessing properties, ensuring they exist and are of the expected type.
- **Code Style**: Maintain consistent naming conventions for variables to enhance readability.
- **Modularization**: Break down the code into smaller reusable functions for common tasks (e.g., handling different application states).
- **Centralize Event Triggering**: Consider a helper function to encapsulate the logic for triggering events and setting variables to reduce redundancy.

---

## 6. Maintenance & Further Notes

- **Ownership**: Assign ownership of this extension to a specific team or developer to ensure ongoing updates and support.
- **Testing**: Regularly test the extension in a staging environment to ensure it works correctly with changes to the global `LBGAnalytics` object or payload structure.
- **Documentation**: Keep this documentation updated with any future changes to the logic or structure of the extension.

---

This documentation provides a comprehensive overview of the "In Flight Adobe Event Triggers" extension for stakeholders and developers involved in the project.