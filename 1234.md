# Tealium iQ Extension Documentation: Downloads

## 1. Extension Overview

- **Name**: Downloads
- **ID**: 1234
- **Type**: Advanced Javascript Code
- **Scope**: DOM Ready
- **Execution Frequency**: Run Once

### Summary
The Downloads extension is designed to track download events for specific file types (PDF, XLS) on a webpage. When a user clicks on a download link, this extension captures relevant information (filename, context, file type) and sends it to the LBG Analytics tracking system. This enables insights into user interactions with downloadable resources, allowing for improved content strategies and analytics.

## 2. Code Explanation

### Key Variables
- **filename**: The name of the file being downloaded.
- **label**: The text label associated with the download link.
- **context**: Describes the context in which the file is downloaded; defaults to "Supporting Material" if not provided.
- **filetype**: Determines the file type based on the file extension. If not explicitly provided, it is derived from the filename.

### Logic Flow
1. **Event Listener Setup**: The extension sets up click event listeners for anchor (`<a>`) elements with links ending in `.pdf` and `.xls`.
2. **Download Event Handling**: Upon a click, the extension captures the link's `href` and text, and calls `LBGAnalytics.events.download`.
3. **Data Population**: The download event function populates the relevant variables and sends the data:
   - `ResourceFileName`: Set to the filename.
   - `ResourceFileType`: Set to the file type; defaults to derived value if not specified.
   - `ResourceFileContext`: Set to context; defaults to "Supporting Material".
   - `JourneyEvent`, `EventAction`, `EventNarrative`: Various tracking identifiers based on user interactions.
4. **Event Trigger**: Finally, it triggers a generic event with a specific ID (`140`).

### Dependencies
- **clova2**: Assumed to be a jQuery-like library that provides `$` functionality for DOM manipulation and events.
- **LBGAnalytics Object**: Global object used to handle analytics events and mapping.

## 3. Usage Examples

### Normal Use Case
- **Scenario**: A user clicks a link to download a PDF file.
  - The HTML might look like: `<a href="document.pdf">Download PDF</a>`
  - On clicking the link, the extension captures:
    - `filename`: `"document.pdf"`
    - `label`: `"Download PDF"`
    - `context`: `"Supporting Material"` (default)
    - `filetype`: `"pdf"` (derived from filename)
  - This information is sent to the LBGAnalytics.

### Edge Case
- **Scenario**: A user clicks a link to download an unsupported file type.
  - If a user clicks an `<a>` tag that does not comply with `.pdf` or `.xls`, the extension does not process the click, resulting in no analytics event being sent. 
  - Example: `<a href="document.docx">Download DOCX</a>` will not trigger the event.

## 4. Known Limitations & Gotchas

- The extension currently only listens for PDF and XLS file types. If users click on other file types, no data will be captured.
- Reliance on `clova2` means that if this library is not loaded or functional, the event tracking will fail.
- The extension currently lacks error handling for unexpected states (e.g., malformed link URLs or missing attributes).
- Modifications to the LBGAnalytics object require careful consideration to prevent tracking errors, as this could affect reporting.

## 5. Recommendations for Refactoring

- **Filetype Detection Improvement**: Use a more robust method for determining file types, possibly through a mapping of known file extensions, rather than relying on filename manipulation.
- **Code Modularity**: Refactor repetitive event listener code into a single function that accepts different file types as parameters.
- **Error Handling**: Introduce basic error handling or logging mechanisms, particularly to handle cases where click handlers might fail due to issues with the `clova2` library.
- **Comments and Documentation**: Add inline comments throughout the code to increase clarity for other developers who may work with this extension in the future.

## 6. Maintenance & Further Notes

- **Ownership**: The development team should assign a primary owner for this extension to ensure accountability for updates and troubleshooting.
- **Testing Guidelines**: Implement thorough testing protocols including unit tests for the download event logic, ensuring all expected file types are fully supported and monitored.
- **Ongoing Maintenance**: Regularly review and update the extension to adapt to changes in website structure, user behaviour, and analytics requirements. Monitor LBGAnalytics documentation for any changes in their event structure or mapped variables.

This documentation serves as a guide for current and future developers interacting with the Downloads extension in Tealium iQ. For further questions or implementation details, please consult the documentation team.