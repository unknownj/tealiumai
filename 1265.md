# Tealium iQ Extension Documentation: OBK Fixes (OLD JS)

## 1. Extension Overview

- **Name**: OBK Fixes (OLD JS)
- **ID**: 1265
- **Type**: Javascript Code
- **Scope**: After Load Rules
- **Execution Frequency**: Run Always

### Summary

The "OBK Fixes (OLD JS)" extension is designed to standardise the values of the `ProductGroup` property within the `eventPayload` object. It specifically targets product groups associated with car finance and credit cards, ensuring consistency in naming conventions throughout the tracking system. This extension runs every time an event is processed, addressing potential discrepancies and aiding in accurate data retrieval and reporting.

---

## 2. Code Explanation

### Key Variables

- **`eventType`**: This variable represents the type of the event being processed. It is a string that indicates the nature of the incoming data.
  
- **`eventPayload`**: This variable is an object containing the details associated with the event, particularly the `ProductGroup`, which is the focus of the extension logic.

### Logic Flow

1. The function is immediately invoked with `eventType` and `eventPayload` as parameters.
2. It checks if the `ProductGroup` property exists within the `eventPayload` object.
3. If `ProductGroup` exists, the script converts its value to lowercase and compares it against predefined strings:
   - If `ProductGroup` is "car finance" (case insensitive), it's transformed to "CarFinance".
   - If `ProductGroup` is either "credit cards" or "creditcard" (case insensitive), it's changed to "CreditCards".

The overall goal is to normalise specific `ProductGroup` values to adhere to a standard naming convention.

### Dependencies

- This extension does not import any external libraries or rely on global objects beyond standard JavaScript capabilities. It is self-contained and only processes the provided parameters.

---

## 3. Usage Examples

### Normal Condition

**Input:**
```javascript
var eventType = "purchase";
var eventPayload = { ProductGroup: "car finance" }; // Original Case
```

**Output:**
```javascript
// eventPayload after processing
// { ProductGroup: "CarFinance" }
```

### Edge Condition

**Input:**
```javascript
var eventType = "purchase";
var eventPayload = { ProductGroup: "CREDIT CARDS" }; // Uppercase
```

**Output:**
```javascript
// eventPayload after processing
// { ProductGroup: "CreditCards" }
```

**Input:**
```javascript
var eventType = "purchase";
var eventPayload = { ProductGroup: "some other product" }; // Unmatched Case
```

**Output:**
```javascript
// eventPayload remains unchanged
// { ProductGroup: "some other product" }
```

---

## 4. Known Limitations & Gotchas

- The extension currently only modifies the `ProductGroup` if it matches specific values. Any unexpected product group not explicitly defined in the checks will remain unchanged.
- There is no handling or logging for values that do not meet the specified conditions. If different product groups are used frequently, further modifications may be necessary.
- This extension may conflict with other extensions that alter the `ProductGroup` property if they are executed in the same processing cycle, leading to unpredictable results.

---

## 5. Recommendations for Refactoring

To improve the maintainability and clarity of the code, consider the following suggestions:

- **Modularisation**: Extract specific logic into named helper functions. For example, a `normalizeProductGroup` function could encapsulate the value transformation logic.
  
```javascript
function normalizeProductGroup(group) {
  switch (group.toLowerCase()) {
    case "car finance":
      return "CarFinance";
    case "credit cards":
    case "creditcard":
      return "CreditCards";
    default:
      return group; // Return original if no match
  }
}
```

- **Code Style**: Use consistent formatting and comments to explain the transformation steps better for future developers.

- **Documentation**: Extend inline comments to clarify the purpose and expected outcomes of each code segment, aiding future maintenance and updates.

---

## 6. Maintenance & Further Notes

- **Ownership**: Assign dedicated personnel to oversee the functionality and update of this extension. Regular reviews should align the extension with new requirements.
  
- **Testing Guidelines**: Implement unit tests to validate the behaviour of the code under various input scenarios. This will ensure reliability and ease of updates in the future.

- **Monitoring**: Incorporate logging or debugging statements to track how frequently the extension modifies `ProductGroup`. This can help identify if additional cases need to be handled.

This thorough documentation aims to assist current and future developers in understanding, maintaining, and enhancing the OBK Fixes (OLD JS) extension within Tealium iQ.