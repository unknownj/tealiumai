```markdown
# Tealium iQ Extension Documentation: Sensitive Query Strings

## 1. Extension Overview

- **Name**: Sensitive Query Strings
- **ID**: 1266
- **Type**: Advanced JavaScript Code
- **Scope**: After Load Rules
- **Execution Frequency**: Run Always

### Summary
The "Sensitive Query Strings" extension is designed to filter out specific sensitive parameters from the URL query string before sending data to analytics platforms. This is essential for maintaining user privacy and ensuring compliance with data protection regulations. It achieves this by redacting any parameters that may contain sensitive information, such as account details or card numbers.

---

## 2. Code Explanation

### Key Variables
- **a, b**: Function parameters representing the `eventType` and `eventPayload`.
- **qry**: A variable holding the original query string from the window's location.
- **output**: An array used to store the filtered query string components that do not contain sensitive parameters.

### Logic Flow
1. The `stripSensitive` function processes the query string:
   - Checks for any initial "?" and strips it for processing.
   - Splits the query string into individual parameter parts based on "&".
   - For each parameter, it determines if it should be redacted by checking it against a predefined array of sensitive parameter names.
   - If the parameter is not sensitive, it is added to the output array.
   - If redacted, a message is logged to the console.
   - Finally, if any parameters were removed, a count of the redacted parameters (`jwr`) is appended.

2. The result is constructed into a new query string with the remaining parameters, which is then set to `s.pageURL` along with other components of the URL.

### Dependencies
- Relies on the global `window.location` object to access the current URL.
- Utilises properties from the `b` object, specifically `CanonicalDomainProd` and `CanonicalPath`, which should be defined elsewhere in the script.

---

## 3. Usage Examples

### Normal Conditions
- **Input**: URL with query string `?account=123&item=abc&code=xyz`
- **Output**: `?item=abc&jwr=2` 
  - Here, both `account` and `code` are considered sensitive and are redacted.

### Edge Conditions
- **Input**: URL with no parameters `?`
- **Output**: `?`
  - The function properly handles empty query strings without errors.

- **Input**: URL with redundant parameters `???`
- **Output**: `?` 
  - Redundant question marks are safely managed, and the function gracefully returns an empty query string.

---

## 4. Known Limitations & Gotchas

- The extension assumes that the properties from the global `b` object (i.e., `CanonicalDomainProd` and `CanonicalPath`) are always present, which may not be the case in all environments.
- If the length of the query string exceeds standard limits, there could be unexpected behaviours, especially if other extensions manipulate the URL before or after this one is executed.
- The console logging statement will only execute in environments where the console is available (e.g., browsers). In non-browser environments, this may result in silent failures without error reporting.

---

## 5. Recommendations for Refactoring

- **Code Style**: Consistently format the code for better readability (e.g., spacing around operators).
- **Modularization**: Consider isolating the `toAlpha` and `stripSensitive` functions into separate functions to enhance clarity and reusability of each independent logic unit.
- **Defensive Checks**: Although the presence of `eventType` and `eventPayload` is guaranteed, consider adding checks to ensure `window.location.search` is always string type and has valid syntax before processing.
- **Parameter Array**: Consider externalising the `redactedParams` array to a configuration file or object to make it easier to update the set of sensitive parameters without altering the main logic.

---

## 6. Maintenance & Further Notes

- **Ownership**: Designate a specific developer or team responsible for this extension, ensuring they are familiar with the privacy policies and data handling regulations relevant to your organisation.
- **Testing Guidelines**: Regularly test with different query string scenarios to ensure all edge cases are covered. Implement a regression test suite that includes various query parameters to check the extension's behaviour.
- **Logging**: Consider adding a more robust logging strategy for production use, optionally allowing toggling of log verbosity to avoid cluttering console outputs in production environments.

---
```
This markdown format is structured to provide comprehensive documentation covering all necessary aspects of the Tealium iQ extension. Feel free to adjust any sections as necessary to fit your specific needs or style preferences.