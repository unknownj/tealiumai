# Tealium iQ Extension Documentation

## 1. Extension Overview

- **Name**: OVA : TAG : Set : Halifax : Event Listeners : Mortgage
- **ID**: 1450
- **Type**: Javascript Code
- **Scope**: 1214
- **Execution Frequency**: Active

### Summary
This extension is designed to create and manage a Virtual Assistant (VA) interface that facilitates user interactions for mortgage-related inquiries. It listens for specific user actions on webpage elements (clicks) and subsequently logs these events to Tealium using the `utag.link` method. The primary purpose is to enhance user engagement and track user interactions effectively, feeding valuable data back into the analytics ecosystem.

## 2. Code Explanation

### Key Variables
- `c$`: A reference to jQuery, accessed as `window.clova2.$`.
- `VAMD`: An object that encapsulates the Virtual Assistant functionality, including configuration, event handlers, and helper methods.

### Logic Flow
1. **Container Creation**: The `createCVContainer` function generates a `<div>` with an ID of `virtual-assistant` to hold the VA interface.
2. **Event Handlers**: The `createCVEventHandlers` function sets up click event handlers for different interaction points:
   - Clicking the trigger element expands the VA interface.
   - Clicking the submit button logs the user's input to Tealium.
   - Clicking on FAQ items tracks which links were accessed.
3. **Loading the VA**: The `loadCV` function initializes the VA, managing script loading and user interactions:
   - It defines functions for asking questions (`ask_question`) and handling navigation (`bot_nav`).
   - It manages the loading of template and related scripts necessary for the VA's functionality.

### Dependencies
- **Global Objects**: The extension relies on the following global objects:
  - `window.clova3`: Used for logging
  - `window.utag`: Used for sending data to Tealium
- **Libraries**: The extension expects that jQuery (named as `cvjq`) is available globally.

## 3. Usage Examples

### Scenario 1: Expanding the VA Interface
- **Action**: User clicks the "Ask us" button.
  - **Flow**: The click is captured by the event handler, triggering a Tealium link event with `JourneyName: "VirtualAssistant"` and `JourneyStep: 1`.

### Scenario 2: Submitting a Query
- **Action**: User enters a query in the input field and clicks the "Submit" button.
  - **Flow**: The input value is retrieved and a Tealium link event is sent with `JourneyStep: 2` detailing the user's input.

### Edge Condition: Disable submit button with empty input
- **Expected Behaviour**: If the input field is empty and the submit button is clicked, no Tealium event should be sent.
- **Current Limitation**: The current code does not prevent submitting empty input, potentially leading to incomplete data being captured.

## 4. Known Limitations & Gotchas

- **Browser Compatibility**: The extension may not function as intended on Internet Explorer as the user agent check disables loading in that browser.
- **Performance**: A hardcoded timeout of 3000 ms before setting up event handlers may delay user interactions.
- **Accessibility**: ARIA roles and attributes are used, but additional accessibility checks may be necessary for optimal usability.
- **External Conflicts**: The use of `$` and global variable manipulation may conflict with any other libraries or frameworks that also use the `$` convention.

## 5. Recommendations for Refactoring

- **Code Modularity**: Consider breaking large functions into smaller, reusable functions to improve clarity and maintainability.
- **Error Handling**: Introduce error handling for AJAX requests to aid debugging and provide fallbacks.
- **Defensive Checks**: Ensure input fields are validated before submissions (e.g., checking if the input is not empty).
- **Event Throttling**: Implement throttling on events where applicable to minimize performance overhead.
  
## 6. Maintenance & Further Notes

- **Ownership**: Assign a primary developer for ongoing updates and oversight.
- **Version Control**: Use Git for version tracking and maintaining updates.
- **Testing Guidelines**: Implement a consistent testing strategy, including regression and user acceptance testing before deploying updates.
- **Documentation Updates**: Ensure this document is updated alongside code changes to maintain its accuracy for future developers.

This documentation serves as a comprehensive resource for understanding and maintaining the Virtual Assistant extension within the Tealium iQ platform.