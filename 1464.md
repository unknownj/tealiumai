# Tealium iQ Extension Documentation: GForms Override

## 1. Extension Overview
- **Name**: GForms Override
- **ID**: 1464
- **Type**: Advanced Javascript Code
- **Scope**: 928
- **Execution Frequency**: On page load or relevant event triggers

### Summary
The **GForms Override** extension is designed to handle specific forms on the `/a/gforms` and `/a/common/gforms` paths. It monitors the journey of users through various stages of form interactions, saving relevant data to `localStorage` for later retrieval. This functionality facilitates data tracking and analytics that enable more informed decision-making based on user interactions with the forms.

## 2. Code Explanation
### Key Variables
- **formToJourney**: An object mapping specific form IDs (e.g., "F065") to a corresponding journey name ("Loan Repayment Holiday").
- **journeyStep**: An integer that tracks the user's progress through the form journey depending on the URL path.
- **GFormsData**: An object that encapsulates methods for saving, loading, and setting journey-related data in `localStorage`.

### Logic Flow
1. The code first checks if the current URL includes the paths specific to the GForms. If the URL contains `gformscwm.jsp`, it exits early.
2. It determines the user's journey step based on the URL path:
   - Step 1 for multi-step forms, Step 2 for outcome paths, and Step 0 for review or hub pages.
3. Data is loaded from `localStorage` if the journey step is greater than 1.
4. It extracts the current form ID from the page's scripts and the form name from the page's header.
5. The extracted data is stored in the `GFormsData` object with relevant keys:
   - **JourneyName**: Combines the form ID and name.
   - **JourneyProduct**: Stores the form ID.
   - **JourneyStep**: Records the current step.
   - **JourneyStepName**: Saves the name of the current step.
6. The properties of the `GFormsData` object are then attached to the global `tagObject` for further use.

### Dependencies
The extension uses jQuery for DOM manipulation (e.g., accessing scripts and heading elements). Ensure that jQuery is enabled in your Tealium environment when this extension runs.

## 3. Usage Examples
### Normal Conditions
- On accessing a multi-step GForm (`/a/gforms/...`):
  - The extension saves the journey name as "GForm Loan Repayment Holiday".
  - If a user moves to the third step of the form, the journey step is updated, and data is saved accordingly.

### Edge Conditions
- If a user accesses a form URL not defined in the paths (not a GForm), the extension will not execute any behaviour as it filters out irrelevant paths.
- If thereâ€™s an error loading from `localStorage`, data operations continue without interruption, as there is a try-catch surrounding the load function.

## 4. Known Limitations & Gotchas
- **Error Handling**: While there is basic error handling for JSON parsing and data loading, extensive errors are not logged or managed; consider implementing logging for tracking errors.
- **Scope Issues**: The use of `localStorage` may pose limitations on browsers with strict privacy settings; users could lose data if cookies or `localStorage` are blocked.
- **jQuery Dependency**: The extension assumes that jQuery is always available. If it's removed from the environment, the extension will break.
- **Conflicts with Other Scripts**: Name collisions may occur if other scripts manipulate the same global variables or localStorage keys.

## 5. Recommendations for Refactoring
- **Defensive Checks**: Incorporate checks to ensure keys exist before loading from `localStorage`, potentially preventing errors when accessing undefined values.
- **Code Readability**: Improve code readability by defining constants for the form IDs and journey steps rather than hardcoding them within the logic.
- **Encapsulation**: Consider wrapping the main function in an IIFE (Immediately Invoked Function Expression) to limit the scope of variables and avoid polluting the global space.

## 6. Maintenance & Further Notes
- **Ownership**: Assign a dedicated developer or team responsible for maintaining this extension, ensuring consistent updates and oversight.
- **Testing Guidelines**: Regularly conduct unit tests after updates to verify all functionalities perform as expected. Use various forms and scenarios to simulate user interactions.
- **Documentation Updates**: Keep this documentation updated whenever modifications to the extension are made, ensuring all stakeholders are informed of changes.

This documentation is intended to provide a clear understanding of the GForms Override extension, its functionality, and how it interacts with the rest of the Tealium iQ environment, ensuring seamless data tracking and analytics.