# Tealium iQ Extension Documentation: OCIS ID

## Extension Overview
- **Name**: OCIS ID
- **ID**: 100040
- **Type**: Advanced Javascript Code
- **Scope**: After Load Rules
- **Execution Frequency**: Run Always

### Summary
The OCIS ID extension is designed to capture and assign the OCIS ID from specific input elements on a webpage. It ensures that the OCIS ID is converted to a standard format and that it is associated with the `OtherCustomerID` and `OtherCustomerIDType` fields. This extension is crucial for maintaining data consistency when interacting with customer identifiers in marketing or analytics tools.

---

## Code Explanation

### Key Variables
- `a`: This variable is a placeholder for the `eventType` parameter passed into the function.
- `b`: This variable references the `eventPayload`, providing a context for storing data related to the event.

### Logic Flow
1. **Initialisation of OCISID**:
   - The extension attempts to assign a value to `b.OCISID` from:
     - An input element with the name `ocisId` via `clova2.$`.
     - An attribute from an element with the ID `o4bPartyEntityId`.
   - If both sources do not provide a value, `b.OCISID` remains `undefined`.

2. **Correct Capitalisation**:
   - A loop iterates through all keys in the object `b`. If a key in lower case matches "ocisid" (but isn’t already "OCISID"), and `b.OCISID` is still `undefined`, it assigns the value of this key to `b.OCISID`. This addresses potential capitalisation issues.

3. **Setting OtherCustomerID**:
   - If `b.OtherCustomerID` is not already defined and `b.OCISID` has a valid value, it assigns `b.OCISID` to `b.OtherCustomerID`.
   - The `OtherCustomerIDType` is set to "OCIS" to indicate the type of ID stored.

### Dependencies
- The code relies on the `clova2` library to access certain DOM elements. Ensure that this library is loaded before invoking this extension to prevent errors.

---

## Usage Examples

### Normal Flow
1. A user visits the webpage with an input named `ocisId` that contains the value "123456".
   - The extension captures this value and sets `b.OCISID` to "123456".
   - If no `OtherCustomerID` is present, then `b.OtherCustomerID` becomes "123456", and `b.OtherCustomerIDType` is set to "OCIS".

### Edge Conditions
1. If the `ocisId` input isn’t present and the `o4bPartyEntityId` element has a value of "654321":
   - The script will still check the element's value, and if found, it will set `b.OCISID` correctly.

2. If there is another key in `b` named "ocisId" (case-sensitive) which equals "789012":
   - Since it does not match "OCISID" in terms of case, the key will be ignored and `b.OCISID` remains unaffected if it has already been assigned from the input.

3. If a user has previously set `b.OtherCustomerID`, the extension does not overwrite it.

---

## Known Limitations & Gotchas
- This extension does not handle scenarios where both elements (`ocisId` input and `o4bPartyEntityId`) might be absent.
- If the input names change, or the structure of the HTML changes, the extension will fail to capture the OCIS ID.
- There may be conflicts if multiple scripts attempt to modify `b.OtherCustomerID` concurrently or if other extensions manipulate the same objects without proper coordination.

---

## Recommendations for Refactoring
- **Defensive Checks**: Consider encapsulating DOM access in a function to handle cases where the input elements might be missing without throwing errors.
- **Code Clarity**: Introduce comments at critical junctions in the code for enhanced readability.
- **Modularisation**: Break out the ID retrieval logic into a separate function that can be reused, which will enhance maintainability and readability without altering the functionality.
- **Consistent Naming**: Ensure that casing for variable names aligns throughout the codebase to avoid confusion and bugs (e.g., using always `b.OCISID`).

---

## Maintenance & Further Notes
- **Ownership**: It is recommended that a designated developer should oversee the maintenance of this extension, ensuring it stays functional as the website evolves.
- **Testing**: Regularly test the extension with various sets of input data to confirm correct functionality, including edge cases.
- **Documentation Updates**: Keep this documentation up-to-date with any changes made to the code to ensure it remains a reliable resource for future developers.

--- 

This documentation should be viewed as a living document, updated in alignment with any modifications in business logic, and is encouraged to be shared across development teams for knowledge transfer and support.