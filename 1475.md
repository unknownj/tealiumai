# Tealium iQ Extension Documentation: SCEP Search

## 1. Extension Overview

- **Name**: SCEP Search
- **ID**: 1475
- **Type**: Advanced JavaScript Code
- **Scope**: DOM Ready
- **Execution Frequency**: Run Once

### Summary
The "SCEP Search" extension is designed to track user interactions with a search overlay on a designated search page (`/search.html`). It captures the opening and closing actions of the search overlay and sends relevant search data to the `LBGAnalytics` tracking framework. The extension ensures that valuable insights into user behaviour and interactions with the search functionality are captured for analytics purposes.

---

## 2. Code Explanation

### Key Variables
- `results`: This variable holds the number of search results detected on the page, extracted from the DOM.
- `window.location.pathname`: Used to determine if the current page is the search page.
- `window.location.search`: Used to extract any search query parameters from the URL.

### Logic Flow
1. The extension binds click event handlers to three buttons:
   - **Search Open Button** (`#search-click`): Triggers an event when the search overlay is opened.
   - **Search Close Button** (`button.search-close`): Triggers an event when the search overlay is closed.
   - **Search Submit Button** (`button.search-btn`): Currently has no logic defined.

2. Upon page load (when the DOM is ready), the extension checks if the user is on the search page (`/search.html`) and whether a search query is present in the URL.
3. If a search query exists, the results count is derived from the DOM, specifically the number of specific `<b>` tags within `div.search-info`.
4. An event is then sent to `LBGAnalytics` capturing the search term, its type, the location of the search, and the number of results.

### Dependencies
The extension relies on:
- jQuery (accessed via `window.clova2.$`).
- The `LBGAnalytics` library to send event data.

---

## 3. Usage Examples

### Normal Scenario
- **User Action**: A user clicks on a button with the ID `search-click` to open the search overlay.
- **Expected Behaviour**: An event indicating that the search overlay has opened is captured and sent to `LBGAnalytics`.

### Edge Conditions
- **No Results Scenario**: If no search results are found or available on the page, the variable `results` may not be properly populated. Ensure that the DOM structure is adequate for the expected extraction logic.
- **Malformed Query Parameter**: If the search query in the URL is malformed or improperly encoded, the `decodeURIComponent` method may throw an error. However, in the current code structure, this is managed with a try-catch block.

---

## 4. Known Limitations & Gotchas

- **Incomplete Logic for Search Submit Button**: The button with class `search-btn` does not have any logic implemented. This may result in a missed opportunity to track searches initiated by button clicks.
- **Dependency on DOM Structure**: The results count extraction relies on a specific DOM structure (`div.search-info b`). Any changes to this structure may break functionality.
- **Non-specific Error Handling**: Catch blocks simply log errors without handling them appropriately or notifying developers, potentially making debugging challenging.
- **Potential Conflicts with Other Extensions**: If other extensions manipulate the same buttons or DOM elements, it may lead to unexpected behaviours or conflicts.

---

## 5. Recommendations for Refactoring

- **Implement Logic for Search Submit Button**: Add event logic to track when searches are submitted via the `search-btn` button to ensure comprehensive tracking.
- **Enhanced Error Handling**: Consider logging errors to a central logging system or displaying console errors to aid debugging during development.
- **Refine DOM Selector Logic**: Introduce checks to ensure the expected DOM structure exists before attempting to extract information to reduce the risk of runtime errors.
- **Modularisation**: Consider breaking down the extension into smaller functions for clarity and reusability.
- **Code Comments**: Add comments to explain complex logic for future developers who may maintain the code.

---

## 6. Maintenance & Further Notes

- **Ownership**: The extension should be owned by the analytics team to ensure consistent utilisation and updates as required.
- **Ongoing Maintenance**: Ensure regular checks are made for any changes in the DOM that may impact the extraction logic. Schedule periodic reviews of the extension's performance and its tracking accuracy.
- **Testing Guidelines**: Maintain a deployment test plan to validate the extension in different environments before and after deployments. Focus particularly on ensuring the tracking mechanism is firing correctly as expected.

--- 

*This documentation is intended to provide a comprehensive overview and guide for developers working with the SCEP Search Tealium iQ extension, ensuring clarity, maintainability, and robustness of the code.*