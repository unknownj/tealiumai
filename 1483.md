# Tealium iQ Extension Documentation: GA360 : Set GA360ClientID

## 1. Extension Overview
- **Name**: GA360 : Set GA360ClientID
- **ID**: 1484
- **Type**: Set Data Values
- **Scope**: 1258, 1398, 1402, 1413, 1401
- **Execution Frequency**: Active

### Summary
This extension extracts the Client ID from the `_ga` first-party cookie, which serves as a user-level identifier. It primarily maps various user data attributes to corresponding keys for use within Google Analytics 360. This helps in tracking user behaviour and segmentation for enhanced marketing insights.

---

## 2. Code Explanation

### Key Variables
- `mapping`: An object that defines the relationship between user data attributes (keys) and their corresponding target keys (values) to be sent to Google Analytics. 

### Logic Flow
1. The `mapping` object is defined to pair user data attributes (like `Brand`, `ProductGroup`, etc.) with their respective identifiers.
2. A loop iterates over each key in the `mapping` object, setting the corresponding value in the `u.map` object. This operation prepares the data for further processing.
3. The property `CelebrusLeadData` is then added to the `u.map` object, which is assigned the value "Responses" indicating that this extension is also involved with handling lead data.
4. The values of `CookiesTargeting` and `CookiesPerformance` are cast to boolean (true/false) to be appropriately handled in further analysis.

### Dependencies
- The code relies on the following global objects:
  - `udo`: The Universal Data Object which contains various user data attributes.
  - `eventType`: A string representing the type of event being processed.
  - `eventPayload`: An object containing the payload related to the event.
  - `tagObject`: An object used to interact with the tags defined in Tealium.

---

## 3. Usage Examples

### Normal Scenario
- **Scenario**: A user visits a product page.
- **Data Flow**: The extension captures attributes related to the product journey such as `Brand`, `ProductGroup`, and maps them to the required identifiers. The corresponding data will be sent to Google Analytics for tracking.

### Edge Conditions
- **Scenario**: If the mapping for a given user attribute is not found.
    - **Expected Behaviour**: The extension will skip setting that value in `u.map`, ensuring it does not throw an error or stop execution.
- **Scenario**: If `_ga` cookie is absent.
    - **Expected Behaviour**: No data related to the client ID can be extracted, leaving the Google Analytics tracking incomplete for that user session.

---

## 4. Known Limitations & Gotchas
- The extension assumes that the `_ga` cookie will be present and correctly formatted. If malformed, the extraction will not work as intended.
- Dependencies on `udo` and other objects make the extension fragile to changes in the structure of the global data layer.
- Potential conflicts with other Tealium extensions that also manipulate the same data attributes could lead to unpredictable results. Care should be taken to coordinate between extensions.

---

## 5. Recommendations for Refactoring
- **Defensive Checks**: Although the requirement specifies that `eventType` and `eventPayload` will always be present, implementing checks to verify the integrity of the `udo` object could prevent runtime errors.
- **Code Style**: The code should follow consistent naming conventions; consider using a well-defined format for keys in the mapping object.
- **Modularisation**: Break down the long function into smaller, self-contained functions. For instance, the mapping logic can be encapsulated in its function to enhance readability.

---

## 6. Maintenance & Further Notes
- **Ongoing Maintenance**: Regularly update the mapping object as new data attributes are defined in user tracking. Ensure backward compatibility when changes are made.
- **Ownership**: Assign a developer as the primary owner for this extension, who is responsible for monitoring its performance and ensuring its correctness.
- **Testing Guidelines**: Establish a methodology for testing the functionality of this extension after every major change to the data layer or related extensions. Utilize both unit tests and integration tests wherever possible.

---

This comprehensive documentation covers the essential aspects of the GA360 : Set GA360ClientID extension to assist developers and stakeholders in understanding, maintaining, and utilising this Tealium iQ extension effectively.