# Tealium iQ Extension Documentation: Celebrus GForms Integration

## 1. Extension Overview
- **Name**: Celebrus GForms Integration
- **ID**: 1536
- **Type**: Advanced Javascript Code
- **Scope**: DOM Ready
- **Execution Frequency**: Run Once

### Summary
The **Celebrus GForms Integration** extension is designed to track form interactions within specific Google Forms and CWR Hub pages. It captures relevant data such as form IDs and user inputs, and sends this data to the Celebrus analytics platform. This integration allows for enhanced tracking of user journey and form engagement, thereby providing insights into user behaviour and improving the overall analytics framework.

---

## 2. Code Explanation

### Key Variables
- `gFormsCelebrusIntegration`: A flag that determines the type of integration based on the webpage URL.
- `pathParts`: An array to hold the segments of the URL path, utilized in identifying form IDs.
- `LBGAnalytics`: Assumed to be a library for handling analytics; details about its structure and implementation are not included.

### Logic Flow
1. **Determine Integration Type**:
   - The extension checks the current URL path to identify if it relates to Google Forms or the CWR Hub.
   - Sets the `gFormsCelebrusIntegration` variable accordingly to either "G" or "C".

2. **Set Datalayer Values**:
   - If the integration is identified as "G", the code extracts the Form ID from the URL and sets it in the `clova3.datalayer`.
   - For "C", a default value of "CWR" is set for the Form ID.
   - A unique `CelebrusJourneyID` is generated using a random UUID format.

3. **Track Input Changes**:
   - An event listener is attached to all `input` and `select` elements within the document.
   - On any change event, the extension gathers the form information (Form ID, Journey ID, element name, and value).
   - It then sends this information to the Celebrus analytics platform via the `utag.track` function, mapping the recorded data to specific keys such as `CelebrusFormID`, `CelebrusJourneyID`, and others.

### Dependencies
- The extension relies on the following global objects and libraries:
  - `LBGAnalytics`: An assumed jQuery-like library providing functionality for DOM manipulation and event handling.
  - `clova3`: An assumed global object that interacts with a data layer for the Celebrus platform.
  - `utag`: A global object provided by Tealium, essential for sending tracked events to the analytics system.

---

## 3. Usage Examples

### Example 1: Normal Operation
- **Scenario**: A user accesses a Google Form page `/gforms/F12345`.
- **Behavior**: The extension sets the `CelebrusFormID` to `12345`. Upon changing any input field, the relevant data is sent to Celebrus:
  - `CelebrusFormID`: `12345`
  - `CelebrusJourneyID`: (Random UUID)
  - `CelebrusElementName`: "name_of_field"
  - `CelebrusElementValue`: "user_input_value"

### Example 2: CWR Hub Interaction
- **Scenario**: A user accesses the CWR Hub page `/cwr-hub/`.
- **Behavior**: The extension sets the `CelebrusFormID` to `CWR`. Input changes will send data accordingly:
  - `CelebrusFormID`: `CWR`
  - `CelebrusJourneyID`: (Random UUID)
  - `CelebrusElementName`: "name_of_field"
  - `CelebrusElementValue`: "user_input_value"

### Edge Conditions
- If the URL does not correspond to either Google Forms or CWR Hub, the integration does not execute, and no data will be tracked or sent.

---

## 4. Known Limitations & Gotchas
- **URL Structure Dependency**: The extension relies heavily on URL structure. Any changes to the URL routing of Google Forms or CWR Hub may break functionality.
- **Missing Libraries**: If `LBGAnalytics` or `clova3` is not present or incorrectly configured, the extension will fail to initialize or track data.
- **Browser Compatibility**: If users have JavaScript disabled or are using very old browsers, this extension will not function as intended.

---

## 5. Recommendations for Refactoring
- **Error Handling**: Consider adding conditions to verify that required global objects (`clova3`, `LBGAnalytics`, and `utag`) exist before usage.
- **Modular Approach**: Refactor the code into functions for modularity and readability. For instance, separate functions for checking URL paths, setting datalayer values, and tracking events could enhance maintainability.
- **Code Clarity**: Enhance variable naming for better readability. For example, rename `gFormsCelebrusIntegration` to `formIntegrationType`.
- **Comments**: Consider adding comments to complex logic blocks explaining their purpose, especially in the random UUID generation.

---

## 6. Maintenance & Further Notes
- **Maintenance Ownership**: Assign ownership to a specific team member or group responsible for the ongoing upkeep of this extension. Ensure they are familiar with all dependencies and the overall functionality.
- **Testing Guidelines**: Regularly test the extension after updates to the website or related libraries, particularly after significant changes to forms or the data layer.
- **Version Control**: Keep track of changes via version control to ensure an appropriate rollback process is in place in case of production issues.

---

This documentation serves as a comprehensive guide for developers and stakeholders interacting with the Celebrus GForms Integration extension. For future enhancements or troubleshooting, refer to the sections outlined above.