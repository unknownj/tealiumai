# Tealium iQ Extension Documentation

## 1. Extension Overview

- **Name**: Workday Link Tracking
- **ID**: 100040
- **Type**: Advanced JavaScript Code
- **Scope**: DOM Ready
- **Execution Frequency**: Run Once

### Summary
The Workday Link Tracking extension is designed to track clicks on external links that contain "workday" in their href attribute. When a user clicks such a link, the extension captures the event and sends a structured tracking event to the LBGAnalytics library. This functionality facilitates the monitoring of user interactions with the Workday site, enabling better analysis of user behaviour and engagement with external resources.

## 2. Code Explanation

### Key Variables
- `var $ = LBGAnalytics.$;`
  - This line assigns an alias `$` to the jQuery-like syntax provided by the LBGAnalytics library. It enables the manipulation of the DOM for event handling.

### Logic Flow
1. The code initiates by waiting for the Document Object Model (DOM) to be fully ready.
2. It attaches a click event handler to all anchor (`<a>`) elements whose `href` attribute contains the string "workday".
3. When such an anchor is clicked:
   - A tracking event is sent to the LBGAnalytics library containing:
     - `JourneyEvent`: A constant string indicating the type of event.
     - `EventAction`: Specifies the action as "Offsite Link".
     - `EventNarrative`: Retrieves the text of the clicked link for a description of what was clicked.
     - `ResourceFileName`: Captures the actual URL of the clicked link.

### Dependencies
- The extension relies on the **LBGAnalytics** library, specifically its `$` variable which should be properly initialized before this code is executed. Ensure that the library is included in the page to avoid JavaScript errors.

## 3. Usage Examples

### Normal Conditions
1. A user clicks on a link to "Workday - Employee Portal":
   - The event sent would have:
     - `JourneyEvent`: "External Click"
     - `EventAction`: "Offsite Link"
     - `EventNarrative`: "Workday - Employee Portal"
     - `ResourceFileName`: "https://www.workday.com/employee-portal"

### Edge Conditions
1. If a link exists with the text "Workday Dashboard" but does not contain the word "workday" in its href:
   - No event is sent, as the click does not trigger the conditions.
  
2. If multiple links with "workday" in their href are clicked rapidly:
   - Events are sent sequentially as each click causes the handler to execute independently, but the condition must be matched for each event.

## 4. Known Limitations & Gotchas

- **Selector Performance**: The selector `$("a[href*=workday]")` may have performance implications on pages with a large number of anchor tags. It is advisable to limit the number of anchor elements the script needs to evaluate.
  
- **Event Propagation**: Ensure that there are no other event handlers on the same links that prevent proper propagation of click events which might affect the tracking.

- **Overlapping Click Events**: If multiple click event handlers are registered on the same link elements, there may be interference in event handling, leading to unexpected behaviours.

## 5. Recommendations for Refactoring

- **Defensive Checks**: Include checks to ensure the `$(this)` object is valid before manipulating DOM properties, although basis checks for `eventType` and `eventPayload` are guaranteed.

- **Code Style**: To improve readability, consider adding comments to explain each block's purpose within the function.

- **Modularization**: Separate the event tracking logic into its own function, allowing for reuse elsewhere if similar tracking is needed in different contexts. This will also help with testing individual pieces of code independently.

### Suggested Refactor
```javascript
// Function to handle Workday link clicks
function handleWorkdayLinkClick() {
  var eventData = {
    JourneyEvent: "External Click",
    EventAction: "Offsite Link",
    EventNarrative: $(this).text(),
    ResourceFileName: $(this).attr("href")
  };
  
  LBGAnalytics.events.send(eventData);
}

$("a[href*=workday]").click(handleWorkdayLinkClick);
```

## 6. Maintenance & Further Notes

### Ongoing Maintenance
- Regularly review the extension as part of a broader analytics audit process to ensure it remains functional after website updates or changes in the LBGAnalytics library.

### Ownership
- Assign a specific owner or team responsible for updates and documentation to ensure accountability and ongoing support.

### Testing Guidelines
- Conduct user testing to ensure click events are captured accurately.
- Employ unit tests if possible, particularly after any changes, to verify that the event sending logic works as expected.

This documentation is intended for internal use and should be regularly updated to accommodate code changes or enhancements as necessary.