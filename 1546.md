# Tealium iQ Extension Documentation

## 1. Extension Overview

- **Name**: Step Number Offset
- **ID**: 100040
- **Type**: Advanced Javascript Code
- **Scope**: After Load Rules
- **Execution Frequency**: Run Always

### Summary
The **Step Number Offset** extension is designed to modify the `JourneyStep` variable by applying an offset value found in `JourneyStepOffset`. This enables tracking systems to calculate the effective journey step based on predefined offset values, seamlessly integrating step calculations for analytics and reporting purposes.

## 2. Code Explanation

### Key Variables
- **`toNumber`**: This local function converts various data types to a numerical value. It checks the type of input and confirms it is a valid number.
- **`js`**: Represents the current JourneyStep, converted to a number.
- **`jso`**: Represents the JourneyStepOffset, converted to a number.

### Logic Flow
1. The `toNumber` function is defined to convert inputs to a number or return `false` if conversion fails.
2. The extension attempts to extract the values for `JourneyStep` and `JourneyStepOffset`:
   - Both values are converted to numbers using the `toNumber` function.
3. If both `JourneyStep` (`js`) and `JourneyStepOffset` (`jso`) are valid numbers:
   - The `JourneyStep` is updated by adding the `JourneyStepOffset`.
   - The `JourneyStepOffset` is then deleted from the payload to prevent further usage.

### Dependencies
- The code does not rely on any external libraries; it operates solely on basic JavaScript and assumes that the global `eventType` (string) and `eventPayload` (object) are available.

## 3. Usage Examples

### Normal Condition
1. Suppose `JourneyStep` is set to `5` and `JourneyStepOffset` is set to `3`.
2. When the extension runs:
   - `js` will be `5`
   - `jso` will be `3`
   - `JourneyStep` becomes `8`.

### Edge Case Conditions
1. If `JourneyStep` is `5` but `JourneyStepOffset` is `NaN`:
   - `js` will be `5`
   - `jso` will be `false`
   - The extension will not make changes to `JourneyStep`.

2. If `JourneyStep` is a string (e.g., `"10"`) and `JourneyStepOffset` is `2`:
   - `js` will evaluate to `10`
   - `jso` will evaluate to `2`
   - So, `JourneyStep` results in `12`.

## 4. Known Limitations & Gotchas

- **Type Handling**: The `toNumber` function may return `false` for inputs that are not purely numeric or cannot be parsed into numbers, leading to potential issues if not handled correctly in the data flow.
- **Unanticipated Data Formats**: If `JourneyStep` or `JourneyStepOffset` contain unexpected data types (such as objects or arrays), the extension may fail to work as intended.
- **Execution Timing**: It is essential to ensure that this extension is executed after all relevant variables (especially `JourneyStep` and `JourneyStepOffset`) are defined in the event payload.

## 5. Recommendations for Refactoring

- **Code Modularity**: The `toNumber` function can be further modularised or moved to a utility library if there are other extensions needing similar functionality.
- **Explicit Variable Naming**: Renaming variables for clarity, e.g., `journeyStepValue` instead of `js`, may improve readability.
- **Comments for Clarity**: Adding comments in the code can help future maintainers understand the logic flow without diving deep into the functionality.
- **Testing Scenarios**: Implement a more extensive suite of test cases to handle edge conditions where input may not be as predictable.

## 6. Maintenance & Further Notes

- **Ownership**: Assign a specific team member or group as the owner responsible for the upkeep of this extension.
- **Regular Testing**: Schedule regular intervals to test this extension against updated data to ensure ongoing compatibility and performance.
- **Documentation Updates**: Encourage contributors to keep the documentation current with any changes made to the extension or business logic.

By maintaining thorough documentation and clear guidelines for ongoing management, the Step Number Offset extension can serve its purpose effectively while ensuring that developers understand its functionality and impact.