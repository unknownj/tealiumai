# Tealium iQ Extension Documentation

## 1. Extension Overview

- **Name**: Hotfix for Commercial Onboarding PII
- **ID**: 1570
- **Type**: Javascript Code
- **Scope**: After Load Rules
- **Execution Frequency**: Run Always

### Summary
This extension aims to sanitize Personally Identifiable Information (PII) from certain customer identifiers within the event payload of the Tealium data layer. It specifically targets `RetailCustomerID` and `BusinessCustomerID` fields. If either of these fields contains an "@" character (suggesting they may contain email addresses or other sensitive data), they will be cleared out. This is crucial for maintaining compliance with data protection regulations and ensuring sensitive information is not inadvertently shared.

---

## 2. Code Explanation

### Key Variables
- `a`: Represents the `eventType` which is assured to be a string.
- `b`: Represents the `eventPayload` which is guaranteed to be an object.

### Logic Flow
1. The IIFE (Immediately Invoked Function Expression) checks the data sent in via `eventPayload`.
2. It verifies whether `RetailCustomerID` is a string and contains an "@" character.
   - If true, the value of `RetailCustomerID` is set to an empty string.
3. The same check and action are performed for `BusinessCustomerID`.

### Global Dependencies
- This code relies on the existence of the `eventType` and `eventPayload` variables as part of the Tealium execution context. No external libraries are used in this extension.

---

## 3. Usage Examples

### Normal Condition
When an event with the following payload is processed:
```javascript
{
  "RetailCustomerID": "customer@example.com",
  "BusinessCustomerID": "business@example.org"
}
```
After the extension processes this payload:
```javascript
{
  "RetailCustomerID": "",
  "BusinessCustomerID": ""
}
```
Both identifiers are cleared as they contained the "@" symbol.

### Edge Condition
If the payload looks like:
```javascript
{
  "RetailCustomerID": "randomString123",
  "BusinessCustomerID": "anotherRandomString456"
}
```
The extension will leave the identifiers unchanged:
```javascript
{
  "RetailCustomerID": "randomString123",
  "BusinessCustomerID": "anotherRandomString456"
}
```
No action is taken since neither identifier contains an "@" symbol.

---

## 4. Known Limitations & Gotchas

- **Non-String Values**: If `RetailCustomerID` or `BusinessCustomerID` are not strings, the extension will not alter their values, which can be problematic if non-string types are unintended.
- **Event Payload Size**: If the size of the event payload is particularly large, ensure that the performance of the extension is monitored, although this single extension does not heavily impact large objects due to its simplicity.
- **Potential Conflicts**: Other extensions that manipulate the same properties in the `eventPayload` may create unexpected results. It is advisable to document the usage of this extension alongside any competing extensions.

---

## 5. Recommendations for Refactoring

- **Modularization**: Like functions could be defined for the sanitisation process for `RetailCustomerID` and `BusinessCustomerID` to improve readability and allow for easier testing.
- **Defensive Checks**: While it is confirmed that `eventType` and `eventPayload` will always be available, adding checks to ensure that the expected properties exist within `eventPayload` can help prevent future issues.
- **Code Comments**: Including more comments that explain why each part of the code exists can assist future developers who will maintain the extension.

Example of a modular version:
```javascript
(function(a,b){
    function sanitizeCustomerID(customerID) {
        if (typeof customerID === "string" && customerID.indexOf("@") > 0) {
            return "";
        }
        return customerID;
    }

    b.RetailCustomerID = sanitizeCustomerID(b.RetailCustomerID);
    b.BusinessCustomerID = sanitizeCustomerID(b.BusinessCustomerID);
})(eventType, eventPayload);
```

---

## 6. Maintenance & Further Notes

- **Ownership**: Assign an owner within the development team to ensure this extension is regularly reviewed and updated as necessary.
- **Testing Guidelines**: Create a testing protocol that includes sample payloads containing both valid and invalid data to ensure that the extension behaves as expected.
- **Ongoing Maintenance**: Monitor the extension after implementations for any edge cases that may arise as the data structure evolves. Regular updates to documentation will be necessary.

By following the outlined points, this documentation serves as a comprehensive guide for the use, maintenance, and understanding of the Tealium iQ extension related to sanitising PII data.