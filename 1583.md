# Tealium iQ Extension Documentation

## 1. Extension Overview
- **Name**: GA360 : XD : Set link decoration type : linking pages
- **ID**: 1583
- **Type**: Advanced Javascript Code
- **Scope**: Before Load Rules
- **Execution Frequency**: Run Always

### Summary
This Tealium iQ extension determines the link decoration method for specific pages based on the brand (Halifax or Lloyds) identified in the data layer. It assigns a "standard", "fragment", or "none" value for link decoration, accommodating page-specific requirements primarily for financial services offered by the respective brands. The extension ensures links are appropriately decorated to facilitate tracking and segmentation during user navigation.

---

## 2. Code Explanation

### Key Variables
- **section_id_array**: An array derived from the `SectionID` value split by the `":"` character. It is used to capture the last element, which serves as the page identifier.
- **brand**: Captured from the `Brand` variable in the data layer, it identifies whether the current brand is Halifax or Lloyds.
- **link_decoration_type_values**: An object that maps specific section IDs (pages) to their respective link decoration types.

### Logic Flow
1. The function `set_link_decoration_type` is called with the data layer `dl` as the argument.
2. It checks the `brand` variable to determine which set of link decoration rules to apply.
3. Depending on the brand, it populates the `link_decoration_type_values` object with the appropriate section-to-decoration mappings.
4. It retrieves the link decoration type from this object using the last element of the `section_id_array`.
5. If no matching decoration type is found, it defaults to "none".
6. If the environment is set to 'dev', it logs the determined `link_decoration_type` for verification.
7. Finally, it assigns the value to `b.link_decoration_type`.

### Dependencies
- The extension relies on the standard Tealium data layer structure, expecting specific variable names such as `SectionID` and `Brand`.
- It uses the global objects `eventType` and `eventPayload`, which are guaranteed to be present when the extension executes.

---

## 3. Usage Examples

### Normal Condition
- **Input**: If `dl.SectionID` is set to "bankaccounts_current_accounts_current_account" and `dl.Brand` is "Halifax".
- **Output**: `b.link_decoration_type` will be assigned the value "standard".

### Edge Condition
- **Input**: If `dl.SectionID` is set to "unknown_page" and `dl.Brand` is "Lloyds".
- **Output**: `b.link_decoration_type` will fall back to "none" since there is no matching entry in the defined mappings.

---

## 4. Known Limitations & Gotchas
- The extension does not currently handle cases where the `SectionID` is either undefined or improperly formatted, which might lead to unexpected results.
- If external scripts modify global objects or interfere with the data layer, the functionality of this extension may be compromised.
- Only page IDs explicitly defined in the `link_decoration_type_values` are processed; other pages will return "none", which may affect data tracking completeness.

---

## 5. Recommendations for Refactoring
- **Defensive Checks**: Although not necessary per current guarantees, consider adding checks to ensure `dl.SectionID` and `dl.Brand` are defined and correctly formatted.
- **Code Style**: Maintain consistent indentation and spacing to improve readability.
- **Modularisation**: Break down the function into smaller functions for setting up brands and decoration types. This would enhance code maintainability and clarity.
- **Comments**: Remove or refactor commented-out code sections to streamline appearance and avoid confusion over what is currently supported versus what may be deprecated.

---

## 6. Maintenance & Further Notes
- Regularly review and update the list of supported page IDs as the website evolves to ensure alignment with business changes.
- Periodically test the extension in a staging environment to validate that new pages or services are correctly supporting the desired link decoration types.
- Ownership of this extension should involve a designated developer or team familiar with the brand objectives and the implications of tracking link decoration types for analytical purposes.
- Ensure to log any errors or discrepancies when testing in `dev` mode to make troubleshooting more straightforward.

--- 

This documentation serves as a comprehensive resource for current and future developers, providing insightful details into the functionality, implementation considerations, and maintenance of the Tealium iQ extension.