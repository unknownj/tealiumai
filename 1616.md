# Tealium iQ Extension Documentation: Set Mapp Brand ID

## 1. Extension Overview
- **Name**: Set Mapp Brand ID
- **ID**: 1616
- **Type**: Javascript Code
- **Scope**: 1460
- **Execution Frequency**: Every event trigger

### Summary
The "Set Mapp Brand ID" extension processes incoming event data by assigning a specific brand identifier (MappBrandID) based on the provided brand name. By mapping recognizable brand names to their corresponding IDs, this extension facilitates the accurate tracking and reporting of brand-related activities in the Mapp analytics system. It ensures that brand-specific data can be efficiently processed and reported, aiding in marketing and performance analysis.

---

## 2. Code Explanation

### Key Variables
- **mappBrandLookup**: An object that contains mappings of brand names to their respective Mapp IDs. The keys are brand names (e.g., "Lloyds", "Halifax", "BOS"), and the values are their corresponding IDs (e.g., "206", "207", "208").
  
### Logic Flow
1. The extension takes three parameters: `eventType`, `eventPayload`, and `tagObject`.
2. It checks if the `Brand` field exists in the `eventPayload` (referred to as `b` in the code).
3. If the brand name is found in the `mappBrandLookup` object, it assigns the corresponding MappBrandID to `b.MappBrandID`.
4. This modification allows further data processing in Tealium, ensuring that events related to the specified brand can be tracked accurately.

### Dependencies
The extension relies on the following:
- **Global Objects**: It uses standard JavaScript global objects, such as the parameters passed to the function (`eventType`, `eventPayload`), which are essential for its execution.
- **Tealium Data Layer**: It assumes that `eventPayload` (the second parameter `b`) possesses a `Brand` property which is correct and present.

---

## 3. Usage Examples

### Normal Condition
- **Scenario**: An event with a brand attribute for "Halifax".
    - **Input**: `eventPayload` contains `{ "Brand": "Halifax" }`
    - **Output**: `eventPayload` will have `MappBrandID` set to `"207"`.

### Edge Condition
- **Scenario**: An event with an unknown brand.
    - **Input**: `eventPayload` contains `{ "Brand": "UnknownBrand" }`
    - **Output**: `MappBrandID` will not be set or modified since "UnknownBrand" does not exist in the lookup object.

---

## 4. Known Limitations & Gotchas
- **Non-Existent Brand Handling**: If the `Brand` specified in the incoming event data does not match any keys in the `mappBrandLookup`, no `MappBrandID` will be assignedâ€”therefore, it will result in data not being recorded for Mapp tracking.
- **Hardcoding Mappings**: The brand mappings are hardcoded, making it inflexible if brands change or new brands need to be added; the code must be manually updated.
- **Potential Conflicts**: If multiple extensions attempt to modify the same properties in the `eventPayload`, there could be conflicts that result in data overwrites or incorrect mappings.

---

## 5. Recommendations for Refactoring
- **Defensive Checks**: While eventType and eventPayload are guaranteed, consider implementing checks to ensure that the `Brand` property exists and is of appropriate type before accessing it.
- **Modularisation**: Consider separating the mapping logic into its own function, which could enhance readability and maintainability. For example:
    
    ```javascript
    function getMappBrandID(brand) {
        return mappBrandLookup[brand] || null; // Default to null if not found
    }
    ```
- **Central Mapping Configuration**: Instead of hardcoding the `mappBrandLookup`, consider loading the mappings externally (from a JSON file or a structured configuration) to allow for easier updates without code changes.

---

## 6. Maintenance & Further Notes
- **Ownership**: It is recommended that a designated team member is responsible for the ongoing review of this extension, particularly when new brands are added or existing ones are changed.
- **Testing Guidelines**: Regularly test the extension with different brands to ensure mappings are functioning as expected. Edge cases (e.g., unknown brands) should also be monitored to verify that they are handled gracefully.
- **Documentation Updates**: Any changes to brand mappings or logic should be reflected in this documentation to ensure all developers and stakeholders have the most current information.

--- 

This documentation serves as a comprehensive guide to the "Set Mapp Brand ID" extension in Tealium. It is intended to be easily understood by developers working within the Tealium environment and provides the necessary details to facilitate implementation, maintenance, and future development efforts.