# Tealium iQ Extension Documentation: PageViewID and SendDepth

## Extension Overview

- **Name**: PageViewID and SendDepth
- **ID**: 1651
- **Type**: Javascript Code
- **Scope**: 928
- **Execution Frequency**: Active

### Summary
The **PageViewID and SendDepth** extension is designed to manage and track page view identifiers and send depth values within a Tealium iQ implementation. It generates a unique `PageViewID` for each page view and maintains a `SendDepth` counter, which indicates how many times a particular page has been viewed during a session. This functionality is essential for analytics and tracking user behaviour, allowing more granular reporting on page views and interaction depth.

## Code Explanation

### Key Variables
- **b.PageViewID**: The page view identifier obtained from the `eventPayload`. It serves as a unique ID for each page view.
- **u.lbgPageViewID**: A unique identifier that persists across page views and is initially set if `b.PageViewID` is available. If not, it generates a unique identifier.
- **u.lbgSendDepth**: A counter tracking the number of page views; it starts from `0` and increments with each page view.

### Logic Flow
1. The function checks if `b.PageViewID` exists. If it does and `u.lbgPageViewID` is not already set, it assigns `b.PageViewID` to `u.lbgPageViewID`.
2. If `u.lbgPageViewID` is not assigned yet, it creates a unique ID by combining the current timestamp (in base 36) and a random number (also in base 36).
3. The script checks if `u.lbgSendDepth` exists; if not, it initializes it to `0`, then increments it by `1`.
4. Finally, the function updates `b.PageViewID` and `b.SendDepth` with the generated values.

### Dependencies
The extension relies on the global objects:
- `eventType`: A string representing the type of event triggered.
- `eventPayload`: An object containing event parameters, including the `PageViewID`.

There are no external library dependencies; all logic is contained within this extension.

## Usage Examples

### Normal Scenario
When a user visits a page:
1. The `PageViewID` from {eventPayload} is accessible.
2. The extension sets `u.lbgPageViewID` to this `PageViewID` if it is not already assigned, or retains its existing value.
3. The `SendDepth` is initiated at `0` (or incremented if it previously existed) and then set back to `1`.

### Edge Conditions
- **Scenario with No PageViewID**: If `b.PageViewID` is not provided, `u.lbgPageViewID` will be generated as a unique string. This ensures that the extension still functions and records a page view, albeit without the original PageViewID.
- **Multiple Page Views in One Session**: Each page view increments the `SendDepth`, allowing the tracking of repeated views of the same page by the user.

## Known Limitations & Gotchas
- **State Persistence**: If the `u.lbgPageViewID` or `u.lbgSendDepth` is not managed correctly in a multi-tab or multi-window scenario, discrepancies might arise in tracking. Each tab will have its own execution context unless properly managed.
- **Conflict with Other Extensions**: If other extensions modify the `eventPayload` or the global scope indiscriminately, this extension's operations might conflict leading to undefined values or overridden data.
- **Browser Compatibility**: The method of generating random strings may not have the identical behaviour across all browsers, particularly older ones.

## Recommendations for Refactoring
- **Defensive Checks**: While the availability of `eventType` and `eventPayload` is guaranteed, consider implementing checks or logging warnings if other unexpected types of data are passed in for structural integrity during development phases.
- **Modularization**: Consider breaking down the code into smaller, reusable functions or components. This encapsulation could make the extension easier to debug and maintain in the long run.
- **Code Style**: Maintain consistency in variable naming conventions (e.g., using prefixes or suffixes) for clarity and ease of readability.

## Maintenance & Further Notes
- **Ownership**: Assign a specific team member or group responsible for overseeing the extension's functionality, ensuring it undergoes regular reviews and updates as required.
- **Testing Guidelines**: Implement thorough unit tests or integration tests to validate new features or refactorings before deployment.
- **Documentation Updates**: Ensure that this documentation is kept up to date with any code changes, including newly discovered limitations, bugs, or improvements.

This documentation serves as a comprehensive guide for understanding, implementing, and maintaining the PageViewID and SendDepth extension within the Tealium iQ platform.