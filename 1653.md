# Tealium iQ Extension Documentation: Enable Event Stream

## 1. Extension Overview
- **Name**: Enable Event Stream
- **ID**: 1653
- **Type**: JavaScript Code
- **Scope**: Before Load Rules
- **Execution Frequency**: Run Always

### Summary
The "Enable Event Stream" extension is designed to conditionally enable the event stream feature based on the environment being used (development or QA) and the current domain being accessed. It ensures that data is captured in the correct environments for debugging and testing purposes, specifically for domains associated with various banking and financial services.

---

## 2. Code Explanation
### Key Variables
- **enabledDomains**: An array that lists all the valid domains for which the event stream should be enabled. This includes domains for Lloyds Bank, Bank of Scotland, Halifax, MBNA, and Scottish Widows.

### Logic Flow
1. The extension begins by checking if the environment (`ut.env`) is either "dev" or "qa". If true, it sets `b.EnableEventStream` to `true`, enabling the event stream feature.
2. It then iterates through the `enabledDomains` array using the `map` method:
   - For each domain in the array, it checks:
     - If the current window's hostname matches the domain, it sets `b.EnableEventStream` to `true`.
     - If the `CanonicalDomainProd` matches the domain, it also sets `b.EnableEventStream` to `true`.

### Dependencies
- **Global Objects**: This extension relies on global properties `ut.env`, `CanonicalDomainProd`, and `window.location.hostname`.
- There are no specific library dependencies, but it operates based on the Tealium iQ data layer and its conventions.

---

## 3. Usage Examples
### Example Scenario 1: Normal Operation
- **Use Case**: A user accesses "www.lloydsbank.com" in a QA environment.
- **Outcome**: The check for `ut.env` will confirm the environment, and since the domain matches, `b.EnableEventStream` is set to `true`, enabling the event stream.

### Example Scenario 2: Edge Case
- **Use Case**: A user accesses "www.example.com" in a Production environment.
- **Outcome**: The `ut.env` is neither "dev" nor "qa", and the domain does not match any in the `enabledDomains` array. Therefore, `b.EnableEventStream` remains `false`, and the event stream is not enabled.

---

## 4. Known Limitations & Gotchas
- **Environment Check**: If the environment variable (`ut.env`) is not properly set or is misconfigured, the extension will not function as intended.
- **Domain Matching**: The extension strictly matches against the defined list of domains; any variation (such as subdomains or typos) will prevent event stream activation.
- **Conflicts**: There may be conflicts if multiple extensions attempt to set the same property (`b.EnableEventStream`), especially if they execute after the "Enable Event Stream" extension.

---

## 5. Recommendations for Refactoring
- **Defensive Checks**: Although it's guaranteed that `eventType` and `eventPayload` are present, consider adding checks for the expected format of `b` to ensure it has the required properties before assignment. 
- **Code Style**: Clean up the code by omitting the `a` function parameter since it's not used. It can improve readability.
- **Modularization**: Consider separating the domain array and logic into a different function for clarity and potential reuse. 

Example of separating domain logic:
```javascript
function isDomainEnabled(domain) {
    return enabledDomains.indexOf(domain) !== -1;
}
```

---

## 6. Maintenance & Further Notes
- **Ongoing Maintenance**: Regularly review the `enabledDomains` list to ensure it remains up-to-date with active domains.
- **Ownership**: Assign a team member to oversee updates and maintenance of the extension.
- **Testing Guidelines**: Perform tests in all target environments (dev, qa, prod) to validate functionality and ensure the correct domains enable the event stream properly. Regularly run regression tests to ensure that changes do not affect functionality.

--- 

This documentation provides a thorough overview of the "Enable Event Stream" extension and serves as a reference for developers and stakeholders involved in maintenance and development efforts within Tealium iQ.