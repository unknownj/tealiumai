# Tealium iQ Extension Documentation: ContentSquare Masking

## 1. Extension Overview

- **Name**: ContentSquare Masking
- **ID**: 100036
- **Type**: Javascript Code
- **Scope**: 1471
- **Execution Frequency**: On every page view

### Summary
The ContentSquare Masking extension is designed to protect Personally Identifiable Information (PII) by defining specific CSS selectors that identify elements on the webpage that contain sensitive information. This helps ensure that customer data is not inadvertently captured or replayed during event tracking, particularly useful for compliance with data protection regulations. The extension also conditionally enables data replay based on the hostname, enhancing the accuracy and relevance of the data collected.

## 2. Code Explanation

### Key Variables
- `window._uxa`: An array set to handle ContentSquare configurations, including a method to set PII selectors.
- `b`: An object that is modified to control replay settings, specifically the `EnableReplay` flag.
- `journeyReplay`: A boolean flag used to decide whether to enable replay based on specific pathname checks (currently commented out).

### Logic Flow
1. **Initial Setup**: The extension begins by initializing `window._uxa` if it does not already exist.
2. **Setting PII Selectors**: It defines a list of selectors that will be masked during tracking to prevent any PII exposure.
3. **Hostname Checks**: The script checks the current hostname against a predefined list. If there's a match, the `EnableReplay` flag in `b` is set to `true`.
4. **Journey Replay**: A commented-out logic section checks for specific pathnames using `LBGAnalytics.Q()` to toggle the `journeyReplay` flag, but is currently inactive.
5. **Final Replay Check**: If `journeyReplay` is `true`, it enables replay in `b`.

### Dependencies
- The extension relies on global objects such as `window` for its configuration and the presence of `LBGAnalytics` for pathway checks (although this is currently commented out).

## 3. Usage Examples

### Normal Condition
When a user visits `www.lloydsbank.com`, the extension identifies the hostname and sets `b.EnableReplay` to `true`. Sensitive elements marked by the provided selectors are masked, ensuring the PII isn't captured in analytics.

### Edge Condition
If a user visits a domain not listed (e.g., `www.example.com`), `b.EnableReplay` remains `undefined`, and no replay data will be enabled. If the commented-out conditions for `journeyReplay` were active, navigating to specified paths would also toggle the replay functionality, depending on user interactions.

## 4. Known Limitations & Gotchas

- **Commented-out Logic**: The `journeyReplay` checks are currently inactive, which may limit replay capabilities for paths that might need tracking.
- **CSP Issues**: Some hostname checks are disabled due to Content Security Policy (CSP) restrictions, which can affect functionality on those sites.
- **Potential Conflicts**: The extension may conflict with other Tealium extensions that manipulate the global `b` object, leading to unexpected behaviours if multiple extensions try to modify it concurrently.

## 5. Recommendations for Refactoring

- **Modularisation**: Consider breaking out the hostname checks and PII selector settings into separate functions for clarity and maintainability.
- **Comment Clarity**: Ensure that comments clearly describe the purpose of each section and the reason for the disabled conditions, which aids future developers in understanding the code quickly.
- **Defensive Checks**: While not required, implementing checks to ensure `b` is defined before modification could make the extension more robust against unexpected global changes.

## 6. Maintenance & Further Notes

- **Ongoing Maintenance**: Regularly review and update the list of hostnames as business requirements evolve. Remove or uncomment `journeyReplay` conditions once the necessary tracking is validated.
- **Ownership**: Assign a developer or team responsible for this extension to oversee updates, documentation, and testing.
- **Testing Guidelines**: Implement thorough testing across all defined hostnames to ensure that PII masking works as intended and that the replay functionality behaves correctly.

---

This documentation serves as a comprehensive guide for developers interacting with the ContentSquare Masking extension within Tealium iQ, ensuring clarity and maintainability.