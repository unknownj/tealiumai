# Tealium iQ Extension Documentation: SCEP Components

## 1. Extension Overview
- **Name:** SCEP Components
- **ID:** 100036
- **Type:** Javascript Code
- **Scope:** 928
- **Execution Frequency:** Randomly executes on 1% of page loads.

### Summary
The "SCEP Components" extension is designed to inventory AEM components present on a webpage. It identifies the classes of HTML elements, focusing on those prefixed with "c-", and randomly selects one to construct a unique identifier. This information is stored in Omniture properties `s.prop61` and `s.prop62` for analytics tracking. It serves the purpose of monitoring component usage, which can be vital for performance analysis or feature adoption assessment.

## 2. Code Explanation

### Key Variables
- `tags`: An array of all HTML elements within the document.
- `classes`: An object that counts occurrences of each class name that starts with "c-".
- `classList`: An array of unique class names identified in the webpage.
- `randomClass`: A randomly selected class name from `classList`.
- `classPieces`: An array split from the selected `randomClass`, used to construct a structured ID.
- `classID`: A string formatted as "AEM/{first-part}-{second-part}".

### Logic Flow
1. **Conditional Check**: The code initiates by checking if the global variable `s` exists and if properties `s.prop61` and `s.prop62` are not already set. It also ensures the execution only occurs on 1% of page loads using `Math.random()`.
2. **Tag Collection**: It fetches all elements in the document and converts the NodeList to an array of elements.
3. **Class Identification**: The code iterates through all elements, checking their class attribute. If classes starting with "c-" are found, it counts their occurrences.
4. **Random Selection**: A random class from the identified classes is selected, and this class is split into two parts.
5. **ID Construction**: The `classID` is constructed using a specific format and assigned to `s.prop62`, while `s.prop61` is set with a static value "AEM Component Inventory".

### Dependencies
- Relies on the global object `s` from Adobe Analytics (Omniture).
- Uses native JavaScript methods such as `querySelectorAll`, `forEach`, and `Math.random()`.

## 3. Usage Examples

### Normal Operation
- When a webpage with multiple elements is loaded, the extension runs and collects class names. On approximately 1% of loads, one class name prefixed with "c-" is picked, and the corresponding props in the `s` object are set accordingly.

### Edge Conditions
- If no elements with classes prefixed by "c-" are present, the props remain unset, preventing any tracking.
- If the page does not load the `s` object for any reason, the logic will not execute, thus protecting site performance by avoiding errors.

## 4. Known Limitations & Gotchas
- **Class Absence**: If there are no classes that meet the condition, `s.prop61` and `s.prop62` will not be set, potentially leading to a lack of data for analysis.
- **Dependency on `s`**: Should the `s` global not be available, the extension will not work. Consider handling such a case if `s` is conditionally included in other extensions.
- **Random Execution**: Because it executes randomly, analytics data may be incomplete, leading to inconsistencies in reporting.

## 5. Recommendations for Refactoring
- **Defensive Checks**: Although checking for the availability of `s` is not necessary, ensuring that the execution does not alter performance might require logging or alerts if abnormal behaviour is detected.
- **Modularisation**: Consider breaking down the functionality into separate functions (e.g., a function for collecting tags, a function for selecting classes) to improve readability and testing.
- **Code Style Consistency**: Ensure consistent indentation and formatting for improved readability.

## 6. Maintenance & Further Notes
- **Ownership**: Identify a responsible party for this extension to ensure timely updates and monitoring.
- **Testing Guidelines**: Establish a process for testing in staging environments before production deployment. Include scenarios for normal and edge cases.
- **Documentation Updates**: Keep this documentation up to date with any future changes or enhancements to the extension code.

---

By documenting the extension in a structured format, this serves as a comprehensive reference for developers and stakeholders involved in maintaining or utilizing the "SCEP Components" extension.