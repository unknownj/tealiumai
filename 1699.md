# Tealium iQ Extension Documentation: Performance Timings

## 1. Extension Overview
- **Name:** Performance Timings
- **ID:** 1699
- **Type:** Javascript Code
- **Scope:** After Load Rules
- **Execution Frequency:** Run Once

### Summary
The **Performance Timings** extension captures various performance metrics from the Navigation Timing API and sends this data as generic events to LBGAnalytics. These metrics provide insights into user experience, specifically the timings associated with navigation and loading of a webpage. Collecting this data helps in optimizing the performance and responsiveness of web applications.

---

## 2. Code Explanation

### Key Variables
- **`p`:** Stores the result of `performance.getEntriesByType("navigation")[0]`, which is the first navigation entry in the performance entry list. This object contains several timing attributes relevant to the document's lifecycle.

### Logic Flow
1. **Check for Navigation Entry Availability:** The code first ensures that the `loadEventEnd` property of the `p` object is greater than zero, which indicates that the navigation data is available.
  
2. **Data Collection and Event Sending:**
   - The extension sends a series of generic events using the `LBGAnalytics.events.genericEvent()` function.
   - Each event corresponds to a specific timing metric, such as connection time, response time, and various loading milestones (e.g., `domContentLoaded`, `loadEvent`).
   - The times are clamped to a maximum of 60000 milliseconds (60 seconds) using `Math.min(60000, ...)`, ensuring that extremely long values do not flood the analytics platform.

### Dependencies
- **LBGAnalytics:** This extension uses LBGAnalytics for sending events, hence it relies on the availability of this global library.

---

## 3. Usage Examples

### Normal Conditions
When a user navigates to a webpage:
- The performance timings are recorded and sent to LBGAnalytics upon the completion of the load event. This data can be reviewed in the analytics dashboard to assess how quickly different components of the page load.

### Edge Conditions
- **No Navigation Data Available:** If the `performance.getEntriesByType("navigation")` returns an empty array, or if the `loadEventEnd` is not greater than zero, no events will be sent.
- **High Latency Scenarios:** In scenarios with significant latency (where loading times exceed 60 seconds), the times will be clamped at 60000 milliseconds to prevent anomalies in reporting.

---

## 4. Known Limitations & Gotchas

- **Event Overload Risk:** Rapid navigations may lead to multiple event triggers within a short period, potentially overwhelming the analytics system if not properly managed.
- **Browser Support:** The `performance` API is not supported in very old browsers (e.g., IE 10 and below). In scenarios where the performance data is critical, compatibility should be checked.
- **Conflicts with Other Extensions:** This extension may conflict with others that also manipulate the performance data or intercept similar navigation events. Proper testing should be done to ensure that all required extensions cooperate without issues.

---

## 5. Recommendations for Refactoring

- **Modularisation:** Although full modularisation may not be feasible due to the ES5 constraint, consider separating key functional blocks (like data gathering and event sending) into clear sections for readability.
- **Logging/Debugging:** Implement some basic logging (console.log statements) to notify when the performance data is not available. This will aid in debugging.
- **Commenting Critical Sections:** Add comments to explain complex logic within the code, especially around the use of timers and the implications of clamping values to 60000 milliseconds.

---

## 6. Maintenance & Further Notes

- **Ownership:** Ensure that a designated owner is responsible for the maintenance of this extension, with regular reviews scheduled every 6 months to assess performance and compatibility with new browser versions.
- **Testing Guidelines:** Use automated testing tools wherever possible to validate that the data being sent matches expectations, and conduct manual testing during significant updates or changes to the code.
- **Documentation Updates:** Keep the documentation updated whenever changes are made to the extension to ensure clarity for future developers and maintainers.

--- 

This documentation serves as a comprehensive guide for developers and stakeholders to understand the Performance Timings extension, its functionality, potential issues, and future considerations.