# Documentation for Tealium iQ Extension: GA4 : Set GA4EventTitle

## 1. Extension Overview

- **Name**: GA4 : Set GA4EventTitle
- **ID**: 1700
- **Type**: Advanced Javascript Code
- **Scope**: After Load Rules
- **Execution Frequency**: Run Always

### Summary
The "GA4 : Set GA4EventTitle" extension is designed to parse and modify the `PegasusTagName` variable within the `utag.data` object. It transforms the tag name into a GA4 compliant event title by manipulating the string based on specific rules, ensuring that it adheres to a format suitable for Google Analytics 4 event tracking.

## 2. Code Explanation

### Key Variables
- **`dl`**: This parameter represents the data layer object, typically `utag.data`, which contains various variables related to the user's interaction.
- **`arr`**: An array created from splitting the `PegasusTagName` string using " | " as a delimiter.
- **`event_name`**: A string that accumulates the final event title derived from the `arr` after processing.

### Logic Flow
1. The `set_ga4_custom_events` function takes the data layer (`dl`) as an argument.
2. It splits the `PegasusTagName` into an array using " | ".
3. The first two elements of the array are removed.
4. The code iterates through the array, removing elements that equal "Sales" and "NA".
5. If more than two elements remain, the last one is discarded.
6. Finally, the remaining elements are joined into a single string, converted to lowercase, and spaces are replaced with underscores to form a valid GA4 event title.

### Dependencies
- The extension relies on the global `utag` object, specific to Tealium, to access `utag.data`. There are no external libraries or frameworks used in this script.

## 3. Usage Examples

### Normal Operation
- **Input**: If `utag.data.PegasusTagName` is "Transaction | Payment | Completed | NA", the output for `event_name` will be `transaction_payment_completed` after removing "Sales" and "NA".
- **Behaviour**: The output is set to `utag.data.GA4VirtualEventTitle`, which can then be used for further event tracking in Google Analytics 4.

### Edge Conditions
- **Input with Too Many Elements**: For `utag.data.PegasusTagName` being "Product View | Sales | NA | XYZ | ABC", the final output will be `product_view_xyz`, as the last element gets truncated.
- **Input with Insufficient Elements**: For `utag.data.PegasusTagName` being "Sales | NA", the event title will end up being an empty string, which may not be ideal for tracking.

## 4. Known Limitations & Gotchas

- The extension does not handle cases where `PegasusTagName` could be undefined or not a string; it assumes that the variable will always be defined and correctly formatted.
- If the `PegasusTagName` structure changes (e.g., different delimiters), the extension will not function as intended without updates to the code.
- There may be conflicts with other extensions that also modify `utag.data.GA4VirtualEventTitle`, leading to unexpected behaviours if they execute out of order.

## 5. Recommendations for Refactoring

- **Defensive Checks**: Consider adding checks to ensure that `PegasusTagName` is a valid string before processing.
- **Code Style**: Maintain consistency in variable naming conventions. Consider using more descriptive names for better readability.
- **Modularization**: If this code is to grow in complexity, consider breaking out the event name parsing into a separate helper function.

## 6. Maintenance & Further Notes

- **Ownership**: Ensure that a single point of contact is designated for ownership, ideally a developer familiar with the extensionâ€™s functionality.
- **Testing Guidelines**: Regularly validate the output of `GA4VirtualEventTitle` against expected results, especially after changes to the data layer or the format of `PegasusTagName`.
- **Documentation Updates**: Keep this documentation updated with any changes to the code, ensuring all stakeholders are aware of the current implementation.

--- 

This documentation aims to provide clarity on how the GA4 : Set GA4EventTitle extension operates within the Tealium environment, guide future enhancements, and facilitate ongoing maintenance.