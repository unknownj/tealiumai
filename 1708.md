# Tealium iQ Extension Documentation: Copy Hash dmp_id_hashed

## 1. Extension Overview

- **Name**: Copy Hash dmp_id_hashed
- **ID**: 1710
- **Type**: Crypto Extension
- **Scope**: After Load Rules
- **Execution Frequency**: Run Always

### Summary
The "Copy Hash dmp_id_hashed" extension is designed to extract and assign a hashed value of `dmp_id_hashed` to the `RetailCustomerID` variable on the event payload. This is particularly useful for anonymising customer identifiers while maintaining the ability to track user interactions without divulging personal information. The hashed value is especially pertinent in compliance with data privacy regulations.

## 2. Code Explanation

### Key Variables
- `eventType`: Globally defined variable that dictates the type of event being processed.
- `eventPayload`: Object representing the payload of the event, which may include user data or other relevant information.
- `tagObject`: Presence is implied; potentially used for further event tagging (not utilized in the provided code).

### Logic Flow
1. The code initiates a self-invoking function to encapsulate its execution context.
2. Within the first layer of function, another self-invoking function is defined, which takes `eventType` and `eventPayload` as arguments.
3. A third function is invoked where it checks if `RetailCustomerID` does not already exist within the `eventPayload`. If absent, it assigns the value of `"-"` as a placeholder.
4. The overall approach ensures that `RetailCustomerID` remains defined as `"-"` in cases where there are no meaningful values to assign.

### Dependencies
- The code depends on the presence of the `eventType` and `eventPayload` global variables. There are no external libraries or other global objects explicitly referenced.

## 3. Usage Examples

### Normal Condition
- When the extension is triggered during an event, it checks for `RetailCustomerID` in the `eventPayload`. If not found, it defaults to `"-"`. This guarantees that the application can handle user events without crashing due to undefined variables.

### Edge Condition
- If `RetailCustomerID` is subsequently defined prior to calling this extension, the extension will not update the value but will leave it unchanged. Therefore, to ensure consistency, prior handling of `RetailCustomerID` should be considered if used in conjunction with other scripts or extensions.

## 4. Known Limitations & Gotchas

- **Data Overwrite**: There is no logic implemented to modify or check the incoming value of `RetailCustomerID` if it’s set to a value other than `"-"`. This could lead to confusion if another extension assumes `RetailCustomerID` should represent a user’s actual ID.
- **Execution Order**: Since this extension runs after load rules, ensure that designations for `RetailCustomerID` are not overridden by extensions that execute later.
- **Global Dependencies**: The reliance on global variables means that any changes to them from other scripts could lead to unintended consequences, especially for tracking user identities.

## 5. Recommendations for Refactoring

- **Defensive Checks**: Although availability of `eventType` and `eventPayload` is guaranteed, incorporating checks to ensure that the types (e.g. string for `eventType`, object for `eventPayload`) remain as expected would promote stability.
- **Modularisation**: Consider extracting the logic to assign default values into a separate function to promote code reusability and clarity.
- **Comments**: Adding comments within the code can help team members quickly understand the logic and functionalities being implemented, especially in a collaborative environment.

## 6. Maintenance & Further Notes

- **Ownership**: Assign a team member responsible for maintaining this extension and ensuring it operates correctly with updates to the Tealium iQ platform and affiliated extensions.
- **Testing Guidelines**: Develop a testing protocol that verifies the functionality after each significant change in event structure or external dependencies to ensure continuity.
- **Documentation Updates**: Ensure that any changes to this extension are reflected in the documentation for future developers or stakeholders to remain informed about its functionality and limitations.

---

This documentation aims to facilitate clarity and promote best practices for developers working with the Tealium iQ extension. Always consider the implications of data handling when updating or maintaining code in a production environment.