# Tealium iQ Extension Documentation: Show Hide 2 Prototype

## 1. Extension Overview

- **Name**: Show Hide 2 Prototype
- **ID**: 1716
- **Type**: Javascript Code
- **Scope**: DOM Ready
- **Execution Frequency**: Run Once

### Summary
This extension is designed for a specific page on the Lloyds banking website (`/bankaccounts/overdrafts/lloyds-cost-calculator.html`). It integrates tracking and analytics by capturing user interactions with certain elements, mapping properties, and pushing data to the analytics layer as specified in the `analyticsIntegration` array. The goal of this extension is to enhance data collection and user tracking on the specified page, thereby improving understanding of user interactions.

---

## 2. Code Explanation

### Key Variables
- **`analyticsIntegration`**: An array of objects that define different analytics instructions based on user interactions, including:
  - `element`: The target HTML element that triggers actions.
  - `trigger`: The type of action that activates the instruction (in this case, `"show"`).
  - `mapProperty`: Maps a property of an element to the data layer.
  - `datalayer`: Contains information related to the user journey.
  - `event`: Specifies the action and narrative for the analytics event.

- **`handlers`**: An object containing methods for processing data:
  - **`datalayer`**: Sets values to the data layer.
  - **`mapProperty`**: Maps properties from the DOM to the data layer.
  - **`event`**: Sends analytics events.

### Logic Flow
1. **Environment Check**: The code checks the current page's pathname to ensure that it runs only on the specified page.
2. **Initial Data Layer Setup**: Sets the `Brand` data layer variable to `"Lloyds"`.
3. **Filtering Analytics Instructions**: It filters the `analyticsIntegration` for instructions with the trigger type `"show"`.
4. **Event Listener**: An event listener is added to the body to listen for click events.
   - On a click event, it checks if the clicked element has the `data-show-elements` attribute.
   - If the clicked element is meant to show, it triggers the corresponding analytics actions (updating the data layer, mapping properties, and sending events).

### Dependencies
- This code depends on the global object `LBGAnalytics`, which handles the data layer and event submissions. There are no other external libraries or frameworks referenced.

---

## 3. Usage Examples

### Scenario 1: Normal Operation
- **User Interaction**: The user clicks an element on the page that has a `data-show-elements` attribute containing `"classic-layout"`.
- **Expected Outcome**:
  - The `LBGAnalytics.datalayer.set` function is called to update the data layer with the relevant "JourneyProduct" and mapped properties from the element identified by `p[scep-template='##total-cost##']`.
  - An event is sent to track the user selection with the action `"Select Account"` and narrative `"Classic"`.

### Scenario 2: Edge Condition (Element Not Found)
- **User Interaction**: The user clicks an element, but the target element (i.e., `p[scep-template='##total-cost##']`) does not exist on the page.
- **Expected Outcome**: The `mapProperty` handler exits early without pushing data to the data layer, preventing errors.

---

## 4. Known Limitations & Gotchas

- **Element Selector Reliance**: If the element specified in `mapProperty` does not exist, the data mapping will not occur, leading to potentially incomplete analytics data.
- **Triggering Events**: Events may not be reliably tracked if multiple elements share the same `data-show-elements` attribute values or if nested clicks occur (e.g., clicking within a parent element that also has an attribute).
- **Potential Conflicts**: If other extensions or scripts manipulate the same DOM elements or analytics events, this extension may conflict. Coordination with other scripts is advised.

---

## 5. Recommendations for Refactoring

- **Defensive Checks**: Implement more robust checks in `mapProperty` to ensure elements exist before attempting to access their properties. For example, confirm that `document.querySelector(mapObject.element)` is truthy before accessing its properties.
- **Code Style**: Maintain consistent formatting (e.g., indentation, spacing) for readability. Consider separating logic into smaller, clearly-named functions to encapsulate the different tasks (e.g., mapping properties, sending events).
- **Modularisation**: For larger implementations, think about breaking out the handlers into their own file or section for clarity and reusability, especially if similar functionality is required elsewhere.

---

## 6. Maintenance & Further Notes

- **Ownership**: Specify a maintainer for the extension who is responsible for overseeing updates and addressing issues.
- **Testing Guidelines**: Regularly test functionalities during development and after deployments to ensure all mappings and event triggers work as intended. Automated testing could also be considered for regression checks.
- **Documentation Updates**: As features evolve or bugs are fixed, ensure that this documentation is kept up-to-date to reflect the current state of the code.

--- 

This structured documentation can serve as a reference point for current and future developers working with this Tealium iQ extension, ensuring clarity in its purpose, functionality, and maintenance requirements.