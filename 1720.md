# Tealium iQ Extension Documentation

## 1. Extension Overview

- **Name**: iWeb Brand fix
- **ID**: 100040
- **Type**: Advanced Javascript Code
- **Scope**: Before Load Rules
- **Execution Frequency**: Run Always

### Summary
The "iWeb Brand fix" extension is designed to set the `Brand` variable to "iWeb" when the domain of the page being loaded includes the substring "iweb". This helps in correctly categorizing the brand for analytics and marketing purposes by ensuring the right context is applied throughout the user's session.

---

## 2. Code Explanation

### Key Variables
- `a`: Represents the `eventType` parameter, which indicates the type of event being processed.
- `b`: Represents the `eventPayload`, which is an object containing key-value pairs relevant to the event. It includes various parameters available for processing.

### Logic Flow
1. The code begins by checking if the domain of the current document (retrieved from `b['dom.domain']`) contains the string "iweb".
2. If the condition evaluates to `true`, the `Brand` key in the `eventPayload` object (`b`) is set to "iWeb".

### Data Processing
- The extension executes irrespective of specific load rules, since it runs always within the defined scope.
- There are no additional dependencies on external libraries or global objects beyond the standard objects provided by Tealium.

---

## 3. Usage Examples

### Normal Conditions
1. When a user visits the page with the URL `https://www.iweb-example.com`, the domain check will succeed:
   - `b['Brand']` will be set to "iWeb".

### Edge Conditions
1. If a user visits `https://www.someotherdomain.com`, the domain check will fail:
   - `b['Brand']` will remain undefined.

2. If the domain includes "iWeb" in different casing (e.g., `https://www.IWeb-example.com`), the check will also fail since it is case-sensitive:
   - `b['Brand']` will remain undefined.

---

## 4. Known Limitations & Gotchas

- The extension relies on string matching and is thus case-sensitive. As a result, any variations in casing (e.g., "iWeb", "IWEB") will not match and will lead to unexpected behaviour where `b['Brand']` remains undefined.
- If there are other extensions manipulating the `b['Brand']` variable afterwards, their logic might conflict with this extension. It's important to review the execution order of any other related extensions.
- The extension does not provide a fallback mechanism, so if the domain does not include "iweb", nothing occurs, which may not yield desired results in certain reporting scenarios.

---

## 5. Recommendations for Refactoring

- **Defensive Checks**: While the requirement does not necessitate them, consider adding defensive checks to ensure that properties like `b['dom.domain']` exist before accessing them, as future changes to the data object might introduce variability.
  
- **Code Style**: Maintaining consistent code indentation and spacing will enhance readability. This is especially important when multiple developers might work on the code.

- **Modularization**: If the logic expands, consider extracting the domain check into a separate function for clearer separation of concerns. For example:

```javascript
function isDomainMatching(domain, substring) {
    return domain.indexOf(substring) !== -1;
}

if (isDomainMatching(b['dom.domain'], "iweb")) {
    b['Brand'] = "iWeb";
}
```

This approach fosters better unit testing opportunities for the domain checking logic.

---

## 6. Maintenance & Further Notes

- **Ownership**: Designate an owner or a small team responsible for the upkeep of this extension. They should monitor changes in business requirements and ensure the extension aligns accordingly.

- **Testing Guidelines**: 
  - Regularly conduct tests when making updates to the extension to ensure new changes do not inadvertently affect existing functionality.
  - Consider implementing unit tests for edge cases, especially around domain variations and conflicts with other extensions.

- **Documentation**: Maintain documentation not just for the current version of this extension but also for its evolution over time to help new developers understand its history and purpose.

---

This documentation serves as a thorough guide for understanding and maintaining the "iWeb Brand fix" extension. Please make sure to share within your developer teams for consistent knowledge and implementation procedures.