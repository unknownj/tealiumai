# Tealium iQ Extension Documentation

## 1. Extension Overview

- **Name**: LivePerson Override - SW Encashments
- **ID**: 1728
- **Type**: Advanced Javascript Code
- **Scope**: Before Load Rules
- **Execution Frequency**: Run Always

### Summary
This extension is designed to conditionally override a variable (`JourneyProduct`) in the `eventPayload` if the `CanonicalDomain` matches specific values. The primary purpose is to ensure that the correct product information is attached to events for the domains `take-my-pension.scottishwidows.co.uk` and `appduv03b7.machine.test.group`. The extension helps facilitate data accuracy within Tealium for enhanced tracking and analysis of user interactions.

## 2. Code Explanation

### Key Variables
- `a`: Represents the `eventType`, which signifies the event being processed.
- `b`: Represents the `eventPayload`, which contains the details associated with the event.

### Logic Flow
1. The code checks if the `CanonicalDomain` of the `eventPayload` matches either `take-my-pension.scottishwidows.co.uk` or `appduv03b7.machine.test.group`.
2. If a match is found, the `JourneyProduct` property of the `eventPayload` (`b`) is set to the value of `CanonicalPath`.
3. This quick check allows the application to override the product information seamlessly and keep tracking accurate.

### Dependencies
- The code relies on global objects, namely `eventType` and `eventPayload`, which are assumed to be correctly defined and available within the scope of the extension invocation.

## 3. Usage Examples

### Normal Conditions
- For a user visiting the domain `take-my-pension.scottishwidows.co.uk`:
  - **Input**: An `eventPayload` with `CanonicalDomain` set to `take-my-pension.scottishwidows.co.uk` and an appropriate `CanonicalPath`.
  - **Output**: The `JourneyProduct` in the `eventPayload` will be set to the value of `CanonicalPath`.

### Edge Conditions
- For a user visiting a domain not specified in the conditions (e.g., `example.com`):
  - **Input**: An `eventPayload` with `CanonicalDomain` set to `example.com`.
  - **Output**: There will be no changes to the `JourneyProduct` in the `eventPayload`; it will remain unchanged.

## 4. Known Limitations & Gotchas

- The code specifically checks for two domains. If other domains are required in the future, additional checks will need to be implemented.
- If there is no `CanonicalPath` defined in the event payload, the `JourneyProduct` may end up undefined, leading to potential data integrity issues downstream.
- The extension runs before load rules, which means if there are other manipulations dependent on `JourneyProduct`, those might not execute correctly if not sequenced properly.

## 5. Recommendations for Refactoring

- **Defensive Checks**: Consider adding conditionals that ensure `CanonicalPath` exists before assignment to `JourneyProduct` to avoid errors in the data flow.
- **Code Style**: Maintain consistent indentation and spacing for improved readability.
- **Modularization**: Consider separating the core logic into a dedicated function for better maintenance and potential reuse.

```javascript
(function(a,b) {
    if (
        (b.CanonicalDomain === "take-my-pension.scottishwidows.co.uk" || 
         b.CanonicalDomain === "appduv03b7.machine.test.group") && 
        b.CanonicalPath
    ) {
        b.JourneyProduct = b.CanonicalPath;
    }
})(eventType, eventPayload);
```

## 6. Maintenance & Further Notes

- **Ongoing Maintenance**: Regularly audit the extension against new domain names or product changes to ensure continued relevance.
- **Ownership**: Clearly assign a team or individual responsible for the upkeep and updates of this extension code.
- **Testing Guidelines**: Implement unit tests to validate the functionality of the extension, especially after any changes to either the code or the domains in question.

---

This documentation serves as a comprehensive guide to understanding and maintaining the `LivePerson Override - SW Encashments` extension within Tealium iQ. Please ensure that all stakeholders are familiar with these details to maximise the extension's utility and performance.