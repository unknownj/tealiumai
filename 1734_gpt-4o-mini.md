# Tealium iQ Extension Documentation: Cross-Tag PageViewID

## 1. Extension Overview
- **Name**: Cross-Tag PageViewID
- **ID**: 100036
- **Type**: Javascript Code
- **Scope**: After Load Rules
- **Execution Frequency**: Run Always

### Summary
The "Cross-Tag PageViewID" extension is a JavaScript-based functionality designed to generate and assign a unique PageViewID for each page view. This identifier is essential for tracking user behaviour across various tags in a consistent manner. By establishing a unique PageViewID, the extension ensures that data related to user interactions can be correlated accurately, improving analytic capabilities and insights.

## 2. Code Explanation

### Key Variables
- **PageViewID**: A unique identifier generated by combining the current timestamp (converted to a base-36 string) and a random number (also in base-36).

### Logic Flow
1. The extension checks if the `PageViewID` property does not already exist on the `b` object (which serves as the event payload).
2. If `PageViewID` is absent, a new unique identifier is created.
3. The extension then looks for specific global analytics objects (`LBGAnalytics` or `clova3`) to update their respective data layers with the newly created `PageViewID`:
   - If `LBGAnalytics` is detected, the PageViewID is set in its datalayer.
   - If `clova3` is detected, the PageViewID is similarly set.
  
### Dependencies
The extension relies on the presence of the following global objects:
- **LBGAnalytics**: An analytics library that manages data through its datalayer.
- **clova3**: Another analytics object expected to have a similar datalayer functionality.

## 3. Usage Examples

### Sample Scenarios
- **Normal Condition**: 
  - When the extension is first triggered on a page view, it will check for an existing `PageViewID`. If none exists, it generates one and associates it with the user's session. This enables tracking through both `LBGAnalytics` and `clova3`.
  
- **Edge Condition**:
  - If the extension is executed multiple times on the same page view, the `PageViewID` will only be generated once as long as the previous identification is not present. This prevents duplicate IDs, ensuring accurate tracking.

### Data Flow Illustration
1. **Initial Trigger**: User navigates to a page, triggering relevant events.
2. **Execution of Extension**:
   - Check for `b.PageViewID`.
   - If it does not exist, create a `PageViewID` and set it in the corresponding analytics layer.
3. **Subsequent Events**: Any further events on the same page view will reference the existing `PageViewID`.

## 4. Known Limitations & Gotchas

- **Undefined Global Objects**: The absence of expected global analytics objects (`LBGAnalytics` or `clova3`) will prevent the PageViewID from being set, leading to potential data loss in tracking.
- **Multiple Tag Execution**: If multiple tags attempt to execute simultaneously, race conditions may arise, potentially affecting which analytics platform receives the PageViewID first.
- **Non-compliant Browsers**: Usage in some older browsers could result in inconsistent behaviour due to their handling of JavaScript features.

## 5. Recommendations for Refactoring

- **Modularisation**:
  - Move the logic for generating `PageViewID` into a separate function to improve readability and maintainability.
  
```javascript
function generatePageViewID() {
    return (new Date()).getTime().toString(36) + Math.random().toString(36).split(".").join("");
}
```

- **Defensive Checks**:
  - Although it is mentioned not to add defensive coding for `eventType` and `eventPayload`, consider verifying the structure of `b` before assignment to ensure robustness against future changes.

- **Code Style**:
  - Maintain consistent indentation and spacing for better readability, and document the purpose of the function with comments.

## 6. Maintenance & Further Notes

- **Ongoing Maintenance**:
  - The extension should be reviewed periodically to ensure compatibility with new releases of the Tealium iQ platform as well as the global analytics libraries it interacts with.
  
- **Ownership**:
  - Assign a specific team member or role responsible for managing the extension, including monitoring its performance and addressing any issues that arise.

- **Testing Guidelines**:
  - Conduct thorough testing after modifications are made. Ensure that the extension behaves correctly across different scenarios, especially in environments with varying configurations of analytics libraries.

With this documentation, developers and stakeholders can understand the purpose, functionality, and maintenance needs of the "Cross-Tag PageViewID" extension within the Tealium iQ framework.