# Tealium iQ Extension Documentation

## Extension Overview

- **Name**: Workday Querystring Persistence
- **ID**: 1736
- **Type**: Javascript Code
- **Scope**: 1495
- **Execution Frequency**: Active

### Summary
The "Workday Querystring Persistence" extension captures specific query string parameters (`utm` variables and `source`) from the URL of the current page and persists them into a session cookie. The extension then scans all hyperlinks on the page to find links that lead to Workday job listings. If such links are found, the extension appends the persisted UTM parameters to these links, facilitating tracking for job application sources through UTM codes.

---

## Code Explanation

### Key Variables
- **relevantQuerystring**: A string containing UTM parameters and the `source` parameter extracted from the current page's URL query string.
- **workday_utm**: The value of the `workday_utm` cookie which stores the relevant UTM parameters for later use.
- **workdayLinks**: A collection of hyperlink elements (`<a>`) present on the current webpage.
- **workdayLinksArray**: An array of hyperlinks that specifically lead to Workday job pages, filtered from the `workdayLinks`.

### Logic Flow
1. **Extract Query String Parameters**: The extension retrieves the URL's query string, splits it, and filters for parameters starting with `utm` or the `source` parameter. These are then URL-encoded and concatenated into a single query string.
2. **Store UTM Parameters**: If there are any relevant UTM parameters, they are stored in a session cookie named `workday_utm`.
3. **Retrieve Cookie**: The extension checks for the existence of the `workday_utm` cookie and retrieves its value.
4. **Find Workday Links**: It iterates through all anchor elements on the page, filtering for those that contain "lbg.wd3.myworkdayjobs.com" in the URL.
5. **Append Parameters**: For each filtered Workday link, the stored UTM parameters are appended to the hyperlink as a query string.
6. **Log Action**: If the `LBGAnalytics` object is available, it logs how many Workday links were updated with UTM parameters.

### Dependencies
- **window.LBGAnalytics**: This global object is used for logging the actions taken by the extension. It must be available in the global scope for logging to occur.

---

## Usage Examples

### Normal Flow
- A user accesses a job listing page with the URI `"https://example.com?utm_source=google&utm_medium=cpc"`.
- The extension captures the UTM parameters, stores them as a cookie, and then updates any Workday job links on the page, such as:
  - Original URL: `https://lbg.wd3.myworkdayjobs.com/job1`
  - Updated URL: `https://lbg.wd3.myworkdayjobs.com/job1?utm_source=google&utm_medium=cpc`

### Edge Conditions
- If no UTM parameters are present in the query string: The cookie will not be set, and no links will be modified.
- If there are no Workday job links on the page: The extension will log that no links were updated and terminate without making changes.
- If `LBGAnalytics` is not defined: No logging will occur, but the functionality of the extension will still work.

---

## Known Limitations & Gotchas

- **Cookie Policy**: The extension relies on cookies to store UTM parameters. If browser settings block third-party cookies, this may lead to failed tracking.
- **Link Filtering Logic**: The extension currently only appends UTM parameters to links that contain "lbg.wd3.myworkdayjobs.com". Links not adhering to this pattern will not be modified, which may differ based on URL structures or future changes.
- **Timing Issues**: If the extension execution is delayed (due to heavy scripts or slow loading elements), cookies may not be set in time for subsequent scripts that require them.

---

## Recommendations for Refactoring

1. **Defensive Checks**: Implement conditions to validate whether the cookie was successfully written before proceeding. This ensures links can depend on the presence of `workday_utm`.
2. **Code Style**: Consistently use `var` for variable declarations to adhere to ES5 standards, and include inline comments to clarify complex logic.
3. **Modularization**: Consider breaking the code into smaller, logical functions that handle specific tasks (e.g., `extractUTMParameters`, `updateWorkdayLinks`, etc.) to enhance readability and maintainability.

---

## Maintenance & Further Notes

- **Ownership**: Assign a primary owner from the development team to oversee updates, monitor its performance, and manage testing efforts.
- **Testing Guidelines**: To validate functionality, conduct tests across various browsers and ensure cookie settings allow for storage. Monitor for any impacts on page load speed due to the extension's operations.
- **Documentation Updates**: Keep this documentation updated alongside any changes made to the code. Use version control best practices to manage updates to the extensionâ€™s functionality.

---