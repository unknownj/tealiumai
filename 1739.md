# Tealium iQ Extension Documentation: Additional Link Decoration

## 1. Extension Overview
- **Name**: Additional Link Decoration
- **ID**: 100036
- **Type**: Javascript Code
- **Scope**: DOM Ready
- **Execution Frequency**: Run Once

### Summary
The "Additional Link Decoration" extension enhances tracking capabilities for link clicks on specified domains by applying a special decoration to eligible anchor tags (`<a>` elements). This extension is designed to improve user behaviour tracking when users interact with outbound links to ensure data accuracy and relevance in analytics reporting.

---

## 2. Code Explanation

### Key Variables
- **eligibleDomains**: An array of domains where the decoration should be applied. Links pointing to these domains are eligible for additional tracking.

### Logic Flow
1. **Event Listener**: The extension attaches a `mousedown` event listener to all anchor tags (`<a>`) with an `href` attribute.
2. **Link Validation**:
   - Checks if the clicked link starts with "https://".
   - Ensures the link does not point to the default domain (ensuring internal links are excluded).
   - Excludes certain paths related to login and secure forms.
   - Validates if the link belongs to any of the `eligibleDomains`.
3. **Decoration Application**: If the link passes all validations, the `$this.decorate` method is called with the relevant parameters to apply the tracking decoration.

### Dependencies
- **LBGAnalytics**: The extension relies on the `LBGAnalytics` global object, ensuring the jQuery-like `$` function is available for DOM manipulation and event handling.
- This code is compatible with jQuery or a similar library which provides the `$` function.

---

## 3. Usage Examples

### Normal Conditions
- When a user clicks on an anchor link to `https://www.halifax-online.co.uk/somepage`, which is within the `eligibleDomains`, the link will be decorated with "LBGAc".

### Edge Conditions
- If a user clicks on `http://www.halifax-online.co.uk/somepage` (HTTP protocol), no decoration will be applied.
- If the link belongs to a non-eligible domain, such as `https://www.example.com`, it will be ignored and no decoration will occur.
- Links containing specific paths like `/personal/logon/login.jsp` (without "target=") or `/cwa/h/ccc/` will also not receive decoration.

---

## 4. Known Limitations & Gotchas
- Links that do not start with the HTTPS protocol are ignored, which may inadvertently exclude some valid links if they do not conform.
- The extension may fail quietly; the "try-catch" block suppresses errors, which could make troubleshooting difficult.
- If other extensions manipulate link decoration or manage events for anchor tags, there may be conflicts, particularly if they also apply UI enhancements or analytics.

---

## 5. Recommendations for Refactoring
- **Defensive Checks**: While the current checks are somewhat robust, consider adding checks to confirm that the necessary properties are available within `LBGAnalytics`.
- **Modularisation**: Break down the code into smaller functions to enhance readability and maintainability. For example, create a function to handle domain validation and another for applying decoration.
- **Logging**: Implement a more robust logging mechanism to capture any unexpected errors instead of simply logging them to the console.
- **Comments**: Add more inline comments for clarity, especially on non-trivial logic or why certain domains are excluded.

---

## 6. Maintenance & Further Notes
- **Ownership**: Assign a team member for long-term ownership of this extension to oversee changes.
- **Testing**: Regularly test this extension after updates to the site or other related extensions to ensure continued functionality.
- **Documentation Updates**: Ensure that any structural changes in the configuration or logic are documented promptly to maintain clarity for future developers.
- **Performance Monitoring**: Keep an eye on the performance impact, as extensive DOM manipulations could slow down page load times.

--- 

This structured documentation aims to serve developers and stakeholders interested in understanding, maintaining, or enhancing the “Additional Link Decoration” Tealium iQ extension.