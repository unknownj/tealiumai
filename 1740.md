```markdown
# Tealium iQ Extension Documentation: FPHD

## Extension Overview
- **Name**: FPHD
- **ID**: 100036
- **Type**: Javascript Code
- **Scope**: 1459
- **Execution Frequency**: Active

### Summary
The FPHD extension is designed to handle first-party data collection, specifically for email and phone information, through user interactions on web pages. It processes data through the definition of specific eligibility expressions and field selectors. This extension aims to enhance data accuracy and streamline the data collection process while ensuring compliance with cookie targeting policies.

## Code Explanation

### Key Variables
- **`u.FPHD`**: Main object that encapsulates all functionalities related to FPHD data handling.
- **`window.fphdLog`**: Object used for logging various events and states within the FPHD execution flow.
- **`u.FPHD.data`**: Object storing the hashed values of collected email and phone information.
- **`u.FPHD.eligibilityExpressions`**: Array of conditions to determine if the extension should process the current page.
- **`u.FPHD.dataItems`**: Array defining the fields to be collected (email, phone) along with their corresponding selectors and validation logic.

### Logic Flow
1. **Initialisation**: The extension checks if `u.FPHD` is already defined to prevent multiple initialisations.
2. **Event Listeners**:
   - A listener for input field changes is added to detect updates. When a change occurs, it verifies if the input matches defined selectors, validates it, and extracts the email/phone.
   - An onload listener that processes fields upon page load for initializing values from existing form fields.
3. **Data Hashing**: Values for email and phone are hashed using `utag.ut.sha256.SHA256`.
4. **Storage**: The collected data is stored in both global object `b` and session storage to persist during user interaction.

### Dependencies
- Assumes availability of global object `LBGAnalytics` for logging actions and selector functionality (e.g., `LBGAnalytics.$`).
- Utilises `utag.ut.sha256` to perform hashing operations.

## Usage Examples

### Normal Behaviour
- When a user updates their email in any of the designated input fields, the extension logs this change, validates the format, and stores the hashed email address in both the global object and session storage. 

### Edge Conditions
- If the entered email is invalid (e.g., does not match the regular expression), it ignores the change without throwing errors.
- If cookie targeting is disabled (i.e., `CookiesTargeting` is false), the extension will not process any inputs, and no values will be collected or logged.

## Known Limitations & Gotchas
- The extension may not function properly if the expected input fields are renamed or removed; this requires careful management of the field selectors.
- It relies heavily on the structure of the DOM and could break if there are significant changes to the page layout or class names used for the selectors.
- There are no fallback mechanisms if session storage is unavailable or denied by the user's browser settings.

## Recommendations for Refactoring
- **Code Structure**: Consider breaking down the functions into smaller, reusable modules to improve readability and maintainability.
- **Logging Improvements**: Implement more detailed logging, including error messages upon exceptions, to assist with debugging.
- **Validation Enhancements**: Centralise the validation functions for email and phone number to promote reusability and reduce redundancy.
- **Error Handling**: Enhance error handling mechanisms to log failures explicitly, which would aid in troubleshooting.

## Maintenance & Further Notes
- Regularly review the eligibility expressions and field selectors to ensure they meet current business requirements as the website and its forms evolve.
- Testing should be performed on all browsers and scenarios typical to user interactions to ensure that no regressions occur after any changes to the code.
- Ownership should be assigned to a specific team responsible for monitoring the extension's performance, resolving issues, and implementing updates as necessary.
```
