# Tealium iQ Extension Documentation

## 1. Extension Overview

- **Name**: AOU and BOU Config for custom template 992
- **ID**: 1743
- **Type**: Javascript Code
- **Scope**: Pre Loader
- **Execution Frequency**: Run Once

### Summary
This extension configures the tag management for the AOU (Analytics and Optimisation Unit) and BOU (Business Operations Unit) specific to a custom template identified as 992. It defines rules for which tags can execute under specific conditions, especially concerning user consent and page type (critical pages versus general pages). This ensures compliance with privacy regulations and optimises tag deployment on relevant pages.

---

## 2. Code Explanation

### Key Variables
- **`requiresCSP`**: An array indicating which tags require Content Security Policy (CSP) approval.
- **`omitTags`**: An array of tag IDs that are exempt from the Privacy Manager because they run regardless of user consent.
- **`essentialTags`**: Tags permitted to execute on the logon page while all non-essential tags are blocked.
- **`criticalPages`**: An array detailing the pages where non-essential tags are restricted.
- **`ngaAllowable`**: Tags that are authorised to run within webviews in a mobile app.

### Logic Flow
1. The extension first establishes CSP requirements by specifying which tags must be approved.
2. It lists tags that are applicable regardless of consent status to ensure they are not blocked.
3. Tags that are essential for functioning on logon pages are explicitly allowed to execute.
4. It also delineates pages that are critical where only essential tags may fire, reinforcing user data security on sensitive pages.
5. Lastly, it specifies which tags can function within app webviews, ensuring compatibility across platforms.

### Dependencies
The extension relies on the availability of Tealium's global object `LBGAnalytics` to populate the `tagConfig`, ensuring adherence to the overall infrastructure of Tealium implementations.

---

## 3. Usage Examples

### Sample Scenarios

#### Normal Operation
In a standard user session:
- A user accesses the home page, where various tags (e.g., analytics and marketing) load as per the general tag configuration.
- When the user navigates to the logon page (`/logon/login.jsp`), only tags specified in `essentialTags` (e.g., Adobe, Demdex) are allowed to execute, ensuring compliance with security requirements.

#### Edge Conditions
- If a user attempts to access a critical page not defined in `criticalPages`, all tags other than those in `essentialTags` will fail to load. 
- For users accessing the app through webviews, tags in `ngaAllowable` such as Adobe and Mapp will execute while external non-compliant tags will be omitted.

---

## 4. Known Limitations & Gotchas

- **Consent Overlap**: Tags not specified in `omitTags` or `essentialTags` may inadvertently be blocked if the user's consent status changes.
- **Page Complexity**: If critical pages are updated or renamed without amending the `criticalPages` array, critical tags may not execute properly.
- **Compatibility Conflicts**: If other extensions manipulate the `tagConfig` object or similar global objects, there may be unintended consequences in tag loading order or functionality.
  
---

## 5. Recommendations for Refactoring

- **Modularisation**: Break down configuration sections into their own functions to improve readability and maintainability. For instance, abstracting `requiresCSP`, `omitTags`, etc., into dedicated functions could enhance clarity.
- **Code Style**: Consider implementing comments consistently throughout for future developers to understand the reasoning behind the configurations.
- **Testing Hooks**: Introduce logging for debugging purposes, especially for determining tag execution outcomes on critical pages.

---

## 6. Maintenance & Further Notes

- **Ownership**: Assign a dedicated team or individual responsible for maintaining the configurations and ensuring they're up-to-date with business needs and compliance regulations.
- **Testing Guidelines**: Regularly test the extension across all relevant environments before deployment, paying special attention to critical pages and GDPR compliance.
- **Ongoing Updates**: Set a schedule for revisiting the extension every quarter to assess if any modifications are necessary due to changes in business processes, user behaviour, or legislative requirements.

--- 

This documentation serves as a comprehensive guide to understanding, using, and maintaining the Tealium iQ extension relevant to the AOU and BOU configurations. It is crucial to ensure that all members of the development and analytics teams are familiar with these guidelines to enhance collaboration and maintain alignment with business and legal standards.