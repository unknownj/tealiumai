# Tealium iQ Extension Documentation: Scrub SW Protect instances of Business User ID

## 1. Extension Overview

- **Name**: Scrub SW Protect instances of Business User ID
- **ID**: 1751
- **Type**: JavaScript Code
- **Scope**: After Load Rules
- **Execution Frequency**: Run Always

### Summary
This extension is designed to enhance user privacy by scrubbing the `BusinessUserID` parameter when the user is on pages that include "swprotect" in the URL path. This helps prevent the exposure of sensitive user identifiers in data layers or other tracking implementations that could be monitored or accessed by unauthorised individuals.

---

## 2. Code Explanation

### Key Variables
- `a`: Represents `eventType`, which is expected to be a string indicating the type of event being processed.
- `b`: Represents `eventPayload`, an object containing the data relevant to the event being processed.

### Logic Flow
1. The function immediately checks if the `BusinessUserID` exists in the `eventPayload` object (`b`).
2. It then checks if the current page URL path includes the substring "swprotect". This is accomplished by converting the path to lowercase and using `indexOf`.
3. If both conditions are met, the `BusinessUserID` found in the payload is redacted (i.e., replaced with the string "(redacted)").
  
### Dependencies
- The extension relies on the global `window` object to access the current page's URL through `window.location.pathname`.
- The `eventType` and `eventPayload` must be provided by the Tealium environment and are guaranteed to be present during the execution of the extension.

---

## 3. Usage Examples

### Normal Condition
**Scenario**: A user navigates to the page `/path/to/swprotect/profile`.
- `eventPayload`: `{ BusinessUserID: "12345-ABCDE" }`
- After execution: 
  - `eventPayload` is modified to `{ BusinessUserID: "(redacted)" }`.

### Edge Condition
**Scenario**: A user navigates to the page `/path/to/anotherpage`.
- `eventPayload`: `{ BusinessUserID: "67890-FGHIJ" }`
- After execution: 
  - `eventPayload` remains unchanged as the path does not contain "swprotect": `{ BusinessUserID: "67890-FGHIJ" }`.

---

## 4. Known Limitations & Gotchas
- The extension will not function if `BusinessUserID` is absent from the `eventPayload` object, resulting in no modifications.
- If multiple scripts are modifying `BusinessUserID` concurrently, race conditions may result, leading to unintended behaviours.
- The redacted value as "(redacted)" is static and does not allow for dynamic replacement or logging mechanisms to maintain any audit trails.
- Be cautious of conflicts with other extensions trying to read or manipulate `BusinessUserID`.

---

## 5. Recommendations for Refactoring
- **Defensive Checks**: Although we are not to handle the existence of `eventType` and `eventPayload`, it is a good practice in general to ensure parameter assumptions are met through early checks.
  
- **Code Style**: Consider adding comments within the code to explain the logic and the reasoning behind key decisions for better readability and future reference.
  
- **Modularisation**: While the current implementation is straightforward, encapsulating the redaction logic within a dedicated function may enhance readability and reusability if similar logic is needed elsewhere.
  
Here is a small suggestion for encapsulation:

```javascript
function scrubBusinessUserID(eventPayload) {
    if (eventPayload.BusinessUserID && window.location.pathname.toLowerCase().indexOf("swprotect") >= 0) {
        eventPayload.BusinessUserID = "(redacted)";
    }
}

(function(a, b) {
    scrubBusinessUserID(b);
})(eventType, eventPayload);
```

---

## 6. Maintenance & Further Notes
- Ensure the extension is reviewed periodically for compliance with privacy regulations.
- Establish ownership of the extension, identifying who is responsible for updates and issue resolution.
- Implement testing guidelines to validate functionality across different scenarios where the extension is expected to run. Automatic regression tests can help prevent accidental breaks in functionality after updates.
- Document any changes or modifications made to the extension for clarity in future revisions.

--- 

This documentation provides a comprehensive overview of the Scrub SW Protect instances of Business User ID extension and its implementation in Tealium iQ, serving as a reference for developers and stakeholders alike.