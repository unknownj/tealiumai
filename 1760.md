# Tealium iQ Extension Documentation: Abort Send for Duplicated Data

## 1. Extension Overview

- **Name**: Abort Send for Duplicated Data
- **ID**: 1760
- **Type**: JavaScript Code
- **Scope**: 928
- **Execution Frequency**: Active

### Summary
This extension is designed to prevent the transmission of duplicate or unnecessary data events from the Tealium iQ tag management system. By implementing specific checks based on user interactions within a journey and by matching certain criteria, the extension ensures that only valid and actionable data is sent. This helps in maintaining cleaner data and optimising the analytics process.

---

## 2. Code Explanation

### Key Variables

- `a`, `b`, `u`: Parameters representing event type, event payload, and tag object respectively.
- `Window.location.pathname`: Used to determine the current URL path of the page to decide whether to abort sending data.
- `b.JourneyName`, `b.JourneyStepName`, `b.JourneyAction`: Variables representing the current journey's context and user steps, critical for determining the relevance of the event.
- `en` (Event Narrative): A string representing the narrative of the event being processed. Its contents dictate whether the event should be sent.

### Logic Flow

1. **Force Send Check**:
   - Immediately returns `true` if the `ForceSend` property is present in the `b` object, allowing all data to be sent regardless of other checks.

2. **Path Check for 'cwa'**:
   - If the page path contains "cwa" and critical journey parameters (`JourneyName`, `JourneyStepName`, `JourneyAction`) are missing, the function returns `false`, preventing data transmission.

3. **Logon Second Factor Step**:
   - When the `JourneyName` is "Logon Second Factor", it forms a unique string identifier based on the current step parameters.
   - If the current step matches the previously stored step in `window.lsfCurrentStep`, it returns `false`, otherwise updates the stored step.

4. **Transaction Checks**:
   - For JourneyName "maketransaction", it checks if `EventNarrative` is a string and looks for specific phrases to determine if the event should be aborted (e.g., various payment-related prompts).

### Dependencies
- No external libraries or additional global objects are needed. The extension leverages standard browser functionality and the existing `eventPayload` and `eventType` parameters provided by Tealium.

---

## 3. Usage Examples

### Normal Conditions
- **Scenario**: A user proceeds through the transaction journey with a specific user action.
  - The extension allows the data to be sent as all required fields are present.

### Edge Conditions
- **Scenario**: A user visits a URL containing "cwa" with an incomplete journey context.
  - The extension aborts sending the data, ensuring no empty or redundant data reaches the analytics.

- **Scenario**: A user triggers a second logon attempt which matches the previous steps.
  - The extension successfully blocks the repeat event, avoiding duplicate data entries in the system.

---

## 4. Known Limitations & Gotchas

- The extension strictly checks for the presence of specific journey-related variables and only aborts based on these checks. If these conditions are not met, valid data may be unnecessarily blocked.
- There might be a conflict with other extensions if they modify shared variables or conditions used for journey tracking.
- Pay attention to the specific strings in `EventNarrative` — any changes to the phrasing used could inadvertently affect data handling.

---

## 5. Recommendations for Refactoring

- **Defensive Checks**:
  - While current assumptions are valid, adding checks to ensure expected data types (e.g., checking that `b.JourneyName` is a string) may enhance reliability.

- **Code Style**:
  - Utilize descriptive function names or modular functions to improve readability and maintainability.

- **Modularization**:
  - Breaking down checks into smaller functions could simplify testing and enhance clarity. For example, separate functions for journey checks and event narrative checks could be beneficial.

- **Comments**:
  - Add inline comments to explain critical sections of logic may aid future developers in understanding the intent behind certain checks.

---

## 6. Maintenance & Further Notes

- **Ongoing Maintenance**:
  - Regular reviews should be scheduled to ensure that the extension continues to meet evolving requirements and to accommodate any changes in the business logic surrounding journey data.

- **Ownership**:
  - Assign a dedicated team member or stakeholder to monitor the extension’s performance and address any related issues promptly.

- **Testing Guidelines**:
  - Rigorous testing should be performed whenever changes are made, including unit tests for each modular component, to ensure all journey scenarios behave as expected.

---

This documentation aims to provide developers and stakeholders with a comprehensive understanding of the "Abort Send for Duplicated Data" extension and its intended utility within the Tealium iQ environment.