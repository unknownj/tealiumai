# Tealium iQ Extension Documentation: Yext Switches

## 1. Extension Overview

- **Name**: Yext switches
- **ID**: 1775
- **Type**: Javascript Code
- **Scope**: 1525
- **Execution Frequency**: Upon triggering of specific events

### Summary
The "Yext switches" extension is designed to enable analytical functionalities in the Yext Answers system, specifically by managing user opt-in settings for analytics and session tracking. This extension ensures that users' preferences regarding analytics and session tracking are respected, thereby enhancing compliance with privacy regulations and user expectations.

## 2. Code Explanation

### Key Variables
- **ANSWERS**: This is a global object representing the Yext Answers SDK, which provides methods for managing user settings.
- **AnswersExperienceFrame**: Another global object that allows developers to configure the experience frame settings, including session and analytics event tracking.

### Logic Flow
The extension operates as follows:
1. It checks for the existence of the `ANSWERS` global object. If it is present:
   - It sets the analytics opt-in to `true` via `ANSWERS.setAnalyticsOptIn(true)`.
   - It also sets the session opt-in to `true` using `ANSWERS.setSessionsOptIn(true)`.
   
2. Next, it checks for the presence of the `AnswersExperienceFrame` global object. If found:
   - The session tracking is enabled by calling `AnswersExperienceFrame.runtimeConfig.set("sessionTrackingEnabled", true)`.
   - It allows analytics events to be processed by executing `AnswersExperienceFrame.runtimeConfig.set("analyticsEventsEnabled", true)`.

This structure ensures that the code executes optimally based on the existence of the relevant Yext SDK objects.

### Dependencies
- The extension relies heavily on the global objects `ANSWERS` and `AnswersExperienceFrame`. If these objects are not present, the extension's functionality will not execute as expected.

## 3. Usage Examples

### Normal Conditions
- When a user visits a web page with the Yext Answers system integrated, and if the `ANSWERS` and `AnswersExperienceFrame` objects are available, the extension will automatically enable analytics and session tracking, allowing for data collection and reporting in the analytics system.

### Edge Conditions
- **Scenario 1**: If the `ANSWERS` object is unavailable, the extension will not alter any analytics or session settings, potentially leading to improper tracking setup.
- **Scenario 2**: If `AnswersExperienceFrame` is not found, session tracking will not be enabled, leading to a lack of session data which could affect analytics reports.

## 4. Known Limitations & Gotchas

- **Dependency on Global Objects**: If either the `ANSWERS` or `AnswersExperienceFrame` objects are not included in the web page, this extension will fail silently without any error messaging, potentially causing confusion for developers.
  
- **Potential Conflicts**: The extension may conflict with other custom scripts or Tealium extensions that modify or depend on the same global objects. Such conflicts might lead to unexpected behaviours in the tracking functionalities.

## 5. Recommendations for Refactoring

- **Add Defensive Checks**: While eventType and eventPayload are guaranteed to be present, encapsulating the logic within additional checks can improve reliability. For instance, validating the types and existence of the `ANSWERS` and `AnswersExperienceFrame` objects before operating on them could prevent silent failures.

- **Code Structure**: Consider modularising the logic into functions for better readability. For example, separate functions for setting analytics opt-in and session tracking can make the code clearer and easier to maintain.

  ```javascript
  function enableAnalytics() {
      if (ANSWERS) {
          ANSWERS.setAnalyticsOptIn(true);
          ANSWERS.setSessionsOptIn(true);
      }
  }

  function enableSessionTracking() {
      if (AnswersExperienceFrame) {
          AnswersExperienceFrame.runtimeConfig.set("sessionTrackingEnabled", true);
          AnswersExperienceFrame.runtimeConfig.set("analyticsEventsEnabled", true);
      }
  }

  (function(a, b, u) {
      enableAnalytics();
      enableSessionTracking();
  })(eventType, eventPayload, tagObject);
  ```

## 6. Maintenance & Further Notes

- **Ownership**: Assign a dedicated developer or team to oversee this extension, ensuring it is updated as necessary whenever Yext updates its APIs or the web environment changes.

- **Testing Guidelines**: Regularly test the extension in staging environments with various configurations of the Yext SDK and under different user conditions to verify the integrity of the extension's functionality.

- **Documentation Updates**: As new features or changes are introduced in the Yext Answers SDK, update this documentation to reflect those changes promptly to maintain accuracy for future developers.

By following these guidelines, the "Yext switches" extension can be maintained and improved over time, ensuring its reliability and adherence to user privacy preferences.