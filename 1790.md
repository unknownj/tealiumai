# Tealium iQ Extension Documentation

## 1. Extension Overview
**Extension Details:**
- **Name:** RTIM Interface Module
- **ID:** 1790
- **Type:** Javascript Code
- **Scope:** Pre Loader
- **Execution Frequency:** Run Once

**Summary:**
The RTIM Interface Module is designed to facilitate communication between the tracking system and the Celebrus data management platform. It defines an object (`LBGAnalytics.rtim`) that processes messages received from user journeys or pages. These messages are formatted into a structured celebrus object, which is subsequently sent to the appropriate tracking mechanism.

## 2. Code Explanation

### Key Variables
- `LBGAnalytics.rtim`: A namespace that houses the methods and properties related to the RTIM interface.
- `celebrusObject`: An object that collects message data with predefined properties, ensuring adherence to expected formats.

### Logic Flow
1. **Initialization**: The code begins by checking if `LBGAnalytics.rtim` is already defined; if not, it initializes it as an empty object.
2. **Message Method**: The core function is `LBGAnalytics.rtim.message`, which accepts various parameters to construct the celebrus object.
3. **Input Processing**: The method checks the data types of the incoming parameters, ensuring they are strings and assigning them to `celebrusObject`.
4. **Object Handling**: If the first parameter is an object, the function iterates through the objectâ€™s properties and assigns valid (string) properties to `celebrusObject`.
5. **Event Dispatching**: Finally, the populated `celebrusObject` is sent to `LBGAnalytics.leads.sendEvent`, triggering the tracking event.

### Dependencies
This extension relies on the global `LBGAnalytics` object and its `leads` namespace for sending events. It is crucial that these are defined within the environment for the extension to work correctly.

## 3. Usage Examples

### Basic Usage
To send a message with string parameters:
```javascript
LBGAnalytics.rtim.message("messageKey", "responseName", "interactionPoint", "contentKey", "mboxId", "messagePathId");
```

### Using an Object
To send a message with an object:
```javascript
LBGAnalytics.rtim.message({
  messagekey: "messageKey",
  response: "responseName",
  inp: "interactionPoint",
  contentkey: "contentKey",
  mboxid: "mboxId",
  messagePathId: "messagePathId"
});
```

### Edge Cases
1. **Missing Parameters**: If any parameter is not provided (or is `undefined`), the corresponding field in the `celebrusObject` is set to `undefined`.
2. **Non-String Values**: If non-string values are provided for any parameters, they are omitted from the `celebrusObject` due to strict type checks.

## 4. Known Limitations & Gotchas
- **Property Overwrite**: When passing an object, if a property not in the predetermined list is included, it will be ignored. Similarly, properties matching those names but not being strings will not be added to the final object.
- **Execution Timing**: The extension runs only once during the pre-loader phase, which may not capture multiple page interactions effectively.
- **External Conflicts**: If there are other extensions or scripts that modify `LBGAnalytics`, unexpected results or conflicts might arise.

## 5. Recommendations for Refactoring
- **Function Modularization**: Consider breaking down the `message` function into smaller helper functions for better readability and maintainability.
- **Input Validation**: Although current checks are sufficient, adding checks for empty strings might prevent erroneous submissions.
- **Comments and Documentation**: Maintain comments explaining the purpose of complex logic to enhance clarity for future developers.

## 6. Maintenance & Further Notes
- **Ongoing Maintenance**: The extension should be reviewed regularly, especially if changes occur in the Celebrus API or the `LBGAnalytics` framework.
- **Ownership**: Assign a primary contact responsible for this extension to ensure there is accountability.
- **Testing Guidelines**: Implement unit tests for various scenarios, particularly focusing on input handling and integration with the `LBGAnalytics.leads` module. This will help ensure the functionality remains stable as changes are introduced.

---

This documentation provides a comprehensive overview of the RTIM Interface Module, detailing its structure, functionality, and recommendations for usage and future improvements.