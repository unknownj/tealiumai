# Tealium iQ Extension Documentation: MAU : Brand Lookup

## 1. Extension Overview
- **Name**: MAU : Brand Lookup
- **ID**: 1805
- **Type**: Lookup Table
- **Scope**: 1550, 1611
- **Execution Frequency**: On designated events (e.g., "view", "change")

### Summary
This extension captures and persists values for identifying mass affluent traffic on the mortgage calculator. It sets up a framework that collects and categorises user data such as the number of applicants, income levels, and property price. By implementing this extension, stakeholders can effectively analyse user behaviour and tailor marketing strategies for targeted customer segments.

---

## 2. Code Explanation

### Key Variables
- `window.MCMALog`: An object used to log flags that indicate various user behaviours and eligibility criteria.
- `u.MCMA`: The main object of the extension responsible for state management, data persistence, and event handling.

### Logic Flow
1. **Initial Setup**: The extension first checks if `u.MCMA` is defined. If not, it initializes `window.MCMALog` and `u.MCMA`.
2. **Eligibility Definitions**: The `eligibilityExpressions` array contains conditions that determine whether the extension should collect data based on the user's interaction on the mortgage calculator.
3. **Data Items and Validation**: The `dataItems` array defines the fields a user has to fill out. Each item includes:
    - `fieldName`: Human-readable name of the data point.
    - `fieldCode`: Corresponding code used for flags.
    - `fieldSelectors`: CSS selectors for targeting input fields.
    - `validation`: A function that validates user input data.
4. **Event Listener**:
    - A change event listener is added for input fields matching `fieldSelectors`. If a relevant change is detected, the corresponding validation function is invoked.
5. **Data Processing on Specific Events**: If the extension is triggered (`a === "view"` or when the journey steps match), it performs the following:
    - Obtains maximum affordability and income values.
    - Constructs the `MCMAflgs` string containing flags based on analysed data.
6. **Data Transmission**: The constructed flags are sent to Tealium and other analytics:

| **Data Managed** | **Behaviour**                            |
|-------------------|-----------------------------------------|
| Maximum Affordability | Flags userâ€™s financial capability    |
| Income Level       | Segments users based on income range   |
| Property Price     | Indicates property-related user context |

### Dependencies
The extension relies on:
- **Global Objects**: `LBGAnalytics`, `utag`, and `clova3`.
- **Event Handling**: Uses `document.addEventListener` to respond to user input.

---

## 3. Usage Examples

### Normal Conditions
- When a user interacts with the mortgage calculator input fields (e.g., updates income):
    - Input is validated.
    - Changes are logged in `window.MCMALog`.
    - Relevant flags are built and sent to the data layer.

### Edge Conditions
- If users input invalid data (e.g., non-numeric values):
    - Validation functions handle errors gracefully.
    - No flags are set for invalid inputs, ensuring that only valid data flows through.

- If the user does not meet eligibility criteria, no data is collected:
    - The system logs appropriately and skips unnecessary processing.

---

## 4. Known Limitations & Gotchas
- **Limited to Specific Conditions**: The extension may not operate for all user flows outside the defined `eligibilityExpressions`.
- **Selector Dependency**: If HTML structure changes (e.g., input field names), the selectors may break, leading to the extension becoming non-functional.
- **Privacy Matters**: There are checks for user privacy that dictate whether tracking occurs, which may limit data collection in certain conditions.

---

## 5. Recommendations for Refactoring
- **Defensive Checks for Inputs**: Enhance validation routines to more explicitly handle unexpected or malicious user inputs.
- **Modularization**: Divide lengthy functions into smaller, reusable components for better readability and maintainability.
- **Commenting**: Although the code is reasonably documented, additional inline comments clarifying complex logic would enhance understanding for future developers.
- **Error Handling**: Currently ignores exceptions in `try-catch` blocks; consider logging errors for debugging purposes. 

---

## 6. Maintenance & Further Notes
- **Ownership**: Assign a dedicated team member for ongoing maintenance, ensuring the extension remains compatible with Tealium updates and business requirements.
- **Testing Guidelines**: Regularly conduct tests after major updates to ensure that all features function correctly, particularly after any changes to HTML structure or related dependencies.
- **Documentation Updates**: Keep this document updated with any future changes or enhancements to the extension code, ensuring stakeholders have access to the latest information.

---

This documentation serves as a comprehensive guide for developers working with the "MAU : Brand Lookup" extension in Tealium iQ, ensuring clarity and understanding of its function, implementation, and maintenance.