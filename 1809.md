# Tealium iQ Extension Documentation

## 1. Extension Overview

- **Name:** MAU: put values into arrays for the tag
- **ID:** 100036
- **Type:** Javascript Code
- **Scope:** 1550, 1611
- **Execution Frequency:** Active

### Summary
This extension is designed to transform specific event payload data into arrays for compatibility with the tagging system. This is crucial because certain tagging systems do not accept individual string values and require arrays for proper data handling. The extension pushes relevant product and order information into respective arrays, ensuring that the correct data structure is maintained for tracking.

---

## 2. Code Explanation

### Key Variables
- `a` (eventType): The type of event being processed.
- `b` (eventPayload): An object containing the event data sent from the source.
- `u` (tagObject): An object representing the tag context in which the extension is executed.

### Logic Flow
1. The code starts by pushing values from the event payload (`b`) into predefined arrays in the `u.data` object.
2. It extracts key attributes such as `JourneyProduct`, `JourneyName`, `Brand`, and `ProductGroup`, and pushes these values into their respective arrays.
3. The code also sets the `product_quantity` to `1` for each entry.
4. For the `order_subtotal`, it checks if the `JourneyAmount` is less than or equal to `0`. If it is, it sets `order_subtotal` to that `JourneyAmount`, otherwise, it defaults it to `1`.
5. Finally, it sets the `order_currency` to "GBP".

### Dependencies
- The extension relies on the `eventType`, `eventPayload`, and `tagObject` being present and in the correct structure.
- The `u.data` object must be predefined with array properties for products and order details.

---

## 3. Usage Examples

### Typical Use Case
When an event is triggered with a payload containing product details, this extension processes the data as follows:
- **Input Example:**
  ```javascript
  eventPayload = {
      "JourneyProduct": "12345",
      "JourneyName": "Sample Product",
      "Brand": "Sample Brand",
      "ProductGroup": "Sample Category",
      "JourneyAmount": 100
  };
  ```
- **Output in `u.data`:**
  ```javascript
  u.data.product_id = ["12345"];
  u.data.product_name = ["Sample Product"];
  u.data.product_brand = ["Sample Brand"];
  u.data.product_category = ["Sample Category"];
  u.data.product_quantity = [1]; 
  u.data.order_subtotal = 100;
  u.data.order_currency = "GBP";
  ```

### Edge Condition
If the `JourneyAmount` provided is `0` or negative:
- **Input Example:**
  ```javascript
  eventPayload = {
      "JourneyProduct": "12345",
      "JourneyName": "Sample Product",
      "Brand": "Sample Brand",
      "ProductGroup": "Sample Category",
      "JourneyAmount": -50
  };
  ```
- **Output in `u.data`:**
  ```javascript
  u.data.order_subtotal = -50; // Unexpected value, potential issue
  ```

---

## 4. Known Limitations & Gotchas

- If the arrays in `u.data` are not initialized before this extension runs, pushing values will result in runtime errors. Ensure that the arrays exist and are empty before this extension executes.
- The extension does not handle cases where the `JourneyAmount` is less than `0` gracefully, leading to potentially unintended values for `order_subtotal`.
- Reliance on specific keys (e.g., `JourneyProduct`, `JourneyName`) implies that any changes in the event payload structure will break functionality unless adjusted accordingly.

---

## 5. Recommendations for Refactoring

- **Initialisation Check:** Ensure arrays in `u.data` are initialised if they are absent to prevent runtime errors.
  ```javascript
  u.data.product_id = u.data.product_id || [];
  u.data.product_name = u.data.product_name || [];
  u.data.product_brand = u.data.product_brand || [];
  u.data.product_category = u.data.product_category || [];
  u.data.product_quantity = u.data.product_quantity || [];
  ```
  
- **Modular Code:** Consider breaking down the logic into smaller functions to enhance readability and maintainability.
- **Error Handling:** Introduce checks or fallback values for the `JourneyAmount` to handle unexpected or malformed data inputs effectively.
  
---

## 6. Maintenance & Further Notes

- **Ownership:** Designate a team member for ongoing maintenance and updates to this extension as payload and business requirements evolve.
- **Testing Guidelines:** Implement unit tests to validate functionalities, especially when modifying code related to data extraction and array management.
- **Documentation Updates:** Revise documentation to reflect any changes to the code or business logic to ensure accuracy for future developers.

---
> This documentation is intended to facilitate understanding and future development efforts for Tealium iQ extensions. Ensure to follow the guidelines and best practices outlined while working with this extension.