# Tealium iQ Extension Documentation: Show Hide 23

## 1. Extension Overview
- **Name:** Show Hide 23
- **ID:** 1812
- **Type:** Javascript Code
- **Scope:** After Tag Extensions
- **Execution Frequency:** Run Once

### Summary
The **Show Hide 23** extension dynamically manages the visibility of HTML elements based on specific configurations defined in a data layer object. When certain conditions are met, and a script from a designated endpoint is loaded, the extension triggers events to show or hide elements on the page. This allows for a responsive user interface that can adapt based on user interactions or other criteria.

## 2. Code Explanation

### Key Variables
- **shId:** A unique identifier for the script endpoint, generated from the hostname and pathname of the current URL, ensuring that each page has a distinct identifier.
- **shEndpoint:** The URL from which the script responsible for toggling visibility of elements is loaded.
- **showHideContainer:** The main container element where mutations are observed to determine changes in visibility.

### Logic Flow
1. The extension checks if there are any elements on the page that require show/hide logic by checking for the presence of attributes `data-show-elements` or `data-hide-elements`.
2. If such elements exist, it constructs a unique identifier (`shId`), builds the endpoint URL for the required script, and creates a `<script>` element to load it asynchronously.
3. Once the script is loaded, it invokes the `LBGAnalytics.dleShowHide` function, passing in the corresponding configuration for the current page.
4. Inside `LBGAnalytics.dleShowHide`, a `MutationObserver` is used to monitor changes to the `class` attribute of the `showHideContainer`. If an element's class changes from `hide` to visible, it sends the corresponding show/hide event defined in the configuration.

### Dependencies
- The code relies on the global object `LBGAnalytics` which must be defined elsewhere in the project. 
- Utilises the `MutationObserver` API, which is supported in most modern browsers.

## 3. Usage Examples

### Normal Conditions
1. When a user navigates to a page containing elements with the relevant data attributes, the script loads, and the initial configuration is retrieved.
2. If an element with an ID that matches any key in the `showHideConfig` becomes visible (the `hide` class is removed), the corresponding event data is sent using `LBGAnalytics.events.send`.

### Edge Conditions
1. If the external script fails to load due to network issues, handling of show/hide logic may not occur.
2. If the observed container does not exist on the page, the extension silently fails and no events are tracked.

## 4. Known Limitations & Gotchas
- The extension does not provide fallback behaviour if the configuration object is empty or malformed, which could lead to uncaught errors in the callback.
- Heavy use of mutation observers can lead to performance issues if many elements are monitored, especially on pages with a lot of dynamic content.
- Conflicts may arise with other extensions that manipulate the same DOM elements or manage similar visibility behaviors.

## 5. Recommendations for Refactoring
- **Defensive Checks:** Consider adding checks to confirm the existence of required properties in the `showHideConfig` before attempting to access them.
- **Code Style:** Maintain consistent code formatting and comments to improve readability and maintainability.
- **Modularization:** Split functionality into smaller, reusable functions to improve testability and reduce complexity. For instance, the observer function can be extracted.

```javascript
function createScriptElement(src, callback) {
    var script = document.createElement("script");
    script.src = src;
    script.async = true;
    script.onload = callback;
    return script;
}
```

## 6. Maintenance & Further Notes
- Regularly review the external endpoint URL for availability, as changes there may disrupt functionality.
- Ownership of this extension should ideally rest with a developer familiar with DOM manipulation and the needs of the analytics involved.
- Implement a robust testing strategy, including unit tests for individual functions and integration tests for the full flow of data from loading to event firing.
- Monitor the performance of the extension in production to identify any bottlenecks caused by continual observation of DOM mutations.

---

This document should serve as a comprehensive guide for developers and stakeholders involved in maintaining or extending the functionality of the Show Hide 23 Tealium iQ extension.