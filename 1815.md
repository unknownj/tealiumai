```markdown
# Tealium iQ Extension Documentation

## 1. Extension Overview
- **Name**: Facebook Pixel Event Type (No MC)
- **ID**: 1819
- **Type**: Lookup Table
- **Scope**: 1476, 1664
- **Execution Frequency**: On page load

### Summary
This extension is designed to modify the content of the `/loans.html` page on the `www.lloydsbank.com` domain when a specific query parameter (`targetdemo`) is detected in the URL. It creates a user interface that overlays the page to facilitate testing of Adobe Target integration, displaying logs, and handling requests for offers.

## 2. Code Explanation
### Key Variables
- **`window.location`**: Used to check the URL of the page.
- **`container`**: The main div where all the elements are appended to display the user interface.
- **`pendingElements`**: An array that stores elements to be added to the container in a controlled manner.
- **`targetTest`**: An object that holds request and response details related to the Adobe Target API.

### Logic Flow
1. **Condition Checking**: The main logic executes only if the hostname is `www.lloydsbank.com`, the pathname is `/loans.html`, and the URL contains the `targetdemo` query parameter.
  
2. **UI Setup**:
   - All child elements of the `container` are removed, and styles are applied.
   - A style block is created to define the appearance of the UI.

3. **Logging Events**: 
   - Existing `LBGAnalytics.target.events` are cleared, and a setInterval is started to handle logging every 500ms.

4. **Dynamic Content Creation**: 
   - Various UI elements (headings, paragraphs, lists) are created and pushed to the `pendingElements` array.
   - Two functions (`targetPageParams` and `targetPageParamsAll`) are overwritten to return a hardcoded object simulating a specific state for testing.

5. **Offer Requests**: 
   - A button is created for triggering offers, which applies Adobe Target's `getOffers` method and handles the response.
   - A second button is created to apply received offers and trigger a virtual page view event.

### Dependencies
- **`LBGAnalytics`**: This extension heavily relies on the `LBGAnalytics` global object for its functionalities, including making elements and event handling.

## 3. Usage Examples
### Normal Scenario
- When a user navigates to `www.lloydsbank.com/loans.html?targetdemo`, the extension creates an overlay with details such as:
  - Current `targetPageParams()` and `targetPageParamsAll()`.
  - A button to fetch offers and another to apply offers.
  
### Edge Condition
- If the extension is triggered without the proper URL conditions (missing `targetdemo`), it does nothing, thus not displaying any UI or triggering Adobe Target events.

## 4. Known Limitations & Gotchas
- **URL Dependency**: The extension is limited to a specific URL path and query parameter.
- **LBGAnalytics Dependencies**: The extension may cause errors if `LBGAnalytics` is unavailable or modified elsewhere in the codebase.
- **Static Responses**: The target parameters are hardcoded, which reduces flexibility in testing multiple states.

## 5. Recommendations for Refactoring
- **Error Handling**: Include more robust error handling around the Adobe Target API calls to manage rejected promises gracefully.
- **Code Modularity**: Break down the large anonymous function into smaller named functions to enhance readability and maintainability.
- **Minimise Global Scope Pollution**: Consider encapsulating variables or functions within an IIFE (Immediately Invoked Function Expression) to limit their exposure to the global scope.
- **Consistent Callback Handling**: Refactor to use clearer callbacks or event-driven approaches instead of inline event listeners, improving separation of concerns.

## 6. Maintenance & Further Notes
- **Ownership**: Assign a specific developer or team for ongoing maintenance of the extension.
- **Testing Guidelines**: Regularly test the extension in various environments to ensure it works under different conditions (e.g., with and without the `targetdemo` parameter).
- **Documentation Updates**: Continuously update this documentation as the extension evolves or new features are added.
```
