# Tealium iQ Extension Documentation

## 1. Extension Overview

- **Name**: GAD : HSDL Brand Lookup
- **ID**: 100020
- **Type**: Lookup Table
- **Scope**: 1574
- **Execution Frequency**: Active

### Summary
The "GAD : HSDL Brand Lookup" extension is designed to compile various payment-related attributes into a single formatted string when specific conditions are met. It processes event data associated with transactions and constructs a `JourneyProduct` string from user account details, transaction frequency, date, and recurrence, specifically when the `JourneyName` begins with "MakeTransaction". 

---

## 2. Code Explanation

### Key Variables
- **paymentType**: An array used to hold formatted strings representing the different types of payment data.
- **b**: Represents the `eventPayload` object, containing the data associated with the event being processed.

### Logic Flow
1. The extension checks for the presence of specific properties within the `eventPayload` (e.g., `RemitterAccountType`, `BeneficiaryAccountType`, `TransactionFrequency`, `TransactionDate`, `TransactionRecurrence`).
2. If any of the properties are present, they are formatted and pushed into the `paymentType` array:
   - **F**: Indicates the Remitter Account Type.
   - **T**: Indicates the Beneficiary Account Type.
   - **Q**: Indicates the Transaction Frequency.
   - **D**: Indicates the Transaction Date.
   - **R**: Indicates the Transaction Recurrence.
3. After all checks, if the `paymentType` array contains any elements and the `JourneyName` starts with "MakeTransaction", the `JourneyProduct` property of `eventPayload` is assigned a string that's a concatenation of the elements in the `paymentType` array, joined by a pipe (`|`).

### Dependencies
- The extension relies on globally defined objects, namely `eventType` and `eventPayload`, which are expected to be provided during invocation.
- No external libraries or frameworks are used within this extension.

---

## 3. Usage Examples

### Scenario 1: Normal Flow
- **Input**: 
  ```json
  {
    "RemitterAccountType": "Savings",
    "BeneficiaryAccountType": "Current",
    "TransactionFrequency": "Monthly",
    "TransactionDate": "2023-10-10",
    "TransactionRecurrence": "Recurring",
    "JourneyName": "MakeTransaction"
  }
  ```
- **Output**: 
  ```json
  {
    "JourneyProduct": "F:Savings|T:Current|Q:Monthly|D:2023-10-10|R:Recurring"
  }
  ```

### Scenario 2: Edge Case
- **Input**:
  ```json
  {
    "JourneyName": "MakeTransaction"
  }
  ```
- **Output**: 
  ```json
  {
    "JourneyProduct": undefined // because no other fields are present
  }
  ```

### Scenario 3: No Journey Name Match
- **Input**: 
  ```json
  {
    "RemitterAccountType": "Credit",
    "BeneficiaryAccountType": "Debit",
    "JourneyName": "ViewTransaction"
  }
  ```
- **Output**: 
  ```json
  {
    "JourneyProduct": undefined // no output as JourneyName doesn't match
  }
  ```

---

## 4. Known Limitations & Gotchas

- **Incomplete Data**: If some properties are missing from `eventPayload`, `JourneyProduct` will not reflect all intended data, leading to potential data loss.
- **Dependency on `JourneyName` Format**: The strict check for `JourneyName` prefixed with "MakeTransaction" means that any variation in naming will cause the extension to function incorrectly.
- **Conflicts**: If multiple extensions affect `JourneyProduct`, there may be conflicts resulting from race conditions or overwrites.
  
---

## 5. Recommendations for Refactoring

- **Defensive Checks**: It may be beneficial in the future to check if properties exist before pushing to the array, though it is not mandated here as the presence of `eventType` and `eventPayload` is guaranteed.
- **Code Style**: Maintaining consistent indentation and code comments for clarity will make this extension easier to maintain.
- **Modularisation**: Consider separating the logic for creating the payment type string into its own function to improve readability and maintainability. 

---

## 6. Maintenance & Further Notes

- **Ongoing Maintenance**: Regularly review the extension to ensure it meets the business requirements, particularly in light of changing data formats or new requirements.
- **Ownership**: Establish a clear ownership point for the extension, ensuring that the owner is responsible for updates.
- **Testing Guidelines**: Implement automated tests for various scenarios to ensure that changes do not break expected functionality.

---

This documentation provides a thorough understanding of the "GAD : HSDL Brand Lookup" extension and serves as a guide for developers and stakeholders involved in its usage and potential enhancement.