# Tealium iQ Extension Documentation

## 1. Extension Overview

- **Name**: LinkValue Nickname Fix
- **ID**: 100036
- **Type**: Javascript Code
- **Scope**: After Load Rules
- **Execution Frequency**: Run Always

### Summary
The "LinkValue Nickname Fix" extension processes `LinkValue` within the event payload to extract and clean relevant information. It focuses on enhancing the value's clarity by filtering out unnecessary or generic account designations, and restructuring the value based on specific patterns to ensure that the resulting data is useful and actionable. This extension is particularly beneficial for maintaining consistent data reporting in applications that rely on event tracking.

## 2. Code Explanation

### Key Variables
- **safeLinkValueParts**: An array that collects and constructs a cleaned-up version of `LinkValue`.
- **genericAccountTypes**: A predefined list of common account types that the extension filters.
- **actionSuffixes**: An array of phrases that specify common actions that might be appended to the `LinkValue`.

### Logic Flow
1. **Initial Check**: The extension checks if `b.LinkValue` is a string. If not, the extension terminates.
2. **Cleaning Process**: The function `cleanLinkValue(linkValue)` is invoked to process `LinkValue`.
   - The function starts by checking if the value begins with "AOV/", filtering and extracting parts accordingly.
   - It splits the `linkValue` into components and checks for uppercase account stems of length 4 or less, storing valid parts.
   - The function then checks if any parts match the `genericAccountTypes`, pushing valid types to the `safeLinkValueParts`.
   - After that, it checks for the presence of action suffixes, extracting relevant suffixes if found in the `linkValue`.
3. **Final Output**: The cleaned-up value is constructed and returned as a joined string.

### Dependencies
- **Global Objects**: The extension uses `eventType` and `eventPayload` as input parameters but does not depend on any external libraries.

## 3. Usage Examples

### Scenario 1: Normal Operation
Assume `b.LinkValue` = `"AOV/business account/payments and transfers"`.
- The extension will:
  - Identify "AOV" as a prefix.
  - Extract "business account" from `genericAccountTypes`.
  - Detect the action suffix "payments and transfers".
  - Return `"AOV/business account/payments and transfers"` as the cleaned `LinkValue`.

### Scenario 2: Edge Condition
Assume `b.LinkValue` = `"random text/other account tiles"`.
- The extension will:
  - Recognise that there are no valid components that match the `genericAccountTypes` or the suffixes at play.
  - The output will remain as `"random text/other account tiles"`.

### Scenario 3: Mixed Account Types
Assume `b.LinkValue` = `"AOV/schools account/make a payment"`.
- The extension identifies:
  - "AOV" is processed.
  - "schools account" is recognised from `genericAccountTypes`.
  - Receiving "make a payment" enables suffix processing.
- Resulting output will be `"AOV/schools account/make a payment"`.

## 4. Known Limitations & Gotchas

- If `b.LinkValue` does not conform to expected formats, the extension can return non-cleaned outputs.
- The hardcoded lists (`genericAccountTypes` and `actionSuffixes`) may become outdated; management of these lists is required to maintain relevance.
- Potential conflicts may arise if other extensions manipulate `LinkValue` in an unexpected manner prior to this extension execution.

## 5. Recommendations for Refactoring

- **Defensive Checks**: Although event properties are guaranteed, additional validation of input formats could aid in better reliability.
- **Code Structure**: Consider modularising the `cleanLinkValue` function into smaller helpers to improve readability and maintainability.
- **Comments**: Adding inline comments can enhance understanding, especially for more complex sections of code.
- **Variable Naming**: Rename `safeLinkValueParts` to something more descriptive, such as `filteredLinkValueComponents`, to clarify its purpose.

## 6. Maintenance & Further Notes

- **Ongoing Maintenance**: Regular review of `genericAccountTypes` and `actionSuffixes` is recommended for alignment with any changes in business logic or account types.
- **Ownership**: Designate a team member to oversee the extension's performance and updates.
- **Testing Guidelines**: Implement unit tests to validate the behaviour of `cleanLinkValue`, especially concerning edge cases and expected output formats.
- **Documentation Updates**: Ensure this documentation reflects any future changes or enhancements made to the extension's functionality.

---

This structured documentation serves to clarify the purpose, functionality, and maintenance requirements for the LinkValue Nickname Fix extension, providing a comprehensive understanding for developers and stakeholders alike.