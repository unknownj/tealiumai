# Tealium iQ Extension Documentation: Report Suite Overrides

## 1. Extension Overview

- **Name**: Report Suite Overrides
- **ID**: 100036
- **Type**: Javascript Code
- **Scope**: After Load Rules
- **Execution Frequency**: Run Always

### Summary
The "Report Suite Overrides" extension is designed to conditionally set the `ReportSuiteOverride` field in the `eventPayload` based on the values in the `Brand` and `JourneyName` properties. It specifically targets brands associated with "Lloyds Banking Group," allowing for data to be segmented appropriately for reporting purposes. By providing overrides, it ensures accurate data collection and reporting for different product lines within the organisation.

---

## 2. Code Explanation

### Key Variables
- **`a`**: Represents the `eventType`, which is an incoming event string.
- **`b`**: Represents the `eventPayload`, which is an object that contains various properties relevant to the event.

### Logic Flow
1. The extension uses a try-catch block to handle potential runtime errors gracefully.
2. It checks if the `Brand` property of `eventPayload` matches specific conditions:
   - If the `Brand` includes "lexautoloease" or "blackhorse" (case-insensitive, spaces removed), it sets `b.ReportSuiteOverride` to "lloydsbankinggroupprod,lloydsbankinggroupmotor".
3. It further checks if the `JourneyName` includes "investmentadvised". If true, it overrides the `ReportSuiteOverride` to just "lloydsbankinggroupprod".
4. If any errors occur during processing the conditions, they are silently caught, and the code execution continues.

### Dependencies
- The extension relies on no external libraries. It uses standard JavaScript methods (e.g., `toLowerCase`, `split`, `join`, and `indexOf`).

---

## 3. Usage Examples

### Normal Conditions
- **Scenario 1**: When the `Brand` is "Lex Auto Lease" and the `JourneyName` is not "investment advised":
    - Input: `{ Brand: "Lex Auto Lease", JourneyName: "" }`
    - Output: `ReportSuiteOverride` is set to "lloydsbankinggroupprod,lloydsbankinggroupmotor".

- **Scenario 2**: If the `Brand` is "BlackHorse" and the `JourneyName` is "cash investment advice":
    - Input: `{ Brand: "BlackHorse", JourneyName: "cash investment advice" }`
    - Output: `ReportSuiteOverride` is set to "lloydsbankinggroupprod,lloydsbankinggroupmotor".

### Edge Conditions
- **Scenario 3**: If the `Brand` is "Investment Advised" but not matched by the first conditions:
    - Input: `{ Brand: "Investment Advised", JourneyName: "investment advised" }`
    - Output: `ReportSuiteOverride` is set to "lloydsbankinggroupprod".

- **Scenario 4**: Error in Brand or JourneyName:
    - Input: `{ Brand: "", JourneyName: "" }`
    - Output: `ReportSuiteOverride` remains undefined as no conditions are satisfied.

---

## 4. Known Limitations & Gotchas

- **Silent Failures**: The use of a try-catch block can hide errors that may be useful for debugging. Developers may need to add logging if debugging is required.
- **Data Integrity**: If multiple conditions are met, the last matching condition dictates the value of `ReportSuiteOverride`, which may not always be the intended behaviour.
- **Performance**: String operations such as `toLowerCase().split(" ").join("")` could be less efficient for large-scale data processing.
- **Conflicts**: This extension may conflict with other extensions that modify `ReportSuiteOverride`, leading to unexpected reporting outcomes.

---

## 5. Recommendations for Refactoring

1. **Code Clarity**: Consider extracting the condition checks into separate functions. This enhances readability and isolates logic for testing.
   
2. **Use One Condition for `Brand`**: Combine the first two checks for `Brand` into a single condition to reduce redundancy:
   ```javascript
   if (/lexautoloease|blackhorse/.test(b.Brand.toLowerCase().replace(/\s+/g, ''))) {
       b.ReportSuiteOverride = "lloydsbankinggroupprod,lloydsbankinggroupmotor";
   }
   ```
   
3. **Add Logging**: Include console logs within the catch block or before overriding `ReportSuiteOverride` for better traceability during development and debugging.
   
4. **Consistent Naming**: Standardise how names are formatted when setting the `ReportSuiteOverride` to avoid potential mismatches in reporting.

5. **Defensive Checks**: Include checks to ensure `b.Brand` and `b.JourneyName` exist and are strings before calling methods on them to avoid runtime errors.

---

## 6. Maintenance & Further Notes

- **Ownership**: Maintain a dedicated owner for this extension who can regularly review and update it as business needs change.
- **Testing Guidelines**: Regularly test the extension with various input scenarios to ensure it behaves correctly as updates are made.
- **Version Control**: Use version control to track changes and document the rationale for modifications in the code comments for future reference.
- **Documentation**: Ensure that this documentation is reviewed periodically to reflect any changes in the code logic or business requirements.

---

This documentation provides a comprehensive guide for understanding and maintaining the "Report Suite Overrides" extension in the Tealium iQ environment. For further questions or clarifications, please reach out to the designated section owners.