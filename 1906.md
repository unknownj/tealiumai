# Tealium iQ Extension Documentation: Cookie Audit

## 1. Extension Overview
- **Name**: Cookie Audit
- **ID**: 100036
- **Type**: JavaScript Code
- **Scope**: 928
- **Execution Frequency**: Active

### Summary
The "Cookie Audit" extension is designed to randomly select one of the cookie names present in the user's browser. It processes the cookies stored on the client-side by splitting them into an array and then filtering to obtain one random cookie name. This functionality can be useful for auditing, reporting, or debugging purposes in relation to cookies set on the user's browser.

---

## 2. Code Explanation

### Key Variables
- **`a`**: Represents the eventType (not directly utilised in the current logic).
- **`b`**: Represents the tagObject in which the random cookie name is stored.
- **`u`**: Represents the eventPayload (not directly utilised in the current logic).
- **`random`**: A random number between 0 and 1 used to select a random index from the array of cookie names.

### Logic Flow
1. The extension defines an immediately invoked function expression (IIFE) that takes `eventType`, `eventPayload`, and `tagObject` as arguments.
2. Inside the IIFE:
   - The `document.cookie` string is split by the "; " delimiter into an array of cookie strings.
   - Each cookie string is further split by the "=" delimiter to extract just the cookie names.
   - Using the random number generated by `Math.random()`, the extension selects an index from the cookie names array, thus randomly retrieving one cookie name.
3. The selected cookie name is then assigned to `b.CookieAuditName`.

### Dependencies
- **Global Objects**: The extension relies on the `document` object to access the cookies.
- **JavaScript Libraries**: No external libraries are required; standard JavaScript functionality is utilised.

---

## 3. Usage Examples

### Normal Scenario
When the extension runs:
- Assume the document has the cookies: `user=John; session=abcd; preferences=dark`.
- The extension may randomly select and set `b.CookieAuditName` to either `user`, `session`, or `preferences`.

### Edge Conditions
- **No Cookies Present**: If no cookies are present, the extension will not throw an error; `b.CookieAuditName` will remain `undefined`.
- **Multiple Cookies**: If the cookies are set multiple times with the same name, the selected name will still be one of the cookies but may not represent unique values.

---

## 4. Known Limitations & Gotchas

- **Empty Cookie String**: The extension currently does not handle scenarios where `document.cookie` is an empty string. This could lead to `b.CookieAuditName` being `undefined` without any notification.
- **Browser Compatibility**: Some browsers might handle cookies differently based on their privacy settings. Ensure testing across multiple browsers.
- **Global Namespace Pollution**: If other extensions also use `b.CookieAuditName`, there may be conflicts. It is recommended to namespace the variable to reduce risks.
- **Events Not Firing**: If the extension is triggered by an event that does not pass the necessary parameters (such as `eventType` or `eventPayload`), the code will still execute but may produce unintended results.

---

## 5. Recommendations for Refactoring

- **Defensive Checks**: Implement checks to ensure cookies exist before attempting to read and manipulate them.
  
    ```javascript
    var cookies = document.cookie ? document.cookie.split("; ") : [];
    if (cookies.length > 0) {
        // proceed with selecting a random cookie
    } else {
        b.CookieAuditName = null; // or a default value
    }
    ```

- **Variable Names**: Consider using more descriptive variable names instead of single-letter variables to improve code readability.
  
    ```javascript
    (function(eventType, eventPayload, tagObject) {
        var randomNumber = Math.random();
        // More readable structure
    })(eventType, eventPayload, tagObject);
    ```

- **Code Structure**: Modularize the code by creating functions for cookie retrieval and random selection to promote reuse and improve readability.

---

## 6. Maintenance & Further Notes

- **Ongoing Maintenance**: Regularly review the functionality as new cookie-related policies may affect how cookies are stored and retrieved (especially with privacy concerns).
- **Ownership**: It is advisable to assign a primary developer or team responsible for future updates and troubleshooting.
- **Testing Guidelines**: Ensure thorough testing across various browsers, including those with strict cookie policies. Maintain unit tests for any future modifications to the code to verify that existing functionalities are not broken.

---

This documentation provides a comprehensive overview of the Cookie Audit extension, ensuring clarity for future developers and stakeholders working with or on behalf of the Tealium iQ platform.