# Tealium iQ Extension Documentation

## Extension Overview
- **Name**: Temp Sortcode fix for Investments
- **ID**: 100040
- **Type**: Advanced Javascript Code
- **Scope**: After Load Rules
- **Execution Frequency**: Run Always

### Summary
This extension is designed to redact sensitive information from the answers to specific questions in the context of user journeys related to investments. The key purpose is to ensure that certain data, which may be sensitive, is obscured when the user has answered specific questions associated with particular investment journeys.

## Code Explanation

### Key Variables
- **`var1Values`**: An array containing specific journey names that should trigger the redaction. Values include `"applyinvestment"` and `"applyrmpension"`.
- **`var2Values`**: An array of QA question prompts that are deemed sensitive. It includes:
  - `"edit ni number"`
  - `"enter email address"`
  - `"confirm email address"`
  - `"sortcode"`
  - `"name of account holder"`
  - `"account number"`
  - `"postcode"`
  - `"first line of address"`
  - `"second line of address"`
  - `"city or town"`

### Logic Flow
1. The extension first checks if the `JourneyName` from the event payload, converted to lowercase, is included in the `var1Values` array.
2. Next, it checks if the `QAQuestion` from the event payload, also converted to lowercase, exists in the `var2Values` array.
3. If both conditions are met, the extension sets the `QAAnswer` field in the event payload to the string `"(Redacted)"`, effectively obscuring the sensitive data.

### Dependencies
- The extension relies on the presence of two properties within the `eventPayload` object: `JourneyName` and `QAQuestion`.
- It does not make use of any external libraries or global objects beyond the `eventType` and `eventPayload` provided context.

## Usage Examples

### Scenario 1: Normal Operation
- **Input**: `eventPayload` contains `{"JourneyName": "applyinvestment", "QAQuestion": "sortcode", "QAAnswer": "123456"}`.
- **Output**: After processing, `eventPayload` will become `{"JourneyName": "applyinvestment", "QAQuestion": "sortcode", "QAAnswer": "(Redacted)"}`.

### Scenario 2: No Redaction
- **Input**: `eventPayload` contains `{"JourneyName": "applyrmpension", "QAQuestion": "account number", "QAAnswer": "654321"}`.
- **Output**: No changes occur, and `eventPayload` remains `{"JourneyName": "applyrmpension", "QAQuestion": "account number", "QAAnswer": "654321"}` because the code is designed to only redact answers for specific questions.

### Edge Condition
- **Input**: `eventPayload` contains `{"JourneyName": "unknownjourney", "QAQuestion": "sortcode", "QAAnswer": "123456"}`.
- **Output**: No redaction occurs, and `eventPayload` remains `{"JourneyName": "unknownjourney", "QAQuestion": "sortcode", "QAAnswer": "123456"}` as the journey name is not in `var1Values`.

## Known Limitations & Gotchas
- If `JourneyName` or `QAQuestion` is undefined or contains unexpected values, the behaviour may lead to no action taken, which could leave sensitive information unredacted.
- The extension may conflict with other extensions that manipulate or rely on `QAAnswer`, leading to data integrity issues.
- Performance might be an issue if there are many extensions competing for execution or if the event payload is considerably large.

## Recommendations for Refactoring
- Introduce defensive checks to ensure that `b["JourneyName"]` and `b["QAQuestion"]` exist and are strings before processing, possibly logging warnings if they do not.
- Use a more structured way to manage the redaction criteria (like an object or a mapping) if it grows or changes frequently.
- Consider modularising the code by creating separate functions for condition checking and the redaction logic to enhance readability and maintainability.
- Ensure naming conventions clearly reflect the intent of each variable to improve code clarity.

## Maintenance & Further Notes
- Ongoing maintenance should involve regular reviews of the values within `var1Values` and `var2Values` to ensure they remain current with new journey names and questions.
- Ownership of the extension should be assigned to a designated team member who will handle updates and related documentation.
- Regular testing of the extension in various scenarios is advisable, especially after any introduction of new features or changes to the event payload structure.