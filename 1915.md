# Tealium iQ Extension Documentation: Signly Load Rule

## 1. Extension Overview

- **Name**: Signly Load Rule
- **ID**: 1915
- **Type**: Javascript Code
- **Scope**: Before Load Rules
- **Execution Frequency**: Run Always

### Summary
The Signly Load Rule extension is designed to enable or disable functionality based on a set of conditions. It assesses the current state of the page and various sources of data to determine whether the "Signly" feature should be activated. This extension is particularly useful for controlling the presentation of certain elements tailored to specific URLs and user interactions while enhancing user experience.

---

## 2. Code Explanation

### Key Variables
- **SIGNLY_KEY**: A string identifier (`"showSignly"`) used for tracking the Signly feature in local storage and cookies.
- **SIGNLY_SELECTOR**: A string representing a CSS selector (`"input[name=signly]"`) to identify an element that, if present in the DOM, indicates potential activation for Signly.

### Logic Flow
The extension implements a self-invoking function that takes `eventType` and `eventPayload` as parameters. Within this function:
1. It establishes a list of conditions, checking various data points to determine if `b.EnableSignly` should be set to `"Y"` (yes) or `"N"` (no).
2. Conditions checked include:
   - Whether `b.EnableSignly` is already set to `"Y"`.
   - Whether a corresponding cookie is found with the key `SIGNLY_KEY` and the value set to `"true"`.
   - The presence of a Signly element identified by `SIGNLY_SELECTOR`.
   - A specific path condition for "GCA Careers" indicating the domain `www.lloydsbankinggroup.com` with a pathname that starts with `/careers/job-search`.
   - A check against local storage to see if the item under `SIGNLY_KEY` is set to `"true"`.

The result of these checks is aggregated using the `reduce` method, returning `"Y"` if any condition is met; otherwise, it returns `"N"`.

### Dependencies
This extension relies on global objects such as:
- `document`: Used for DOM manipulation and querying.
- `window`: Used for accessing local storage and the current URL.

---

## 3. Usage Examples

### Normal Condition
If a user visits the job search page `/careers/job-search` on the specified domain and has the key `showSignly` in local storage set to `true,` the method will return `"Y"`, activating the Signly feature.

### Edge Condition
If no matching elements are present in the DOM, and neither local storage nor cookies indicate that Signly should be enabled, the method will return `"N"`. This scenario could occur if a user visits the site without interacting with any elements that could trigger the functionality.

---

## 4. Known Limitations & Gotchas

- **Dependency on Local Storage**: If local storage is disabled in the user's browser, the extensionâ€™s ability to retrieve the state of the Signly feature will fail, potentially affecting its functionality.
- **Cookie Handling**: The extension assumes that any necessary cookies are set correctly. If cookie consent banners prevent cookies from being set, this logic will not activate Signly as intended.
- **DOM Readiness**: There is no check to ensure the DOM is fully loaded before running this code, which could lead to unforeseen issues if the extension is executed too early.

---

## 5. Recommendations for Refactoring

- **Modularisation**: Consider breaking the checking logic into smaller, reusable functions (e.g., functions to check for local storage, cookies, etc.). This will improve code clarity and maintainability.
- **Self-Documenting Code**: Add comments throughout the code to clarify the purpose of each condition, improving readability for future developers.
- **Error Handling**: Although defensive coding for `eventType` and `eventPayload` is not required, additional error handling could be beneficial when interacting with `localStorage` and `document.querySelector` to capture unexpected behaviours.

---

## 6. Maintenance & Further Notes

- **Ownership**: Designate a team member responsible for the ongoing review and updates to ensure compatibility with updates in web standards and Tealium iQ platform changes.
- **Testing Guidelines**: Regularly test the extension across different browsers and devices to ensure consistent behaviour. Testing should include edge cases such as the absence of cookies/localStorage and unexpected DOM changes.
- **Documentation Updates**: Keep this documentation up to date with any changes made to the code or its functionality. Ensure that version history is tracked for reference in future developments.

--- 

This structured documentation should provide a clear understanding of the Signly Load Rule extension and facilitate smooth collaboration among developers and stakeholders.