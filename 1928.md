# Tealium iQ Extension Documentation: Neutron Flow After Tags

## 1. Extension Overview
- **Name**: Neutron Flow After Tags
- **ID**: 2093
- **Type**: Javascript Code
- **Scope**: After Tag Extensions
- **Execution Frequency**: Run Always

### Summary
The "Neutron Flow After Tags" extension is designed to capture query parameters from the URL and transform them into a semicolon-separated string. This data can be used for analytics or to trigger specific functionalities in the Neutron flow. By processing the URL parameters immediately after tags have executed, it ensures that recent page visit information is available for tracking and event handling.

---

## 2. Code Explanation

### Key Variables
- **window.location.search**: This global object returns a string containing the query parameters of the current URL. It is essential for extracting the parameters.
- **QueryParamList**: A property being assigned the processed result of the query parameters, formatted as a semicolon-separated string.

### Logic Flow
1. The code starts by invoking a self-executing anonymous function, passing in `eventType` and `eventPayload` as parameters.
2. The innermost function separates the query string on the `&` character, resulting in an array of individual parameters.
3. Each parameter string is then split on the `=` character to further isolate the keynames, resulting in an array of keys.
4. The first key is checked to remove any leading '?' which indicates the start of the query string.
5. Finally, all key names are joined together into a single string, separated by semicolons, and assigned to `b.QueryParamList`.

### Global Dependencies
- **window**: The code relies on the window object to access the current URL's query string.
- **eventType** and **eventPayload**: These are assumed to be provided in the context where this extension is invoked.

---

## 3. Usage Examples

### Normal Conditions
- **Scenario**: A user visits a page with the URL `https://example.com/page?param1=value1&param2=value2`.
- **Expected Output**: The extension would process this URL and produce the output: `param1;param2`, which would be stored in `QueryParamList`.

### Edge Conditions
- **Scenario 1**: A user visits a page without any query parameters, e.g., `https://example.com/page`.
  - **Expected Output**: `QueryParamList` would be an empty string.
  
- **Scenario 2**: A user visits a page with an improperly formatted query parameter: `https://example.com/page?param1&param2=value2`.
  - **Expected Output**: `QueryParamList` would still capture `param1;param2`, although `param1` has no value.

---

## 4. Known Limitations & Gotchas
- **Potential for Invalid Output**: If the query parameters are not well-formed (missing values or improperly encoded), the output might not meet expectations.
- **Conflict with Other Extensions**: If another extension modifies the `window.location.search` before this code executes, it could lead to incorrect outputs.
- **Single Execution**: The extension runs only once. Multiple visits with varying query parameters won’t result in any historical data capture unless the page is refreshed.

---

## 5. Recommendations for Refactoring
- **Error Checking**: Currently, there are no checks for malformed input query strings. Consider adding checks for expected formats, although not required here.
- **Code Style**: Maintain consistent indentation and spacing to improve readability (use consistent brackets and indentation levels).
- **Modularisation**: Consider breaking down the logic into smaller reusable functions for clarity and easier testing, especially if further enhancements are planned.
  
Example:
```javascript
function extractQueryParams(search) {
    return search.split("&").map(function(param) {
        return param.split("=")[0];
    });
}
```

---

## 6. Maintenance & Further Notes
- **Ownership**: Assign a primary owner for the extension who will be responsible for updates and documentation.
- **Testing Guidelines**: Regularly test against various URL structures, primarily focusing on edge cases and malformed inputs.
- **Monitoring and Analytics**: Keep track of how the captured data is utilized within Neutron and adjust the extension if any issues arise from data handling.

This documentation can be shared within development teams or with stakeholders to ensure a clear understanding of the extension’s functionality, use cases, and future maintenance guidelines.