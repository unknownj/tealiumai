```markdown
# Tealium iQ Extension Documentation

## 1. Extension Overview
- **Name:** Pegasus V2 : Lookups
- **ID:** 2094
- **Type:** Advanced Javascript Code
- **Scope:** 1656, 1655, 1611, 1783
- **Execution Frequency:** Active

### Summary
This extension serves as a flexible lookup mechanism for mapping various events and parameters related to marketing tags in the Pegasus platform. It helps in efficiently managing advertising and conversion tracking by providing a structured approach to link events with corresponding tag IDs. Its primary purpose is to enhance the accuracy of tracking user interactions, allowing for better analytics and reporting.

## 2. Code Explanation
### Key Variables
- `structureLkps`: A mapping of lookup variable types to their corresponding attributes.
- `lookupTable`: An array holding multiple entries that map event types and identifiers to specific tags for conversion and remarketing purposes.

### Logic Flow
1. The extension initializes an object called `structureLkps` that defines how various lookup fields are structured and related.
2. The `lookupTable` is populated with entries that correlate specific event types, such as "Page" or "Event", to their respective identifiers.
3. Each entry in `lookupTable` is formatted as a string containing the required parameters for Google Floodlight (`gfl`), Google Ads (`gad`), or Microsoft (`mau`).
4. No external libraries are declared as dependencies within the code, making it standalone within the Tealium iQ environment.

### Dependencies
- The extension relies on the presence of the global objects `eventType`, `eventPayload`, and `tagObject`, which are expected to be available in the context it runs.

## 3. Usage Examples
### Normal Scenario
When a user visits a page, the `eventType` and `eventPayload` are processed by this extension to match against the entries in the `lookupTable`. For example, accessing the page `www.learnwithhalifax.co.uk/money/i-want-to-budget-and-save/` will look up the relevant tag `gad!454995991!JPAnCLW1w5QZEJfg-tgB:mau!view_item:meta!ViewContent`.

### Edge Cases
1. **Missing Lookup Entry**: If the `lookupTable` doesn't contain an entry matching the current `eventType`, the extension may not trigger any tags which could lead to a lack of data tracking for that event. Developers need to ensure that all possible events are adequately defined in the `lookupTable`.
2. **Incorrect Formatting**: If the format of the events or URLs in `lookupTable` is altered (e.g., missing parameters), the mapping will fail, potentially causing data quality issues.

## 4. Known Limitations & Gotchas
- **Data Type Sensitivity**: The structure of inputs and outputs must match exactly as defined in the `lookupTable`. Any variation in case sensitivity or formatting may lead to lookup failures.
- **Performance Impact**: With a large number of entries in `lookupTable`, performance may degrade, especially during high traffic periods.
- **Conflicts**: Other extensions processing the same `eventType` may lead to unintended interference unless their execution order is tightly controlled.

## 5. Recommendations for Refactoring
- **Defensive Programming**: Although checks exist for `eventType` and `eventPayload`, consider adding validation to ensure they are of expected types (`string` and `object` respectively). 
- **Modularisation**: The logical flow can be broken down into manageable functions. For example, isolate lookup processing into a dedicated function to enhance readability and maintenance.
- **Commenting and Documentation**: Improve inline commenting to clarify the purpose of individual sections of code, which would make it easier for others to understand the flow.
- **Unit Testing**: Implement tests to validate that lookups behave as intended and fail gracefully.

## 6. Maintenance & Further Notes
- **Ownership**: Assign a dedicated team member to oversee the extension to ensure timely updates and troubleshooting.
- **Testing Guidelines**: Regularly test the extension with both expected and edge-case inputs to validate functionality, especially after updates to the `lookupTable`.
- **Documentation**: Keep this documentation updated with any changes to the extension's logic or data structures to maintain clarity for current and future developers.

---

> This document serves as a comprehensive guide to understanding and maintaining the "Pegasus V2 : Lookups" Tealium iQ extension. Please share it with any developers or stakeholders who engage with the extension for effective utilisation and collaboration.
```