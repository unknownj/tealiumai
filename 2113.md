# Tealium iQ Extension Documentation: Performance Marks for Timing Measurement

## 1. Extension Overview

- **Name**: Performance Marks for Timing Measurement
- **ID**: 100036
- **Type**: Javascript Code
- **Scope**: DOM Ready
- **Execution Frequency**: Run Once

### Summary
This extension is designed to facilitate performance measurement by marking specific points in time within the page load lifecycle. It allows for the tracking of timing metrics by recording when particular events occur relative to page load and view timestamps. By capturing these marks, the extension aids in diagnosing performance issues and enhancing user experience through data-driven insights.

## 2. Code Explanation

### Key Variables
- `markName`: A string representing the name of the performance mark.
- `markTime`: A timestamp representing the current time in milliseconds since Unix epoch.
- `this.markStarts`: An object that stores the starting timestamps for different performance marks.

### Logic Flow
1. **markStart Function**:
   - Accepts a `markName` argument.
   - Validates the `markName` to ensure it is a string of no more than 100 characters.
   - Records the current timestamp in milliseconds, assigning it to `this.markStarts` under the provided `markName`.

2. **mark Function**:
   - Similar validation is performed on `markName`.
   - Calculates the time elapsed since page load and page view, validating that both times are within acceptable limits (30 minutes maximum).
   - If `markStart` was called with the same `markName`, it computes the relative time difference.
   - Constructs a product string encapsulating timing metrics and user-defined events.
   - Updates the `LBGAnalytics.correlations.cache` with newly constructed product strings and persists this data in `localStorage` for further use.

### Dependencies
- **LBGAnalytics**: This extension relies on the global `LBGAnalytics` object for functionality. It expects `LBGAnalytics.datalayer.getCache()` to retrieve relevant timestamps and `LBGAnalytics.correlations.cache` for caching analytics data.

## 3. Usage Examples

### Normal Condition
```javascript
LBGAnalytics.events.markStart("loadEvent");
// After some processing
LBGAnalytics.events.mark("loadEvent");
```
- The above sequence tags the start and end of a load event, capturing the elapsed time between the two.

### Edge Conditions
1. **Exceeding Length of markName**:
   ```javascript
   LBGAnalytics.events.markStart("this_mark_name_is_too_long_for_the_extension");
   ```
   - The extension would return without performing any operation due to name length validation.

2. **Out of Time Bounds**:
   If the timestamps exceed the 30-minute limit:
   ```javascript
   // Suppose the page loaded 31 minutes ago
   LBGAnalytics.datalayer.getCache().PageLoadTimeStamp = Date.now() - 31 * 60000;
   LBGAnalytics.events.mark("loadEvent");
   ```
   - The extension would return without marking the event.

## 4. Known Limitations & Gotchas

- **Timing Limitations**: Events that occur outside the 30-minute range from the page load time or view time will not be recorded, potentially omitting important metrics.
- **LocalStorage Limitations**: The product string is stored in `localStorage`, which might lead to storage issues if the cache grows large; developers should manage this size actively.
- **Global Dependencies**: The extension relies on `LBGAnalytics` being present, which creates tight coupling; if `LBGAnalytics` is altered, it could break functionality.

## 5. Recommendations for Refactoring

- **Code Style Improvements**: Consider using consistent naming conventions throughout the codebase. For example, using camelCase for variable names can enhance readability.
- **Modularization**: If this extension grows in complexity, breaking it down into smaller functions could improve maintainability.
- **Enhanced Validation**: Adding more explicit error messages could aid developers in identifying issues during debugging.

## 6. Maintenance & Further Notes

- **Ownership**: Assign a designated owner to ensure ongoing maintenance and updates to this extension.
- **Testing Guidelines**: Regularly test the extension across multiple browsers and devices to ensure consistent performance tracking.
- **Documentation Updates**: Keep this documentation current with any code changes or functionality additions to support effective knowledge transfer among team members.

By following this structured documentation and addressing the details outlined above, developers can implement and maintain effective timing measurements through the Tealium iQ extension confidently.