# Tealium iQ Extension Documentation: MAU : set cookie defaults

## 1. Extension Overview

- **Name**: MAU : set cookie defaults
- **ID**: 2260
- **Type**: Javascript Code
- **Scope**: Before Load Rules
- **Execution Frequency**: Run Once

### Summary
This extension sets default cookie consent preferences by interacting with the global `uetq` object. Initially, it denies consent for advertising storage. If the targeting cookies are allowed, it updates the consent status to granted. This mechanism ensures compliance with user consent requirements for advertising purposes in a streamlined manner.

## 2. Code Explanation

### Key Variables
- `window.uetq`: A global array used for tracking user consent states.
- `ad_storage`: A parameter within the consent object that specifies whether advertising storage is granted or denied.
- `b["CookiesTargeting"]`: A boolean flag that indicates if targeting cookies are permitted.

### Logic Flow
1. **Initialization**:
   - Check if `window.uetq` is undefined and initialise it as an empty array if necessary.
2. **Set Default Settings**:
   - Push a default consent state (`'denied'`) for advertising storage into the `uetq` array.
3. **Update State if Allowed**:
   - If the `CookiesTargeting` flag is true, modify the consent setting to `'granted'`.

### Dependencies
- This extension relies on the global object `window` for `uetq` and the event parameters passed into the function (`eventType`, `eventPayload`).

## 3. Usage Examples

### Normal Flow
- **Scenario**: A user visits a site where targeting cookies are allowed.
  - `b["CookiesTargeting"]` is `true`.
  - The extension sets `ad_storage` to `'denied'` initially, but upon detection of allowed targeting, it updates the consent to `'granted'` in the subsequent action.

### Edge Conditions
- **Scenario**: A user visits a site without enabling targeting cookies.
  - `b["CookiesTargeting"]` is `false`.
  - The extension will not modify the original consent state, ensuring that the advertising storage remains as `'denied'`.

## 4. Known Limitations & Gotchas

- The extension is designed to output a default consent state regardless of other scripts' influence during the initial execution.
- If there are other extensions or scripts that override the `window.uetq` globally after this extension runs, it may cause conflicts or unintended behaviours.
- This extension does not provide mechanisms for error handling; should the `CookiesTargeting` flag be manipulated after this extension executes, it will not reactively update the consent state.

## 5. Recommendations for Refactoring

- **Defensive Checks**: While it's stated that `eventType` and `eventPayload` are guaranteed, consider adding checks for other properties in the future.
- **Code Style**: Adhere to a consistent method for handling the inclusion of `uetq`, ensuring it is always initialised before use.
- **Modularization**: Structure the logic into separate functions (e.g., one for initialising `uetq`, another for setting consent), improving readability and maintainability.

## 6. Maintenance & Further Notes

- **Ownership**: Assign a dedicated owner for this extension to oversee its functionality and implementation.
- **Testing Guidelines**: Establish a framework for testing the extension across different user scenarios, ensuring that the expected consent states are recorded under various conditions.
- **Ongoing Maintenance**: Regularly review the extension to ensure it aligns with changing compliance laws and user expectations regarding cookie consent.

---

This documentation serves as a comprehensive guide for developers and stakeholders, encapsulating the functionality and implementation details of the "MAU : set cookie defaults" extension in Tealium iQ.