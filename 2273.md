# Tealium iQ Extension Documentation: Locate All QR Codes on the Site

## 1. Extension Overview
- **Name**: Locate All QR Codes on the Site
- **ID**: 2273
- **Type**: Javascript Code
- **Scope**: After Load Rules
- **Execution Frequency**: Run Always

### Summary
This extension is designed to scan a webpage for `<picture>` elements containing QR codes. When identified, it extracts the value of a specified attribute (`data-selector`) from those elements and appends this data to the `CustomList` variable in the `eventPayload`. This is useful for tracking QR code presence and facilitating analytics related to their usage on the site.

---

## 2. Code Explanation
### Key Variables
- **`divs`**: A NodeList of all `<picture>` elements on the current webpage.
- **`qrs`**: An array that stores the values fetched from the `data-selector` attributes of QR code containing elements.

### Logic Flow
1. The extension begins by selecting all `<picture>` elements using `document.querySelectorAll("picture")`.
2. A loop iterates over these elements:
   - It checks if the inner HTML contains the string 'qr'.
   - If found, it searches for child elements with the `data-selector` attribute.
   - The value of the `data-selector` is retrieved and stored in the `qrs` array.
3. After collating all values:
   - If `b.CustomList` already exists, it concatenates the new QR data, prefixed by "QRs/".
   - If `b.CustomList` does not exist, it initializes it with the string "QRs/" followed by the collected data.

### Dependencies
- This extension relies on the global `document` object to access the DOM for querying elements.
- Usage of `b` and `eventPayload` is assumed to be consistent with Tealium's standard event structure.

---

## 3. Usage Examples
### Normal Condition
- **Scenario**: A user visits a page containing multiple QR code elements wrapped in `<picture>`.
- **Input**: An HTML element structure such as:
    ```html
    <picture>
        <img src="qr-code1.png" data-selector="Type1">
    </picture>
    <picture>
        <img src="qr-code2.png" data-selector="Type2">
    </picture>
    ```
- **Output**: The `CustomList` in the `eventPayload` would receive:
    ```
    "QRs/Type1,Type2"
    ```

### Edge Condition
- **Scenario**: A page contains no `<picture>` elements or none with a `data-selector`.
- **Output**: The `CustomList` will be set as:
    ```
    "QRs/"
    ```
  If `b.CustomList` existed prior to the execution, it will remain unaffected.

---

## 4. Known Limitations & Gotchas
- The extension may fail if the `data-selector` attribute is missing on `<picture>` elements, leading to potential errors if expected values are not found.
- Performance may degrade on pages with a large number of `<picture>` elements due to the linear scan.
- Be aware of potential conflicts if other extensions manipulate the `CustomList` in `eventPayload` concurrently. This extension assumes exclusive write access.

---

## 5. Recommendations for Refactoring
- **Defensive Checks**: Consider implementing checks for the existence of `data-selector` before attempting to access it, though it is not requested in the current case.
- **Code Style**: Improve readability by using meaningful variable names and potentially splitting functionalities into smaller functions if needed, following ES5 standards.
- **Modularisation**: Although not required here, encapsulating the logic for gathering QR data into a separate function could enhance reusability.
  
### Example Refactor
```javascript
function findQRCodes() {
    var divs = document.querySelectorAll("picture");
    var qrs = [];
    // Logic for finding QR codes here...
    return qrs;
}
```

---

## 6. Maintenance & Further Notes
- **Ownership**: Designate a team member to oversee this extension's functionality and updates.
- **Testing Guidelines**: Always conduct tests across different environments and edge cases, particularly on pages with varying structures of `<picture>` elements.
- **Future Updates**: Monitor for new requirements around QR code tracking to identify potential enhancements or additional data points that could be captured in future iterations.

--- 

This documentation provides a comprehensive overview of the Tealium iQ extension, ensuring an understanding of its functionality and considerations for implementation and maintenance.