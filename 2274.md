# Tealium iQ Extension Documentation

## 1. Extension Overview
- **Name:** Division Override for Business Domains
- **ID:** 2274
- **Type:** Javascript Code
- **Scope:** After Load Rules
- **Execution Frequency:** Run Always

### Summary
This extension serves the purpose of overriding the 'Division' property in the event payload for specific business domains associated with Lloyds Bank and Bank of Scotland. It checks the hostname of the current page and, if it finds a match with predefined domain names, it assigns the value "Commercial" to the `Division` property. This enables targeted tracking for these business segments, ensuring that analytics and reporting are accurately categorised based on the user's location.

---

## 2. Code Explanation

### Key Variables
- `businessDomainMatches`: An array that holds domain names for which the Division should be set to "Commercial".

### Logic Flow
1. The extension is encapsulated in an immediately invoked function expression (IIFE) that takes two parameters: `eventType` and `eventPayload`.
2. The `forEach` method iterates through each domain in the `businessDomainMatches` array.
3. For each domain, it checks if the current hostname includes the domain as a substring. This is done using `window.location.hostname.indexOf(domain) > -1`.
4. If a match is found, it assigns the string "Commercial" to the `Division` property of the `eventPayload` object.

### Dependencies
- The extension relies on the global `window` object to access `location.hostname` and the event payload object that is automatically passed in.

---

## 3. Usage Examples

### Normal Conditions
- When the user navigates to `https://securebusiness.lloydsbank.co.uk`, the `Division` property in `eventPayload` will be set to "Commercial":
  ```javascript
  // eventPayload will contain
  {
    Division: "Commercial",
    ...
  }
  ```

### Edge Conditions
- If the user visits a domain not included in `businessDomainMatches`, such as `https://www.example.com`, the `Division` property will not be modified:
  ```javascript
  // eventPayload remains unchanged
  {
    Division: undefined,
    ...
  }
  ```

- If a user accesses a domain with a subdomain not listed, such as `https://onlinebusiness.test.lloydsbank.co.uk`, the check will still pass if the main domain matches:
  ```javascript
  // eventPayload will be set to
  {
    Division: "Commercial",
    ...
  }
  ```

---

## 4. Known Limitations & Gotchas
- The extension relies fully on the hostname having the exact structure as defined in `businessDomainMatches`. Variations in subdomains, such as additional prefixes or suffixes, will not trigger the override.
- If multiple conditions are required for setting the `Division` property, this extension is limited as it only checks against an array of domains.
- Potential conflicts could arise with other extensions that also manipulate `eventPayload`. If not well-coordinated, properties in `eventPayload` might be overwritten unexpectedly.

---

## 5. Recommendations for Refactoring
- **Defensive Checks**: While the availability of `eventType` and `eventPayload` are guaranteed, consider including checks to ensure `eventPayload` holds a valid structure before assigning values. 
- **Modularisation**: Make the domain matching list configurable or externalised, allowing for easier updates without needing code changes.
- **Code Style**: Improve readability by clearly commenting key sections of code with details on what each part is responsible for. 

Example of a clearer structure:
```javascript
function setDivisionForMatchingDomains(domains, payload) {
    domains.forEach(function(domain) {
        if (window.location.hostname.indexOf(domain) > -1) {
            payload.Division = "Commercial";
        }
    });
}
setDivisionForMatchingDomains(businessDomainMatches, eventPayload);
```

---

## 6. Maintenance & Further Notes
- **Ongoing Maintenance**: Regularly review and update the `businessDomainMatches` array to reflect any changes in domain strategy or structure.
- **Ownership**: Assign a dedicated owner to maintain this extension, who can monitor any changes in business domains and make necessary code updates.
- **Testing Guidelines**: Ensure thorough testing is carried out whenever modifications to the domains are made. Use various testing environments to confirm the correct behaviour across all specified domains.

By maintaining this documentation, developers and stakeholders can ensure clarity and ease of understanding for future modifications and uses of the extension.