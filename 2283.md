# Tealium iQ Extension Documentation

## 1. Extension Overview

- **Name**: [Please add the name]
- **ID**: 2283
- **Type**: Javascript Code
- **Scope**: 928
- **Execution Frequency**: Active

### Summary
This extension monitors the webpage for a specific structure within the URL, particularly focusing on `secure-aem-hub`. Upon detecting this structure, it extracts the value of a query parameter (`aempage`) and assigns it to a variable named `JourneyName`. If the extracted journey name does not include "savings-calculator", it is passed to a global object for further tracking. Additionally, the extension ensures that a particular analytics function is called only once per page load, provided certain conditions are satisfied.

## 2. Code Explanation

### Key Variables
- `journeyName`: A variable extracted from the URL parameters, particularly looking for `aempage`.
- `b`: Represents the global object where the `JourneyName` may be stored.
- `u`: A global object which holds state; in this case, it tracks whether the analytics function has been loaded to avoid duplicate calls.

### Logic Flow
1. The extension first checks if the current page path contains "secure-aem-hub".
2. If true, it constructs a `journeyName` by filtering through URL parameters for `aempage`.
3. It checks if the `journeyName` exists and does not contain "savings-calculator". If the conditions are satisfied, `JourneyName` is assigned to `b`.
4. The extension attempts to call `LBGAnalytics.santa.do` function with specific parameters, ensuring it only runs once per page using the `u` object.

### Dependencies
- It uses `LBGAnalytics.santa.do` as a global function, which must be present on the page for this extension to work effectively.
- The extension relies on the window object, assuming it is executed in a browser environment with available `document` and `window` objects.

## 3. Usage Examples

### Scenario 1: Successful Journey Name Extraction
- **URL**: `/secure-aem-hub?user=123&aempage=test-journey`
- **Outcome**: 
  - `journeyName` is set to `test-journey`.
  - Since it does not contain "savings-calculator", `b.JourneyName` is assigned `"test-journey"` and the analytics function is called.

### Scenario 2: Edge Case - Journey Name with 'savings-calculator'
- **URL**: `/secure-aem-hub?user=123&aempage=savings-calculator`
- **Outcome**: 
  - `journeyName` is set to `savings-calculator`.
  - The condition fails, so `b.JourneyName` is not assigned, and the analytics function is not invoked.

### Scenario 3: URL Without Required Parameter
- **URL**: `/secure-aem-hub?user=123`
- **Outcome**: 
  - No `journeyName` is extracted, thus nothing is assigned to `b.JourneyName`.

## 4. Known Limitations & Gotchas

- This extension requires specific URL parameter formats to function correctly. If the `aempage` parameter is missing, it will not execute as intended.
- There could be conflicts if another extension or script attempts to manipulate the same global objects (`b`, `u`).
- If the `LBGAnalytics` library is not loaded before this extension executes, the call to `LBGAnalytics.santa.do` will fail silently.

## 5. Recommendations for Refactoring

- **Modularisation**: Consider breaking down the functionality into smaller functions (e.g. `extractJourneyName`, `trackAnalytics`) for better readability and maintainability.
- **Defensive Checks**: While eventType and eventPayload are guaranteed, consider checking if `LBGAnalytics` is defined before calling its methods.
- **Code Style**: Follow consistent indentation and spacing to make the code more readable. 

Example of refactored handling of `LBGAnalytics`:

```javascript
if (typeof LBGAnalytics !== "undefined" && typeof LBGAnalytics.santa !== "undefined") {
    LBGAnalytics.santa.do({ action: "more-santa", key: "secure-aem-hub" });
}
```

## 6. Maintenance & Further Notes

- **Ownership**: Assign a responsible developer or team for the upkeep and any potential updates of this extension.
- **Testing**: Establish a robust testing mechanism to validate functionality across various scenarios, especially after any updates or changes to dependencies.
- **Documentation Updates**: Encourage updating this documentation with any meaningful changes to the codebase or functionality over time.

This thorough documentation serves as a guide for current and future developers, ensuring a smoother experience when working with this Tealium iQ extension.