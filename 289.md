# Tealium iQ Extension Documentation

## Extension Overview
- **Name**: GDC : TAG : Set : DC_lookupJS + DC_lookupAS
- **ID**: 1051
- **Type**: Set Data Values
- **Scope**: 871, 870
- **Execution Frequency**: Active

### Summary
This extension is designed to evaluate whether a DC pixel should be triggered on CWA (Customer Web Application) journeys. The evaluation is based on two primary conditions:
1. A combination of **Brand**, **JourneyName**, and **JourneyStep**.
2. A combination of **Brand**, **JourneyName**, and **ApplicationState**.

The extension adds two data points to the inbound payload:
- `DC_cwalookupJS`: Added as a string in the format of `"Brand!JourneyName!JourneyStep"`.
- `DC_cwalookupAS`: Also formatted as `"Brand!JourneyName!JourneyStep"`.

## Code Explanation

### Key Variables
- **b.TagList**: A string that collects tags to be loaded, which are derived from the Tealium loader configuration and global enrichment data.

### Logic Flow
1. The extension attempts to populate `b.TagList`:
   - It maps over the keys in `utag.loader.cfg` to check conditions necessary for each tag to be included.
   - Tags are included if they are set to be sent, can be loaded, and have the proper events attached.
   - The result is a semicolon-delimited string of tags that meet these criteria.

2. The extension also tries to enrich `b.TagList` by collecting keys from `utag.globals.dle.enrichments`, transforming each key into a short representation.

### Dependencies
- **Global Objects**: The extension relies heavily on the following global objects:
  - `utag.loader.cfg`: The configuration for tags within Tealium.
  - `utag.sender`: The sender object to determine event handling.
  - `utag.globals.dle.enrichments`: A global storage for additional data points.

## Usage Examples

### Normal Conditions
1. When the brand is "BrandA", journey name is "Journey1", and the journey step is "Step1", the extension adds:
   - `DC_cwalookupJS` = `"BrandA!Journey1!Step1"`
   - `DC_cwalookupAS` = `"BrandA!Journey1!Step1"`

### Edge Conditions
2. If there are no tags configured in `utag.loader.cfg`, `b.TagList` will simply be an empty string. However, if there are entries, but none meet the conditions (e.g., tags not set to send), only enrichment keys will be added, resulting in `b.TagList` containing varied short representations based on `utag.globals.dle.enrichments`.

3. If `utag.globals.dle.enrichments` is not present, the extension handles it gracefully, causing no disruption in processing.

## Known Limitations & Gotchas
- The extension may fail to collect tags if `utag.loader.cfg` is improperly configured.
- There might be conflicts with other extensions if they manipulate the same `b.TagList` variable. It’s important to ensure that other extensions do not alter the structure of `TagList` unexpectedly.
- The extension assumes that `utag.globals.dle.enrichments` exists and will not handle cases where this is absent, potentially resulting in unexpected behavior.

## Recommendations for Refactoring
- **Defensive Checks**: While the code assumes the presence of certain global variables, it might be beneficial to implement checks to prevent runtime errors if these variables are unexpectedly absent.
- **Code Style**: Consider tidying the nested function calls for better readability. Although ES5 is mandated, simple named functions could replace the deeply nested anonymous functions for clarity.
- **Modularization**: Splitting the logic that populates `TagList` into smaller, named functions could improve maintainability and testing.

## Maintenance & Further Notes
- **Ownership**: Assign a dedicated owner for this extension to ensure accountability for any changes and updates.
- **Testing Guidelines**: Establish a robust testing framework to validate the behaviour of the extension under different configurations and data inputs.
- **Ongoing Maintenance**: Regularly review the extension’s performance to identify potential enhancements or updates needed due to changes in the Tealium ecosystem or external services utilized by the extension.

By following the guidelines outlined in this document, developers and stakeholders can effectively understand, utilise, and maintain the GDC : TAG : Set : DC_lookupJS + DC_lookupAS extension within the Tealium iQ platform.